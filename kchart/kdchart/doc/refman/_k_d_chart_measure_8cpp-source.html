<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KD Chart 2: KDChartMeasure.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>KDChartMeasure.cpp</h1><a href="_k_d_chart_measure_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment"> ** Copyright (C) 2006 Klar√§lvdalens Datakonsult AB.  All rights reserved.</span>
00003 <span class="comment"> **</span>
00004 <span class="comment"> ** This file is part of the KD Chart library.</span>
00005 <span class="comment"> **</span>
00006 <span class="comment"> ** This file may be distributed and/or modified under the terms of the</span>
00007 <span class="comment"> ** GNU General Public License version 2 as published by the Free Software</span>
00008 <span class="comment"> ** Foundation and appearing in the file LICENSE.GPL included in the</span>
00009 <span class="comment"> ** packaging of this file.</span>
00010 <span class="comment"> **</span>
00011 <span class="comment"> ** Licensees holding valid commercial KD Chart licenses may use this file in</span>
00012 <span class="comment"> ** accordance with the KD Chart Commercial License Agreement provided with</span>
00013 <span class="comment"> ** the Software.</span>
00014 <span class="comment"> **</span>
00015 <span class="comment"> ** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00016 <span class="comment"> ** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00017 <span class="comment"> **</span>
00018 <span class="comment"> ** See http://www.kdab.net/kdchart for</span>
00019 <span class="comment"> **   information about KDChart Commercial License Agreements.</span>
00020 <span class="comment"> **</span>
00021 <span class="comment"> ** Contact info@kdab.net if any conditions of this</span>
00022 <span class="comment"> ** licensing are not clear to you.</span>
00023 <span class="comment"> **</span>
00024 <span class="comment"> **********************************************************************/</span>
00025 
00026 <span class="preprocessor">#include &lt;QWidget&gt;</span>
00027 
00028 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_measure_8h.html">KDChartMeasure.h</a>"</span>
00029 <span class="preprocessor">#include &lt;QtXml/QDomDocumentFragment&gt;</span>
00030 <span class="preprocessor">#include &lt;<a class="code" href="_k_d_chart_abstract_area_8h.html">KDChartAbstractArea.h</a>&gt;</span>
00031 <span class="preprocessor">#include &lt;<a class="code" href="_k_d_chart_text_attributes_8h.html">KDChartTextAttributes.h</a>&gt;</span>
00032 <span class="preprocessor">#include &lt;<a class="code" href="_k_d_chart_frame_attributes_8h.html">KDChartFrameAttributes.h</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="_k_d_chart_background_attributes_8h.html">KDChartBackgroundAttributes.h</a>&gt;</span>
00034 
00035 <span class="preprocessor">#include &lt;KDABLibFakes&gt;</span>
00036 
00037 
00038 <span class="keyword">namespace </span>KDChart {
00039 
00040 
<a name="l00041"></a><a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea5">00041</a> <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea5">Measure::Measure</a>()
00042   : mValue( 0.0 ),
00043     mMode(  <a class="code" href="class_k_d_chart_enums.html">KDChartEnums</a>::MeasureCalculationModeAuto ),
00044     mArea(  0 ),
00045     mOrientation( <a class="code" href="class_k_d_chart_enums.html">KDChartEnums</a>::MeasureOrientationAuto )
00046 {
00047     <span class="comment">// this bloc left empty intentionally</span>
00048 }
00049 
<a name="l00050"></a><a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea4">00050</a> <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea5">Measure::Measure</a>( qreal value,
00051     KDChartEnums::MeasureCalculationMode mode,
00052     KDChartEnums::MeasureOrientation orientation )
00053   : mValue( value ),
00054     mMode(  mode ),
00055     mArea(  0 ),
00056     mOrientation( orientation )
00057 {
00058     <span class="comment">// this bloc left empty intentionally</span>
00059 }
00060 
<a name="l00061"></a><a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea3">00061</a> <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea5">Measure::Measure</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_measure.html">Measure</a>&amp; r )
00062   : mValue( r.value() ),
00063     mMode(  r.calculationMode() ),
00064     mArea(  r.referenceArea() ),
00065     mOrientation( r.referenceOrientation() )
00066 {
00067     <span class="comment">// this bloc left empty intentionally</span>
00068 }
00069 
<a name="l00070"></a><a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea7">00070</a> <a class="code" href="class_k_d_chart_1_1_measure.html">Measure</a> &amp; <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea7">Measure::operator=</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_measure.html">Measure</a>&amp; r )
00071 {
00072     <span class="keywordflow">if</span>( <span class="keyword">this</span> != &amp;r ){
00073         mValue = r.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea18">value</a>();
00074         mMode  = r.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea2">calculationMode</a>();
00075         mArea  = r.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea9">referenceArea</a>();
00076         mOrientation = r.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea10">referenceOrientation</a>();
00077     }
00078 
00079     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00080 }
00081 
00082 
<a name="l00083"></a><a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea0">00083</a> qreal <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea1">Measure::calculatedValue</a>( <span class="keyword">const</span> QSizeF&amp; autoSize,
00084                                 KDChartEnums::MeasureOrientation autoOrientation)<span class="keyword"> const</span>
00085 <span class="keyword"></span>{
00086     <span class="keywordflow">if</span>( mMode == KDChartEnums::MeasureCalculationModeAbsolute ){
00087         <span class="keywordflow">return</span> mValue;
00088     }<span class="keywordflow">else</span>{
00089         qreal <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea18">value</a> = 0.0;
00090         <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a> theAutoArea;
00091         <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* autoArea = &amp;theAutoArea;
00092         <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* area = mArea ? mArea : autoArea;
00093         KDChartEnums::MeasureOrientation orientation = mOrientation;
00094         <span class="keywordflow">switch</span>( mMode ){
00095             <span class="keywordflow">case</span> KDChartEnums::MeasureCalculationModeAuto:
00096                 area = autoArea;
00097                 orientation = autoOrientation;
00098                 <span class="keywordflow">break</span>;
00099             <span class="keywordflow">case</span> KDChartEnums::MeasureCalculationModeAutoArea:
00100                 area = autoArea;
00101                 <span class="keywordflow">break</span>;
00102             <span class="keywordflow">case</span> KDChartEnums::MeasureCalculationModeAutoOrientation:
00103                 orientation = autoOrientation;
00104                 <span class="keywordflow">break</span>;
00105             <span class="keywordflow">case</span> KDChartEnums::MeasureCalculationModeAbsolute: <span class="comment">// fall through intended</span>
00106             <span class="keywordflow">case</span> KDChartEnums::MeasureCalculationModeRelative:
00107                 <span class="keywordflow">break</span>;
00108         }
00109         <span class="keywordflow">if</span>( area ){
00110             QSizeF size;
00111             <span class="keywordflow">if</span>( area == autoArea )
00112                 size = autoSize;
00113             <span class="keywordflow">else</span>
00114                 size = <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea17">sizeOfArea</a>( area );
00115             <span class="comment">//qDebug() &lt;&lt; "size" &lt;&lt; size;</span>
00116             qreal referenceValue;
00117             <span class="keywordflow">switch</span>( orientation ){
00118                 <span class="keywordflow">case</span> KDChartEnums::MeasureOrientationAuto: <span class="comment">// fall through intended</span>
00119                 <span class="keywordflow">case</span> KDChartEnums::MeasureOrientationMinimum:
00120                     referenceValue = qMin( size.width(), size.height() );
00121                     <span class="keywordflow">break</span>;
00122                 <span class="keywordflow">case</span> KDChartEnums::MeasureOrientationMaximum:
00123                     referenceValue = qMax( size.width(), size.height() );
00124                     <span class="keywordflow">break</span>;
00125                 <span class="keywordflow">case</span> KDChartEnums::MeasureOrientationHorizontal:
00126                     referenceValue = size.width();
00127                     <span class="keywordflow">break</span>;
00128                 <span class="keywordflow">case</span> KDChartEnums::MeasureOrientationVertical:
00129                     referenceValue = size.height();
00130                     <span class="keywordflow">break</span>;
00131             }
00132             value = mValue / 1000.0 * referenceValue;
00133         }
00134         <span class="keywordflow">return</span> value;
00135     }
00136 }
00137 
00138 
<a name="l00139"></a><a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea1">00139</a> qreal <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea1">Measure::calculatedValue</a>( <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* autoArea,
00140                                 KDChartEnums::MeasureOrientation autoOrientation)<span class="keyword"> const</span>
00141 <span class="keyword"></span>{
00142     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea1">calculatedValue</a>( <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea17">sizeOfArea</a>( autoArea ), autoOrientation);
00143 }
00144 
00145 
<a name="l00146"></a><a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea17">00146</a> <span class="keyword">const</span> QSizeF <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea17">Measure::sizeOfArea</a>( <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* area )<span class="keyword"> const</span>
00147 <span class="keyword"></span>{
00148     QSizeF size;
00149     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_abstract_area.html">AbstractArea</a>* kdcArea = dynamic_cast&lt;const AbstractArea*&gt;(area);
00150     <span class="keywordflow">if</span>( kdcArea ){
00151         size = kdcArea-&gt;geometry().size();
00152         <span class="comment">//qDebug() &lt;&lt; "Measure::sizeOfArea() found kdcArea with size" &lt;&lt; size;</span>
00153     }<span class="keywordflow">else</span>{
00154         <span class="keyword">const</span> <a class="code" href="class_q_widget.html">QWidget</a>* widget = dynamic_cast&lt;const QWidget*&gt;(area);
00155         <span class="keywordflow">if</span>( widget ){
00156             <span class="comment">/* ATTENTION: Using the layout does not work: The Legend will never get the right size then!</span>
00157 <span class="comment">            const QLayout * layout = widget-&gt;layout();</span>
00158 <span class="comment">            if( layout ){</span>
00159 <span class="comment">                size = layout-&gt;geometry().size();</span>
00160 <span class="comment">                //qDebug() &lt;&lt; "Measure::sizeOfArea() found widget with layout size" &lt;&lt; size;</span>
00161 <span class="comment">            }else*/</span>
00162             {
00163                 size = widget-&gt;geometry().size();
00164                 <span class="comment">//qDebug() &lt;&lt; "Measure::sizeOfArea() found widget with size" &lt;&lt; size;</span>
00165             }
00166         }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( mMode != KDChartEnums::MeasureCalculationModeAbsolute ){
00167             size = QSizeF(1.0, 1.0);
00168             <span class="comment">//qDebug("Measure::sizeOfArea() got no valid area.");</span>
00169         }
00170     }
00171     <span class="keyword">const</span> QPair&lt; qreal, qreal &gt; factors
00172             = GlobalMeasureScaling::instance()-&gt;currentFactors();
00173     <span class="keywordflow">return</span> QSizeF(size.width() * factors.first, size.height() * factors.second);
00174 }
00175 
00176 
<a name="l00177"></a><a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea8">00177</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea8">Measure::operator==</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_measure.html">Measure</a>&amp; r )<span class="keyword"> const</span>
00178 <span class="keyword"></span>{
00179     <span class="keywordflow">return</span>( mValue == r.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea18">value</a>() &amp;&amp;
00180             mMode  == r.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea2">calculationMode</a>() &amp;&amp;
00181             mArea  == r.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea9">referenceArea</a>() &amp;&amp;
00182             mOrientation == r.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea10">referenceOrientation</a>() );
00183 }
00184 
00185 
00186 
<a name="l00187"></a><a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinga0">00187</a> GlobalMeasureScaling::GlobalMeasureScaling()
00188 {
00189     mFactors.push( qMakePair(1.0, 1.0) );
00190 }
00191 
<a name="l00192"></a><a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinga1">00192</a> GlobalMeasureScaling::~GlobalMeasureScaling()
00193 {
00194     <span class="comment">// this space left empty intentionally</span>
00195 }
00196 
<a name="l00197"></a><a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinge1">00197</a> <a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html">GlobalMeasureScaling</a>* GlobalMeasureScaling::instance()
00198 {
00199     <span class="keyword">static</span> <a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html">GlobalMeasureScaling</a> <a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinge1">instance</a>;
00200     <span class="keywordflow">return</span> &amp;instance;
00201 }
00202 
<a name="l00203"></a><a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinge3">00203</a> <span class="keywordtype">void</span> GlobalMeasureScaling::setFactors(qreal factorX, qreal factorY)
00204 {
00205     <a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinge1">instance</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalingr0">mFactors</a>.push( qMakePair(factorX, factorY) );
00206 }
00207 
<a name="l00208"></a><a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinge2">00208</a> <span class="keywordtype">void</span> GlobalMeasureScaling::resetFactors()
00209 {
00210     <span class="comment">// never remove the initial (1.0. 1.0) setting</span>
00211     <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinge1">instance</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalingr0">mFactors</a>.count() &gt; 1 )
00212         <a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinge1">instance</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalingr0">mFactors</a>.pop();
00213 }
00214 
<a name="l00215"></a><a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinge0">00215</a> <span class="keyword">const</span> QPair&lt; qreal, qreal &gt; GlobalMeasureScaling::currentFactors()
00216 {
00217     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalinge1">instance</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#_k_d_chart_1_1_global_measure_scalingr0">mFactors</a>.top();
00218 }
00219 
00220 
00221 
00222 
00223 }
00224 
00225 <span class="preprocessor">#if !defined(QT_NO_DEBUG_STREAM)</span>
<a name="l00226"></a><a class="code" href="_k_d_chart_measure_8h.html#a0">00226</a> <span class="preprocessor"></span>QDebug <a class="code" href="_k_d_chart_three_d_pie_attributes_8h.html#a0">operator&lt;&lt;</a>(QDebug dbg, <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_measure.html">KDChart::Measure</a>&amp; m)
00227 {
00228     dbg &lt;&lt; <span class="stringliteral">"KDChart::Measure("</span>
00229         &lt;&lt; <span class="stringliteral">"value="</span>&lt;&lt;m.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea18">value</a>()
00230         &lt;&lt; <span class="stringliteral">"calculationmode="</span>&lt;&lt;m.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea2">calculationMode</a>()
00231         &lt;&lt; <span class="stringliteral">"referencearea="</span>&lt;&lt;m.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea9">referenceArea</a>()
00232         &lt;&lt; <span class="stringliteral">"referenceorientation="</span>&lt;&lt;m.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea10">referenceOrientation</a>()
00233         &lt;&lt; <span class="stringliteral">")"</span>;
00234     <span class="keywordflow">return</span> dbg;
00235 }
00236 <span class="preprocessor">#endif </span><span class="comment">/* QT_NO_DEBUG_STREAM */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu May 10 11:06:25 2007 for KD Chart 2 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
