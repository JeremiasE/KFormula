<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KD Chart 2: KDChartBarDiagram.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>KDChartBarDiagram.cpp</h1><a href="_k_d_chart_bar_diagram_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment"> ** Copyright (C) 2006 Klarï¿½vdalens Datakonsult AB.  All rights reserved.</span>
00003 <span class="comment"> **</span>
00004 <span class="comment"> ** This file is part of the KD Chart library.</span>
00005 <span class="comment"> **</span>
00006 <span class="comment"> ** This file may be distributed and/or modified under the terms of the</span>
00007 <span class="comment"> ** GNU General Public License version 2 as published by the Free Software</span>
00008 <span class="comment"> ** Foundation and appearing in the file LICENSE.GPL included in the</span>
00009 <span class="comment"> ** packaging of this file.</span>
00010 <span class="comment"> **</span>
00011 <span class="comment"> ** Licensees holding valid commercial KD Chart licenses may use this file in</span>
00012 <span class="comment"> ** accordance with the KD Chart Commercial License Agreement provided with</span>
00013 <span class="comment"> ** the Software.</span>
00014 <span class="comment"> **</span>
00015 <span class="comment"> ** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00016 <span class="comment"> ** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00017 <span class="comment"> **</span>
00018 <span class="comment"> ** See http://www.kdab.net/kdchart for</span>
00019 <span class="comment"> **   information about KDChart Commercial License Agreements.</span>
00020 <span class="comment"> **</span>
00021 <span class="comment"> ** Contact info@kdab.net if any conditions of this</span>
00022 <span class="comment"> ** licensing are not clear to you.</span>
00023 <span class="comment"> **</span>
00024 <span class="comment"> **********************************************************************/</span>
00025 
00026 <span class="preprocessor">#include &lt;QPainter&gt;</span>
00027 <span class="preprocessor">#include &lt;QDebug&gt;</span>
00028 
00029 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_bar_diagram_8h.html">KDChartBarDiagram.h</a>"</span>
00030 <span class="preprocessor">#include "KDChartBarDiagram_p.h"</span>
00031 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_three_d_bar_attributes_8h.html">KDChartThreeDBarAttributes.h</a>"</span>
00032 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_position_8h.html">KDChartPosition.h</a>"</span>
00033 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_attributes_model_8h.html">KDChartAttributesModel.h</a>"</span>
00034 <span class="preprocessor">#include "KDChartAbstractGrid.h"</span>
00035 
00036 <span class="preprocessor">#include &lt;KDABLibFakes&gt;</span>
00037 
00038 
00039 <span class="keyword">using</span> <span class="keyword">namespace </span>KDChart;
00040 
00041 BarDiagram::Private::Private()
00042     : barType( Normal )
00043     , maxDepth ( 0 )
00044 {
00045 }
00046 
00047 BarDiagram::Private::~Private() {}
00048 
<a name="l00049"></a><a class="code" href="_k_d_chart_bar_diagram_8cpp.html#a0">00049</a> <span class="preprocessor">#define d d_func()</span>
00050 <span class="preprocessor"></span>
00051 
<a name="l00052"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama8">00052</a> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama8">BarDiagram::BarDiagram</a>( <a class="code" href="class_q_widget.html">QWidget</a>* parent, <a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html">CartesianCoordinatePlane</a>* plane ) :
00053     <a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html">AbstractCartesianDiagram</a>( new Private(), parent, plane )
00054 {
00055     init();
00056 }
00057 
00058 <span class="keywordtype">void</span> BarDiagram::init()
00059 {
00060 }
00061 
<a name="l00062"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama91">00062</a> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama91">BarDiagram::~BarDiagram</a>()
00063 {
00064 }
00065 
<a name="l00066"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama12">00066</a> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html">BarDiagram</a> * <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama12">BarDiagram::clone</a>()<span class="keyword"> const</span>
00067 <span class="keyword"></span>{
00068     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama8">BarDiagram</a>( <span class="keyword">new</span> Private( *<a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a> ) );
00069 }
00070 
<a name="l00071"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama77">00071</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama77">BarDiagram::setType</a>( <span class="keyword">const</span> BarType type )
00072 {
00073     <span class="keywordflow">if</span> ( type == <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;barType ) <span class="keywordflow">return</span>;
00074 
00075     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;barType = type;
00076     <span class="comment">// AbstractAxis settings - see AbstractDiagram and CartesianAxis</span>
00077     <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama66">setPercentMode</a>( type == BarDiagram::Percent );
00078     <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb13">setDataBoundariesDirty</a>();
00079     emit layoutChanged( <span class="keyword">this</span> );
00080 }
00081 
<a name="l00082"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama82">00082</a> BarDiagram::BarType <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama82">BarDiagram::type</a>()<span class="keyword"> const</span>
00083 <span class="keyword"></span>{
00084    <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;barType;
00085 }
00086 
<a name="l00087"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama54">00087</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama54">BarDiagram::setBarAttributes</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_bar_attributes.html">BarAttributes</a> &amp; ta )
00088 {
00089     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setModelData( qVariantFromValue( ta ), <a class="code" href="namespace_k_d_chart.html#a21a14">BarAttributesRole</a> );
00090 }
00091 
<a name="l00092"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama53">00092</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama54">BarDiagram::setBarAttributes</a>( <span class="keywordtype">int</span> column, <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_bar_attributes.html">BarAttributes</a> &amp; ta )
00093 {
00094     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setHeaderData(
00095         column, Qt::Vertical,
00096         qVariantFromValue( ta ),
00097         <a class="code" href="namespace_k_d_chart.html#a21a14">BarAttributesRole</a> );
00098 }
00099 
<a name="l00100"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama52">00100</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama54">BarDiagram::setBarAttributes</a>( <span class="keyword">const</span> QModelIndex &amp; index, <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_bar_attributes.html">BarAttributes</a> &amp; ta )
00101 {
00102     <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama2">attributesModel</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_attributes_model.html#_k_d_chart_1_1_private_attributes_modela19">setData</a>(
00103         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource( index ),
00104         qVariantFromValue( ta ),
00105         <a class="code" href="namespace_k_d_chart.html#a21a14">BarAttributesRole</a> );
00106 }
00107 
<a name="l00108"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama7">00108</a> <a class="code" href="class_k_d_chart_1_1_bar_attributes.html">BarAttributes</a> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama7">BarDiagram::barAttributes</a>()<span class="keyword"> const</span>
00109 <span class="keyword"></span>{
00110     <span class="keywordflow">return</span> qVariantValue&lt;BarAttributes&gt;(
00111         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data( KDChart::BarAttributesRole ) );
00112 }
00113 
<a name="l00114"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama6">00114</a> <a class="code" href="class_k_d_chart_1_1_bar_attributes.html">BarAttributes</a> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama7">BarDiagram::barAttributes</a>( <span class="keywordtype">int</span> column )<span class="keyword"> const</span>
00115 <span class="keyword"></span>{
00116     <span class="keywordflow">return</span> qVariantValue&lt;BarAttributes&gt;(
00117         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data(
00118             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource( columnToIndex( column ) ),
00119             KDChart::BarAttributesRole ) );
00120 }
00121 
<a name="l00122"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama5">00122</a> <a class="code" href="class_k_d_chart_1_1_bar_attributes.html">BarAttributes</a> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama7">BarDiagram::barAttributes</a>( <span class="keyword">const</span> QModelIndex &amp; index )<span class="keyword"> const</span>
00123 <span class="keyword"></span>{
00124     <span class="keywordflow">return</span> qVariantValue&lt;BarAttributes&gt;(
00125         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data(
00126             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource( index ),
00127             KDChart::BarAttributesRole ) );
00128 }
00129 
<a name="l00130"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama76">00130</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama76">BarDiagram::setThreeDBarAttributes</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_three_d_bar_attributes.html">ThreeDBarAttributes</a> &amp; threeDAttrs )
00131 {
00132     <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb13">setDataBoundariesDirty</a>();
00133     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setModelData( qVariantFromValue( threeDAttrs ), <a class="code" href="namespace_k_d_chart.html#a21a15">ThreeDBarAttributesRole</a> );
00134     emit layoutChanged( <span class="keyword">this</span> );
00135 }
00136 
<a name="l00137"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama75">00137</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama76">BarDiagram::setThreeDBarAttributes</a>( <span class="keywordtype">int</span> column, <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_three_d_bar_attributes.html">ThreeDBarAttributes</a> &amp; threeDAttrs )
00138 {
00139     <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb13">setDataBoundariesDirty</a>();
00140     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setHeaderData(
00141         column, Qt::Vertical,
00142         qVariantFromValue( threeDAttrs ),
00143         <a class="code" href="namespace_k_d_chart.html#a21a15">ThreeDBarAttributesRole</a> );
00144     emit layoutChanged( <span class="keyword">this</span> );
00145 }
00146 
<a name="l00147"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama74">00147</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama76">BarDiagram::setThreeDBarAttributes</a>( <span class="keyword">const</span> QModelIndex &amp; index, <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_three_d_bar_attributes.html">ThreeDBarAttributes</a> &amp; threeDAttrs )
00148 {
00149     <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb13">setDataBoundariesDirty</a>();
00150     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setData(
00151         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource(index),
00152         qVariantFromValue( threeDAttrs ),
00153         <a class="code" href="namespace_k_d_chart.html#a21a15">ThreeDBarAttributesRole</a> );
00154     emit layoutChanged( <span class="keyword">this</span> );
00155 }
00156 
<a name="l00157"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama81">00157</a> <a class="code" href="class_k_d_chart_1_1_three_d_bar_attributes.html">ThreeDBarAttributes</a> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama81">BarDiagram::threeDBarAttributes</a>()<span class="keyword"> const</span>
00158 <span class="keyword"></span>{
00159     <span class="keywordflow">return</span> qVariantValue&lt;ThreeDBarAttributes&gt;(
00160         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data( KDChart::ThreeDBarAttributesRole ) );
00161 }
00162 
<a name="l00163"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama80">00163</a> <a class="code" href="class_k_d_chart_1_1_three_d_bar_attributes.html">ThreeDBarAttributes</a> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama81">BarDiagram::threeDBarAttributes</a>( <span class="keywordtype">int</span> column )<span class="keyword"> const</span>
00164 <span class="keyword"></span>{
00165     <span class="keywordflow">return</span> qVariantValue&lt;ThreeDBarAttributes&gt;(
00166         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data(
00167             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource( columnToIndex( column ) ),
00168             KDChart::ThreeDBarAttributesRole ) );
00169 }
00170 
<a name="l00171"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama79">00171</a> <a class="code" href="class_k_d_chart_1_1_three_d_bar_attributes.html">ThreeDBarAttributes</a> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama81">BarDiagram::threeDBarAttributes</a>( <span class="keyword">const</span> QModelIndex &amp; index )<span class="keyword"> const</span>
00172 <span class="keyword"></span>{
00173     <span class="keywordflow">return</span> qVariantValue&lt;ThreeDBarAttributes&gt;(
00174         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data(
00175             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource(index),
00176             KDChart::ThreeDBarAttributesRole ) );
00177 }
00178 
<a name="l00179"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagramb14">00179</a> <span class="keywordtype">double</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagramb14">BarDiagram::threeDItemDepth</a>( <span class="keyword">const</span> QModelIndex &amp; index )<span class="keyword"> const</span>
00180 <span class="keyword"></span>{
00181     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama81">threeDBarAttributes</a>( index ).<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa13">validDepth</a>();
00182 }
00183 
<a name="l00184"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagramb13">00184</a> <span class="keywordtype">double</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagramb14">BarDiagram::threeDItemDepth</a>( <span class="keywordtype">int</span> column )<span class="keyword"> const</span>
00185 <span class="keyword"></span>{
00186     <span class="keywordflow">return</span> qVariantValue&lt;ThreeDBarAttributes&gt;(
00187         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;headerData (
00188             column,
00189             Qt::Vertical,
00190             KDChart::ThreeDBarAttributesRole ) ).validDepth();
00191 }
00192 
<a name="l00193"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagramb10">00193</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagramb10">BarDiagram::resizeEvent</a> ( QResizeEvent*)
00194 {
00195 
00196 }
00197 
<a name="l00198"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagramb1">00198</a> <span class="keyword">const</span> QPair&lt;QPointF, QPointF&gt; <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagramb1">BarDiagram::calculateDataBoundaries</a>()<span class="keyword"> const</span>
00199 <span class="keyword"></span>{
00200     <span class="keywordflow">if</span> ( !<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb2">checkInvariants</a>(<span class="keyword">true</span>) ) <span class="keywordflow">return</span> QPair&lt;QPointF, QPointF&gt;( QPointF( 0, 0 ), QPointF( 0, 0 ) );
00201     <span class="keyword">const</span> <span class="keywordtype">int</span> rowCount = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;rowCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00202     <span class="keyword">const</span> <span class="keywordtype">int</span> colCount = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;columnCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00203 
00204     <span class="keywordtype">double</span> xMin = 0;
00205     <span class="keywordtype">double</span> xMax = rowCount;
00206     <span class="keywordtype">double</span> yMin = 0, yMax = 0;
00207     <span class="comment">//double maxThreeDDepth   = 0.0;</span>
00208 
00209 
00210     <span class="comment">// calculate boundaries for  different line types Normal - Stacked - Percent - Default Normal</span>
00211     <span class="keywordflow">switch</span> ( <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama82">type</a>() ){
00212         <span class="keywordflow">case</span> BarDiagram::Normal:
00213         {
00214             <span class="keywordtype">bool</span> bStarting = <span class="keyword">true</span>;
00215             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;colCount; ++i ) {
00216                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt; rowCount; ++j ) {
00217                     <span class="keyword">const</span> <span class="keywordtype">double</span> value = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;index( j, i, attributesModelRootIndex() ) ).toDouble();
00218                     <span class="comment">// this is always true yMin can be 0 in case all values</span>
00219                     <span class="comment">// are the same</span>
00220                     <span class="comment">// same for yMax it can be zero if all values are negative</span>
00221                     <span class="keywordflow">if</span>( bStarting ){
00222                         yMin = value;
00223                         yMax = value;
00224                         bStarting = <span class="keyword">false</span>;
00225                     }<span class="keywordflow">else</span>{
00226                         yMin = qMin( yMin, value );
00227                         yMax = qMax( yMax, value );
00228                     }
00229                 }
00230             }
00231         }
00232             <span class="keywordflow">break</span>;
00233         <span class="keywordflow">case</span> BarDiagram::Stacked:
00234         {
00235             <span class="keywordtype">bool</span> bStarting = <span class="keyword">true</span>;
00236             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt; rowCount; ++j ) {
00237                 <span class="comment">// calculate sum of values per column - Find out stacked Min/Max</span>
00238                 <span class="keywordtype">double</span> stackedValues = 0;
00239                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;colCount ; ++i ) {
00240                     QModelIndex idx = model()-&gt;index( j, i, rootIndex() );
00241                     stackedValues +=  model()-&gt;data( idx ).toDouble();
00242                     <span class="comment">// this is always true yMin can be 0 in case all values</span>
00243                     <span class="comment">// are the same</span>
00244                     <span class="comment">// same for yMax it can be zero if all values are negative</span>
00245                     <span class="keywordflow">if</span>( bStarting ){
00246                         yMin = stackedValues;
00247                         yMax = stackedValues;
00248                         bStarting = <span class="keyword">false</span>;
00249                     }<span class="keywordflow">else</span>{
00250                         yMin = qMin( yMin, stackedValues );
00251                         yMax = qMax( yMax, stackedValues );
00252                     }
00253                 }
00254             }
00255         }
00256             <span class="keywordflow">break</span>;
00257         <span class="keywordflow">case</span> BarDiagram::Percent:
00258         {
00259             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;colCount; ++i ) {
00260                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt; rowCount; ++j ) {
00261                     <span class="comment">// Ordinate should begin at 0 the max value being the 100% pos</span>
00262                     QModelIndex idx = model()-&gt;index( j, i, rootIndex() );
00263                     <span class="comment">// only positive values are handled</span>
00264                     <span class="keywordtype">double</span> value = model()-&gt;data( idx ).toDouble();
00265                     <span class="keywordflow">if</span> ( value &gt; 0 )
00266                         yMax = qMax( yMax, value );
00267                 }
00268             }
00269         }
00270             <span class="keywordflow">break</span>;
00271         <span class="keywordflow">case</span> BarDiagram::Rows:
00272         {
00273             qDebug()&lt;&lt; <span class="stringliteral">"KDChartBarDiagram::calculateDataBoundaries"</span>
00274                     &lt;&lt; <span class="stringliteral">"Sorry Type Rows not implemented yet"</span>;
00275             <span class="keywordflow">break</span>;
00276         }
00277 
00278 
00279         <span class="keywordflow">default</span>:
00280              Q_ASSERT_X ( <span class="keyword">false</span>, <span class="stringliteral">"calculateDataBoundaries()"</span>,
00281                          <span class="stringliteral">"Type item does not match a defined bar chart Type."</span> );
00282     }
00283 
00284     <span class="comment">// special cases</span>
00285     <span class="keywordflow">if</span> (  yMax == yMin ) {
00286         <span class="keywordflow">if</span> ( yMin == 0.0 )
00287             yMax = 0.1; <span class="comment">//we need at list a range</span>
00288         <span class="keywordflow">else</span>
00289             yMax = 0.0; <span class="comment">// they are the same but negative</span>
00290     }
00291     QPointF bottomLeft ( QPointF( xMin, yMin ) );
00292     QPointF topRight ( QPointF( xMax, yMax ) );
00293 
00294     <span class="comment">//qDebug() &lt;&lt; "BarDiagram::calculateDataBoundaries () returns ( " &lt;&lt; bottomLeft &lt;&lt; topRight &lt;&lt;")";</span>
00295     <span class="keywordflow">return</span> QPair&lt;QPointF, QPointF&gt; ( bottomLeft,  topRight );
00296 }
00297 
00298 <span class="comment">/*</span>
00299 <span class="comment">void BarDiagram::paintEvent ( QPaintEvent*)</span>
00300 <span class="comment">{</span>
00301 <span class="comment">    qDebug() &lt;&lt; "BarDiagram::paintEvent";</span>
00302 <span class="comment">    QPainter painter ( viewport() );</span>
00303 <span class="comment">    PaintContext ctx;</span>
00304 <span class="comment">    ctx.setPainter ( &amp;painter );</span>
00305 <span class="comment">    ctx.setRectangle( QRectF ( 0, 0, width(), height() ) );</span>
00306 <span class="comment">    paint ( &amp;ctx );</span>
00307 <span class="comment">}*/</span>
00308 
00309 
00310 <span class="keywordtype">void</span> BarDiagram::calculateValueAndGapWidths( <span class="keywordtype">int</span> rowCount,<span class="keywordtype">int</span> colCount,
00311                                              <span class="keywordtype">double</span> groupWidth,
00312                                              <span class="keywordtype">double</span>&amp; outBarWidth,
00313                                              <span class="keywordtype">double</span>&amp; outSpaceBetweenBars,
00314                                              <span class="keywordtype">double</span>&amp; outSpaceBetweenGroups )
00315 {
00316     Q_UNUSED( rowCount );
00317 
00318     <a class="code" href="class_k_d_chart_1_1_bar_attributes.html">BarAttributes</a> ba = <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama7">barAttributes</a>( model()-&gt;index( 0, 0, rootIndex() ) );
00319 
00320     <span class="comment">// Pending Michel Fixme</span>
00321     <span class="comment">/* We are colCount groups to paint. Each group is centered around the</span>
00322 <span class="comment">     * horizontal point position on the grid. The full area covers the</span>
00323 <span class="comment">     * values -1 to colCount + 1. A bar has a relative width of one unit,</span>
00324 <span class="comment">     * the gaps between bars are 0.5 wide, and the gap between groups is</span>
00325 <span class="comment">     * also one unit, by default. */</span>
00326 
00327     <span class="keyword">const</span> <span class="keywordtype">double</span> units = colCount <span class="comment">// number of bars in group * 1.0</span>
00328         + (colCount-1) * ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa2">barGapFactor</a>() <span class="comment">// number of bar gaps</span>
00329         + 1 * ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa7">groupGapFactor</a>(); <span class="comment">// number of group gaps</span>
00330 
00331     <span class="keywordtype">double</span> unitWidth = groupWidth / units;
00332     outBarWidth = unitWidth;
00333     outSpaceBetweenBars += unitWidth * ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa2">barGapFactor</a>();
00334     <span class="comment">// Pending Michel - minLimit: allow space between bars to be reduced until the bars are displayed next to each other.</span>
00335     <span class="comment">// is that what we want?</span>
00336     <span class="keywordflow">if</span> ( outSpaceBetweenBars &lt; 0 )
00337         outSpaceBetweenBars = 0;
00338     outSpaceBetweenGroups += unitWidth * ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa7">groupGapFactor</a>();
00339 }
00340 
<a name="l00341"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagramb6">00341</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagramb6">BarDiagram::paint</a>( <a class="code" href="class_k_d_chart_1_1_paint_context.html">PaintContext</a>* ctx )
00342 {
00343     <span class="comment">// note: Not having any data model assigned is no bug</span>
00344     <span class="comment">//       but we can not draw a diagram then either.</span>
00345     <span class="keywordflow">if</span> ( !<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb2">checkInvariants</a>(<span class="keyword">true</span>) )
00346         <span class="keywordflow">return</span>;
00347 
00348     <span class="comment">// Calculate width</span>
00349     QPointF boundLeft, boundRight;
00350     QPair&lt;QPointF,QPointF&gt; boundaries = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama10">dataBoundaries</a>();
00351     <span class="keywordflow">if</span>( !AbstractGrid::isBoundariesValid(boundaries) ) <span class="keywordflow">return</span>;
00352 
00353     <a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html">CartesianCoordinatePlane</a>* plane = dynamic_cast&lt;KDChart::CartesianCoordinatePlane*&gt;( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>() );
00354     <span class="keywordflow">if</span>( ! plane ) <span class="keywordflow">return</span>;
00355 
00356     boundLeft = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( boundaries.first );
00357     boundRight = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( boundaries.second );
00358     <span class="keywordtype">double</span> width = boundRight.x() - boundLeft.x();
00359     <span class="comment">//calculates and stores the values</span>
00360     <span class="keyword">const</span> <span class="keywordtype">int</span> rowCount = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;rowCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00361     <span class="keyword">const</span> <span class="keywordtype">int</span> colCount = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;columnCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00362     DataValueTextInfoList list;
00363     <a class="code" href="class_k_d_chart_1_1_bar_attributes.html">BarAttributes</a> ba = <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama7">barAttributes</a>( model()-&gt;index( 0, 0, rootIndex() ) );
00364     <span class="keywordtype">double</span> barWidth = 0;
00365     <span class="keywordtype">double</span> maxDepth = 0;
00366     <span class="keywordtype">double</span> spaceBetweenBars = 0;
00367     <span class="keywordtype">double</span> spaceBetweenGroups = 0;
00368     <span class="keywordtype">double</span> groupWidth =  <span class="comment">/*ctx-&gt;rectangle().width() / ( rowCount + 2 )*/</span> width/ (rowCount + 2);
00369 
00370 
00371     <span class="keywordflow">if</span> ( ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa20">useFixedBarWidth</a>() ) {
00372         barWidth = ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa4">fixedBarWidth</a>();
00373         groupWidth += barWidth;
00374 
00375         <span class="comment">// Pending Michel set a min and max value for the groupWidth related to the area.width</span>
00376         <span class="comment">// FixMe</span>
00377         <span class="keywordflow">if</span> ( groupWidth &lt; 0 )
00378             groupWidth = 0;
00379 
00380         <span class="keywordflow">if</span> ( groupWidth  * rowCount &gt; ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta3">rectangle</a>().width() )
00381             groupWidth = ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta3">rectangle</a>().width() / rowCount;
00382     }
00383 
00384     <span class="comment">// maxLimit: allow the space between bars to be larger until area.width() is covered by the groups.</span>
00385     <span class="keywordtype">double</span> maxLimit = rowCount * (groupWidth + ((colCount-1) * ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa5">fixedDataValueGap</a>()) );
00386 
00387     <span class="comment">//Pending Michel: FixMe</span>
00388     <span class="keywordflow">if</span> ( ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa21">useFixedDataValueGap</a>() ) {
00389         <span class="keywordflow">if</span> ( ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta3">rectangle</a>().width() &gt; maxLimit )
00390             spaceBetweenBars += ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa5">fixedDataValueGap</a>();
00391         <span class="keywordflow">else</span>
00392             spaceBetweenBars = ((ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta3">rectangle</a>().width()/rowCount) - groupWidth)/(colCount-1);
00393    }
00394 
00395     <span class="comment">//Pending Michel: FixMe</span>
00396     <span class="keywordflow">if</span> ( ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa22">useFixedValueBlockGap</a>() )
00397         spaceBetweenGroups += ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa6">fixedValueBlockGap</a>();
00398 
00399     calculateValueAndGapWidths( rowCount, colCount,groupWidth,
00400                                 barWidth, spaceBetweenBars, spaceBetweenGroups );
00401 
00402     <span class="comment">// paint different bar types: Normal - Stacked - Percent</span>
00403     <span class="keywordflow">switch</span> ( <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama82">type</a>() )
00404         {
00405         <span class="keywordflow">case</span> BarDiagram::Normal:
00406         {
00407             <span class="comment">// we paint the bars for all series next to each other, then move to the next value</span>
00408             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;rowCount; ++i ) {
00409                 <span class="keywordtype">double</span> offset = -groupWidth/2 + spaceBetweenGroups/2;
00410                 <span class="comment">// case fixed data value gap - handles max and min limits as well</span>
00411                 <span class="keywordflow">if</span> ( ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa21">useFixedDataValueGap</a>() ) {
00412                     <span class="keywordflow">if</span> ( spaceBetweenBars &gt; 0 ) {
00413                       <span class="keywordflow">if</span> ( ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta3">rectangle</a>().width() &gt; maxLimit )
00414                             offset -= ba.<a class="code" href="class_k_d_chart_1_1_bar_attributes.html#_k_d_chart_1_1_bar_attributesa5">fixedDataValueGap</a>();
00415                       <span class="keywordflow">else</span>
00416                         offset -= ((ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta3">rectangle</a>().width()/rowCount) - groupWidth)/(colCount-1);
00417 
00418                     } <span class="keywordflow">else</span> {
00419                         <span class="comment">//allow reducing the gap until the bars are displayed next to each other - null gap</span>
00420                         offset += barWidth/2;
00421                     }
00422                 }
00423 
00424                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt; colCount; ++j ) {
00425                     <span class="comment">// paint one group</span>
00426                     <span class="keyword">const</span> qreal value = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;index( i, j, attributesModelRootIndex() ) ).toDouble();
00427                     QPointF topPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF( i + 0.5, value ) );
00428                     QPointF bottomPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF( i, 0 ) );
00429                     <span class="keyword">const</span> <span class="keywordtype">double</span> barHeight = bottomPoint.y() - topPoint.y();
00430                     topPoint.setX( topPoint.x() + offset );
00431 
00432                     <span class="keyword">const</span> QModelIndex index = model()-&gt;index( i, j, rootIndex() );
00433 
00434                     <span class="comment">//PENDING Michel: FIXME barWidth</span>
00435                     <span class="keyword">const</span> QRectF rect( topPoint, QSizeF( barWidth, barHeight ) );
00436                     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;appendDataValueTextInfoToList( <span class="keyword">this</span>, list, index, <a class="code" href="class_k_d_chart_1_1_position_points.html">PositionPoints</a>( rect ),
00437                             Position::NorthWest, Position::SouthEast,
00438                             value );
00439                     paintBars( ctx, index, rect, maxDepth );
00440 
00441                     offset += barWidth + spaceBetweenBars;
00442                 }
00443             }
00444         }
00445             <span class="keywordflow">break</span>;
00446         <span class="keywordflow">case</span> BarDiagram::Stacked:
00447         {
00448            <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i&lt;colCount; ++i ) {
00449                <span class="keywordtype">double</span> offset = spaceBetweenGroups;
00450                <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j&lt; rowCount; ++j ) {
00451                    QModelIndex index = model()-&gt;index( j, i, rootIndex() );
00452                    <a class="code" href="class_k_d_chart_1_1_three_d_bar_attributes.html">ThreeDBarAttributes</a> threeDAttrs = <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama81">threeDBarAttributes</a>( index );
00453                    <span class="keywordtype">double</span> value = 0, stackedValues = 0;
00454                    QPointF point, previousPoint;
00455 
00456                    <span class="keywordflow">if</span> ( threeDAttrs.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa1">isEnabled</a>() ) {
00457                        <span class="keywordflow">if</span> ( barWidth &gt; 0 )
00458                            barWidth =  (width - ((offset+(threeDAttrs.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa0">depth</a>()))*rowCount))/ rowCount;
00459                        <span class="keywordflow">if</span> ( barWidth &lt;= 0 ) {
00460                            barWidth = 0;
00461                            maxDepth = offset - (width/rowCount);
00462                        }
00463                    } <span class="keywordflow">else</span>
00464                        barWidth =  (ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta3">rectangle</a>().width() - (offset*rowCount))/ rowCount ;
00465 
00466                    value = model()-&gt;data( index ).toDouble();
00467                    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> k = i; k &gt;= 0 ; --k )
00468                        stackedValues += model()-&gt;data( model()-&gt;index( j, k, rootIndex() ) ).toDouble();
00469                    point = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF( j, stackedValues ) );
00470                    point.setX( point.x() + offset/2 );
00471                    previousPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF( j, stackedValues - value ) );
00472                    <span class="keyword">const</span> <span class="keywordtype">double</span> barHeight = previousPoint.y() - point.y();
00473 
00474                    <span class="keyword">const</span> QRectF rect( point, QSizeF( barWidth , barHeight ) );
00475                    <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;appendDataValueTextInfoToList( <span class="keyword">this</span>, list, index, <a class="code" href="class_k_d_chart_1_1_position_points.html">PositionPoints</a>( rect ),
00476                            Position::NorthWest, Position::SouthEast,
00477                            value );
00478                    paintBars( ctx, index, rect, maxDepth );
00479                }
00480 
00481            }
00482         }
00483            <span class="keywordflow">break</span>;
00484         <span class="keywordflow">case</span> BarDiagram::Percent:
00485         {
00486             <span class="keywordtype">double</span> maxValue = 100; <span class="comment">// always 100 %</span>
00487             <span class="keywordtype">double</span> sumValues = 0;
00488             QVector &lt;double &gt; sumValuesVector;
00489 
00490             <span class="comment">//calculate sum of values for each column and store</span>
00491             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt;rowCount; ++j ) {
00492                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;colCount; ++i ) {
00493                     <span class="keywordtype">double</span> tmpValue = model()-&gt;data( model()-&gt;index( j, i, rootIndex() ) ).toDouble();
00494                     <span class="keywordflow">if</span> ( tmpValue &gt; 0 )
00495                         sumValues += tmpValue;
00496                     <span class="keywordflow">if</span> ( i == colCount-1 ) {
00497                         sumValuesVector &lt;&lt;  sumValues ;
00498                         sumValues = 0;
00499                     }
00500                 }
00501             }
00502 
00503             <span class="comment">// calculate stacked percent value</span>
00504             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i&lt;colCount; ++i ) {
00505                 <span class="keywordtype">double</span> offset = spaceBetweenGroups;
00506                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt;rowCount ; ++j ) {
00507                     <span class="keywordtype">double</span> value = 0, stackedValues = 0;
00508                     QPointF point, previousPoint;
00509                     QModelIndex index = model()-&gt;index( j, i, rootIndex() );
00510                     <a class="code" href="class_k_d_chart_1_1_three_d_bar_attributes.html">ThreeDBarAttributes</a> threeDAttrs = <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama81">threeDBarAttributes</a>( index );
00511 
00512                     <span class="keywordflow">if</span> ( threeDAttrs.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa1">isEnabled</a>() ){
00513                         <span class="keywordflow">if</span> ( barWidth &gt; 0 )
00514                             barWidth =  (width - ((offset+(threeDAttrs.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa0">depth</a>()))*rowCount))/ rowCount;
00515                         <span class="keywordflow">if</span> ( barWidth &lt;= 0 ) {
00516                             barWidth = 0;
00517                             maxDepth = offset - ( width/rowCount);
00518                         }
00519                     }<span class="keywordflow">else</span>{
00520                         barWidth = (ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta3">rectangle</a>().width() - (offset*rowCount))/ rowCount;
00521                     }
00522 
00523                     value = model()-&gt;data( index ).toDouble();
00524 
00525                     <span class="comment">// calculate stacked percent value</span>
00526                     <span class="comment">// we only take in account positives values for now.</span>
00527                     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> k = i; k &gt;= 0 ; --k ) {
00528                         <span class="keywordtype">double</span> val = model()-&gt;data( model()-&gt;index( j, k, rootIndex() ) ).toDouble();
00529                         <span class="keywordflow">if</span> ( val &gt; 0)
00530                             stackedValues += val;
00531                     }
00532 
00533                     <span class="keywordflow">if</span> (  sumValuesVector.at( j ) != 0 &amp;&amp; value &gt; 0 ) {
00534                       point = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF( j,  stackedValues/sumValuesVector.at(j)* maxValue ) );
00535 
00536                         point.setX( point.x() + offset/2 );
00537 
00538                         previousPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF( j, (stackedValues - value)/sumValuesVector.at(j)* maxValue ) );
00539                     }
00540                     <span class="keyword">const</span> <span class="keywordtype">double</span> barHeight = previousPoint.y() - point.y();
00541 
00542                     <span class="keyword">const</span> QRectF rect( point, QSizeF( barWidth, barHeight ) );
00543                     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;appendDataValueTextInfoToList( <span class="keyword">this</span>, list, index, <a class="code" href="class_k_d_chart_1_1_position_points.html">PositionPoints</a>( rect ),
00544                             Position::NorthWest, Position::SouthEast,
00545                             value );
00546                     paintBars( ctx, index, rect, maxDepth );
00547 
00548                 }
00549             }
00550         }
00551         <span class="keywordflow">break</span>;
00552         <span class="keywordflow">default</span>:
00553             Q_ASSERT_X ( <span class="keyword">false</span>, <span class="stringliteral">"paint()"</span>,
00554                          <span class="stringliteral">"Type item does not match a defined bar chart Type."</span> );
00555         }
00556 
00557     <span class="comment">// paint all data value texts, but no point markers</span>
00558     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;paintDataValueTextsAndMarkers( <span class="keyword">this</span>, ctx, list, <span class="keyword">false</span> );
00559 }
00560 
00561 <span class="keywordtype">void</span> BarDiagram::paintBars( <a class="code" href="class_k_d_chart_1_1_paint_context.html">PaintContext</a>* ctx, <span class="keyword">const</span> QModelIndex&amp; index, <span class="keyword">const</span> QRectF&amp; bar, <span class="keywordtype">double</span>&amp; maxDepth )
00562 {
00563     QRectF isoRect;
00564     QPolygonF topPoints, sidePoints;
00565     <a class="code" href="class_k_d_chart_1_1_three_d_bar_attributes.html">ThreeDBarAttributes</a> threeDAttrs = <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama81">threeDBarAttributes</a>( index );
00566     <span class="keywordtype">double</span> usedDepth;
00567 
00568     <span class="comment">//Pending Michel: configure threeDBrush settings - shadowColor etc...</span>
00569     QBrush indexBrush ( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama5">brush</a>( index ) );
00570     QPen indexPen( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama37">pen</a>( index ) );
00571     PainterSaver painterSaver( ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>() );
00572     <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama1">antiAliasing</a>() )
00573         ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;setRenderHint ( QPainter::Antialiasing );
00574     ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;setBrush( indexBrush );
00575     ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;setPen( indexPen );
00576     <span class="keywordflow">if</span> ( threeDAttrs.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa1">isEnabled</a>() ) {
00577         <span class="keywordtype">bool</span> stackedMode = <span class="keyword">false</span>;
00578         <span class="keywordtype">bool</span> percentMode = <span class="keyword">false</span>;
00579         <span class="keywordtype">bool</span> paintTop = <span class="keyword">true</span>;
00580         <span class="keywordflow">if</span> ( maxDepth )
00581             threeDAttrs.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa7">setDepth</a>( -maxDepth );
00582         QPointF boundRight = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_abstract_coordinate_planea58">translate</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama10">dataBoundaries</a>().second );
00583         <span class="comment">//fixme adjust the painting to reasonable depth value</span>
00584         <span class="keywordflow">switch</span> ( <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama82">type</a>() )
00585         {
00586         <span class="keywordflow">case</span> BarDiagram::Normal:
00587             usedDepth = threeDAttrs.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa0">depth</a>()/4;
00588             stackedMode = <span class="keyword">false</span>;
00589             percentMode = <span class="keyword">false</span>;
00590             <span class="keywordflow">break</span>;
00591         <span class="keywordflow">case</span> BarDiagram::Stacked:
00592             usedDepth = threeDAttrs.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa0">depth</a>();
00593             stackedMode = <span class="keyword">true</span>;
00594             percentMode = <span class="keyword">false</span>;
00595             <span class="keywordflow">break</span>;
00596         <span class="keywordflow">case</span> BarDiagram::Percent:
00597             usedDepth = threeDAttrs.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa0">depth</a>();
00598             stackedMode = <span class="keyword">false</span>;
00599             percentMode = <span class="keyword">true</span>;
00600             <span class="keywordflow">break</span>;
00601         <span class="keywordflow">default</span>:
00602             Q_ASSERT_X ( <span class="keyword">false</span>, <span class="stringliteral">"dataBoundaries()"</span>,
00603                          <span class="stringliteral">"Type item does not match a defined bar chart Type."</span> );
00604         }
00605         isoRect =  bar.translated( usedDepth, -usedDepth );
00606         <span class="comment">// we need to find out if the height is negative</span>
00607         <span class="comment">// and in this case paint it up and down</span>
00608         <span class="comment">//qDebug() &lt;&lt; isoRect.height();</span>
00609         <span class="keywordflow">if</span> (  isoRect.height() &lt; 0 ) {
00610           topPoints &lt;&lt; isoRect.bottomLeft() &lt;&lt; isoRect.bottomRight()
00611                     &lt;&lt; bar.bottomRight() &lt;&lt; bar.bottomLeft();
00612           <span class="keywordflow">if</span> ( stackedMode ) {
00613               <span class="comment">// fix it when several negative stacked values</span>
00614               <span class="keywordflow">if</span> (  index.column() == 0 ) {
00615                   paintTop = <span class="keyword">true</span>;
00616               }
00617               <span class="keywordflow">else</span>
00618                   paintTop = <span class="keyword">false</span>;
00619           }
00620 
00621         } <span class="keywordflow">else</span> {
00622             ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;drawRect( isoRect );
00623             topPoints &lt;&lt; bar.topLeft() &lt;&lt; bar.topRight() &lt;&lt; isoRect.topRight() &lt;&lt; isoRect.topLeft();
00624         }
00625 
00626         <span class="keywordflow">if</span> ( percentMode &amp;&amp; isoRect.height() == 0 )
00627             paintTop = <span class="keyword">false</span>;
00628 
00629         <span class="keywordtype">bool</span> needToSetClippingOffForTop = <span class="keyword">false</span>;
00630         <span class="keywordflow">if</span> ( paintTop ){
00631             <span class="comment">// Draw the top, if at least one of the top's points is</span>
00632             <span class="comment">// either inside or near at the edge of the coordinate plane:</span>
00633             <span class="keywordtype">bool</span> drawIt = <span class="keyword">false</span>;
00634             <span class="keywordtype">bool</span> hasPointOutside = <span class="keyword">false</span>;
00635             <span class="keyword">const</span> QRectF r( ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta3">rectangle</a>().adjusted(0,-1,1,0) );
00636             KDAB_FOREACH( QPointF pt, topPoints ) {
00637                 <span class="keywordflow">if</span>( r.contains( pt ) )
00638                     drawIt = <span class="keyword">true</span>;
00639                 <span class="keywordflow">else</span>
00640                     hasPointOutside = <span class="keyword">true</span>;
00641             }
00642             <span class="keywordflow">if</span>( drawIt ){
00643                 needToSetClippingOffForTop = hasPointOutside &amp;&amp; ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;hasClipping();
00644                 <span class="keywordflow">if</span>( needToSetClippingOffForTop )
00645                     ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;setClipping( <span class="keyword">false</span> );
00646                 ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;drawPolygon( topPoints );
00647                 <span class="keywordflow">if</span>( needToSetClippingOffForTop )
00648                     ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;setClipping( <span class="keyword">true</span> );
00649             }
00650         }
00651 
00652 
00653 
00654         sidePoints &lt;&lt; bar.topRight() &lt;&lt; isoRect.topRight() &lt;&lt; isoRect.bottomRight() &lt;&lt; bar.bottomRight();
00655         <span class="keywordflow">if</span> (  bar.height() != 0 ){
00656             <span class="keywordflow">if</span>( needToSetClippingOffForTop )
00657                 ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;setClipping( <span class="keyword">false</span> );
00658             ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;drawPolygon( sidePoints );
00659             <span class="keywordflow">if</span>( needToSetClippingOffForTop )
00660                 ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;setClipping( <span class="keyword">true</span> );
00661         }
00662     }
00663 
00664     <span class="keywordflow">if</span> (  bar.height() != 0 )
00665         ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;drawRect( bar );
00666     <span class="comment">// reset</span>
00667     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;maxDepth = threeDAttrs.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa0">depth</a>();
00668 }
00669 
<a name="l00670"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama47">00670</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama47">BarDiagram::resize</a> ( <span class="keyword">const</span> QSizeF&amp; )
00671 {
00672 }
00673 
<a name="l00674"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama36">00674</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama36">BarDiagram::numberOfAbscissaSegments</a> ()<span class="keyword"> const</span>
00675 <span class="keyword"></span>{
00676     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;rowCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00677 }
00678 
<a name="l00679"></a><a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama37">00679</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="class_k_d_chart_1_1_bar_diagram.html#_k_d_chart_1_1_bar_diagrama37">BarDiagram::numberOfOrdinateSegments</a> ()<span class="keyword"> const</span>
00680 <span class="keyword"></span>{
00681     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;columnCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00682 }
00683 
00684 <span class="preprocessor">#undef d</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu May 10 11:06:24 2007 for KD Chart 2 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
