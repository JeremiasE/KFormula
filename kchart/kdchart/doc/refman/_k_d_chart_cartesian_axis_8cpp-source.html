<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KD Chart 2: KDChartCartesianAxis.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>KDChartCartesianAxis.cpp</h1><a href="_k_d_chart_cartesian_axis_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment"> ** Copyright (C) 2006 Klar√§vdalens Datakonsult AB.  All rights reserved.</span>
00003 <span class="comment"> **</span>
00004 <span class="comment"> ** This file is part of the KD Chart library.</span>
00005 <span class="comment"> **</span>
00006 <span class="comment"> ** This file may be distributed and/or modified under the terms of the</span>
00007 <span class="comment"> ** GNU General Public License version 2 as published by the Free Software</span>
00008 <span class="comment"> ** Foundation and appearing in the file LICENSE.GPL included in the</span>
00009 <span class="comment"> ** packaging of this file.</span>
00010 <span class="comment"> **</span>
00011 <span class="comment"> ** Licensees holding valid commercial KD Chart licenses may use this file in</span>
00012 <span class="comment"> ** accordance with the KD Chart Commercial License Agreement provided with</span>
00013 <span class="comment"> ** the Software.</span>
00014 <span class="comment"> **</span>
00015 <span class="comment"> ** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00016 <span class="comment"> ** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00017 <span class="comment"> **</span>
00018 <span class="comment"> ** See http://www.kdab.net/kdchart for</span>
00019 <span class="comment"> **   information about KD Chart Commercial License Agreements.</span>
00020 <span class="comment"> **</span>
00021 <span class="comment"> ** Contact info@kdab.net if any conditions of this</span>
00022 <span class="comment"> ** licensing are not clear to you.</span>
00023 <span class="comment"> **</span>
00024 <span class="comment"> **********************************************************************/</span>
00025 
00026 <span class="preprocessor">#include &lt;cmath&gt;</span>
00027 
00028 <span class="preprocessor">#include &lt;QtDebug&gt;</span>
00029 <span class="preprocessor">#include &lt;QPainter&gt;</span>
00030 <span class="preprocessor">#include &lt;QPen&gt;</span>
00031 <span class="preprocessor">#include &lt;QBrush&gt;</span>
00032 <span class="preprocessor">#include &lt;QApplication&gt;</span>
00033 
00034 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_paint_context_8h.html">KDChartPaintContext.h</a>"</span>
00035 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_chart_8h.html">KDChartChart.h</a>"</span>
00036 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_cartesian_axis_8h.html">KDChartCartesianAxis.h</a>"</span>
00037 <span class="preprocessor">#include "KDChartCartesianAxis_p.h"</span>
00038 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_abstract_cartesian_diagram_8h.html">KDChartAbstractCartesianDiagram.h</a>"</span>
00039 <span class="preprocessor">#include "KDChartAbstractGrid.h"</span>
00040 <span class="preprocessor">#include "KDChartPainterSaver_p.h"</span>
00041 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_layout_items_8h.html">KDChartLayoutItems.h</a>"</span>
00042 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_bar_diagram_8h.html">KDChartBarDiagram.h</a>"</span>
00043 
00044 <span class="preprocessor">#include &lt;KDABLibFakes&gt;</span>
00045 
00046 
00047 <span class="keyword">using</span> <span class="keyword">namespace </span>KDChart;
00048 
<a name="l00049"></a><a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a0">00049</a> <span class="preprocessor">#define d (d_func())</span>
00050 <span class="preprocessor"></span>
<a name="l00051"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa3">00051</a> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa3">CartesianAxis::CartesianAxis</a> ( <a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html">AbstractCartesianDiagram</a>* diagram )
00052     : <a class="code" href="class_k_d_chart_1_1_abstract_axis.html">AbstractAxis</a> ( new Private( diagram, this ), diagram )
00053 {
00054     init();
00055 }
00056 
<a name="l00057"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa57">00057</a> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa57">CartesianAxis::~CartesianAxis</a> ()
00058 {
00059     <span class="comment">// when we remove the first axis it will unregister itself and</span>
00060     <span class="comment">// propagate the next one to the primary, thus the while loop</span>
00061     <span class="keywordflow">while</span> ( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;mDiagram ) {
00062         <a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html">AbstractCartesianDiagram</a> *cd = qobject_cast&lt;AbstractCartesianDiagram*&gt;( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;mDiagram );
00063         cd-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html#_k_d_chart_1_1_line_diagrama81">takeAxis</a>( <span class="keyword">this</span> );
00064     }
00065     Q_FOREACH( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a> *diagram, <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;secondaryDiagrams ) {
00066         <a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html">AbstractCartesianDiagram</a> *cd = qobject_cast&lt;AbstractCartesianDiagram*&gt;( diagram );
00067         cd-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html#_k_d_chart_1_1_line_diagrama81">takeAxis</a>( <span class="keyword">this</span> );
00068     }
00069 }
00070 
00071 <span class="keywordtype">void</span> CartesianAxis::init ()
00072 {
00073     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;position = Bottom;
00074 }
00075 
00076 
<a name="l00077"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa6">00077</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa6">CartesianAxis::compare</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html">CartesianAxis</a>* other )<span class="keyword">const</span>
00078 {
00079     <span class="keywordflow">if</span>( other == <span class="keyword">this</span> ) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00080     <span class="keywordflow">if</span>( ! other ){
00081         <span class="comment">//qDebug() &lt;&lt; "CartesianAxis::compare() cannot compare to Null pointer";</span>
00082         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00083     }
00084     <span class="comment">/*</span>
00085 <span class="comment">    qDebug() &lt;&lt; (position()            == other-&gt;position());</span>
00086 <span class="comment">    qDebug() &lt;&lt; (titleText()           == other-&gt;titleText());</span>
00087 <span class="comment">    qDebug() &lt;&lt; (titleTextAttributes() == other-&gt;titleTextAttributes());</span>
00088 <span class="comment">    */</span>
00089     <span class="keywordflow">return</span>  ( static_cast&lt;const AbstractAxis*&gt;(<span class="keyword">this</span>)-&gt;compare( other ) ) &amp;&amp;
00090             ( position()            == other-&gt;position() ) &amp;&amp;
00091             ( titleText()           == other-&gt;titleText() ) &amp;&amp;
00092             ( titleTextAttributes() == other-&gt;titleTextAttributes() );
00093 }
00094 
00095 
<a name="l00096"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa47">00096</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa47">CartesianAxis::setTitleText</a>( <span class="keyword">const</span> QString&amp; text )
00097 {
00098     <span class="comment">//FIXME(khz): Call update al all places where axis internals are changed!</span>
00099     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleText = text;
00100     <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa22">layoutPlanes</a>();
00101 }
00102 
<a name="l00103"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa54">00103</a> QString <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa54">CartesianAxis::titleText</a>()<span class="keyword"> const</span>
00104 <span class="keyword"></span>{
00105     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleText;
00106 }
00107 
<a name="l00108"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa48">00108</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa48">CartesianAxis::setTitleTextAttributes</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> &amp;a )
00109 {
00110     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleTextAttributes = a;
00111     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;useDefaultTextAttributes = <span class="keyword">false</span>;
00112     <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa22">layoutPlanes</a>();
00113 }
00114 
<a name="l00115"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa55">00115</a> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa55">CartesianAxis::titleTextAttributes</a>()<span class="keyword"> const</span>
00116 <span class="keyword"></span>{
00117     <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa17">hasDefaultTitleTextAttributes</a>() ){
00118         <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> ta( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa52">textAttributes</a>() );
00119         <a class="code" href="class_k_d_chart_1_1_measure.html">Measure</a> me( ta.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa5">fontSize</a>() );
00120         me.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea16">setValue</a>( me.<a class="code" href="class_k_d_chart_1_1_measure.html#_k_d_chart_1_1_measurea18">value</a>() * 1.5 );
00121         ta.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa17">setFontSize</a>( me );
00122         <span class="keywordflow">return</span> ta;
00123     }
00124     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleTextAttributes;
00125 }
00126 
<a name="l00127"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa36">00127</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa36">CartesianAxis::resetTitleTextAttributes</a>()
00128 {
00129     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;useDefaultTextAttributes = <span class="keyword">true</span>;
00130     <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa22">layoutPlanes</a>();
00131 }
00132 
<a name="l00133"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa17">00133</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa17">CartesianAxis::hasDefaultTitleTextAttributes</a>()<span class="keyword"> const</span>
00134 <span class="keyword"></span>{
00135     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;useDefaultTextAttributes;
00136 }
00137 
00138 
<a name="l00139"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa44">00139</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa44">CartesianAxis::setPosition</a> ( <a class="code" href="class_k_d_chart_1_1_position.html">Position</a> p )
00140 {
00141     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;position = p;
00142     <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa22">layoutPlanes</a>();
00143 }
00144 
<a name="l00145"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">00145</a> <span class="keyword">const</span> CartesianAxis::Position <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">CartesianAxis::position</a>()<span class="keyword"> const</span>
00146 <span class="keyword"></span>{
00147     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;position;
00148 }
00149 
<a name="l00150"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa22">00150</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa22">CartesianAxis::layoutPlanes</a>()
00151 {
00152     <span class="comment">//qDebug() &lt;&lt; "CartesianAxis::layoutPlanes()";</span>
00153     <span class="keywordflow">if</span>( ! <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram() || ! <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram()-&gt;coordinatePlane() ) {
00154         <span class="comment">//qDebug() &lt;&lt; "CartesianAxis::layoutPlanes(): Sorry, found no plane.";</span>
00155         <span class="keywordflow">return</span>;
00156     }
00157     <a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html">AbstractCoordinatePlane</a>* plane = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram()-&gt;coordinatePlane();
00158     <span class="keywordflow">if</span>( plane ){
00159         plane-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_polar_coordinate_planea19">layoutPlanes</a>();
00160         <span class="comment">//qDebug() &lt;&lt; "CartesianAxis::layoutPlanes() OK";</span>
00161     }
00162 }
00163 
<a name="l00164"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">00164</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">CartesianAxis::isAbscissa</a>()<span class="keyword"> const</span>
00165 <span class="keyword"></span>{
00166     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() == <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw0">Bottom</a> || <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() == <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw4">Top</a>;
00167 }
00168 
<a name="l00169"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa20">00169</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa20">CartesianAxis::isOrdinate</a>()<span class="keyword"> const</span>
00170 <span class="keyword"></span>{
00171     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() == <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw1">Left</a> || <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() == <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw3">Right</a>;
00172 }
00173 
00174 <span class="comment">/*</span>
00175 <span class="comment">  void CartesianAxis::paintEvent( QPaintEvent* event )</span>
00176 <span class="comment">  {</span>
00177 <span class="comment">  Q_UNUSED( event );</span>
00178 <span class="comment"></span>
00179 <span class="comment">  if( ! d-&gt;diagram() || ! d-&gt;diagram()-&gt;coordinatePlane() ) return;</span>
00180 <span class="comment"></span>
00181 <span class="comment">  PaintContext context;</span>
00182 <span class="comment">  QPainter painter( this );</span>
00183 <span class="comment">  context.setPainter( &amp;painter );</span>
00184 <span class="comment">  AbstractCoordinatePlane* plane = d-&gt;diagram()-&gt;coordinatePlane();</span>
00185 <span class="comment">  context.setCoordinatePlane( plane );</span>
00186 <span class="comment">  QRectF rect = QRectF ( 1, 1, plane-&gt;width() - 3, plane-&gt;height() - 3 );</span>
00187 <span class="comment">  context.setRectangle( rect );</span>
00188 <span class="comment">  d-&gt;geometry.setSize( size() );</span>
00189 <span class="comment">  paintCtx( &amp;context );</span>
00190 <span class="comment">  }</span>
00191 <span class="comment">*/</span>
00192 
<a name="l00193"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa27">00193</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa27">CartesianAxis::paint</a>( QPainter* painter )
00194 {
00195     <span class="keywordflow">if</span>( ! <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram() || ! <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram()-&gt;coordinatePlane() ) <span class="keywordflow">return</span>;
00196     <a class="code" href="class_k_d_chart_1_1_paint_context.html">PaintContext</a> ctx;
00197     ctx.<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta5">setPainter</a> ( painter );
00198     ctx.<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta4">setCoordinatePlane</a>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram()-&gt;coordinatePlane() );
00199     <span class="keyword">const</span> QRect rect( <a class="code" href="class_k_d_chart_1_1_abstract_area.html#_k_d_chart_1_1_polar_coordinate_planeb0">areaGeometry</a>() );
00200 
00201     <span class="comment">//qDebug() &lt;&lt; "CartesianAxis::paint( QPainter* painter )  " &lt;&lt; " areaGeometry()():" &lt;&lt; rect &lt;&lt; " sizeHint():" &lt;&lt; sizeHint();</span>
00202 
00203     ctx.<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta6">setRectangle</a>(
00204         QRectF (
00205             <span class="comment">//QPointF(0, 0),</span>
00206             QPointF(rect.left(), rect.top()),
00207             QSizeF(rect.width(), rect.height() ) ) );
00208     <span class="comment">// enabling clipping so that we're not drawing outside</span>
00209     QRegion clipRegion( rect.adjusted( -1, -1, 1, 1 ) );
00210     painter-&gt;save();
00211     painter-&gt;setClipRegion( clipRegion );
00212     <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa30">paintCtx</a>( &amp;ctx );
00213     painter-&gt;restore();
00214     <span class="comment">//qDebug() &lt;&lt; "KDChart::CartesianAxis::paint() done.";</span>
00215 }
00216 
00217 <span class="keywordtype">void</span> CartesianAxis::Private::drawSubUnitRulers( QPainter* painter, <a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html">CartesianCoordinatePlane</a>* plane, <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_data_dimension.html">DataDimension</a>&amp; dim,
00218                                                 <span class="keyword">const</span> QPointF&amp; rulerRef, <span class="keyword">const</span> QVector&lt;int&gt;&amp; drawnTicks )<span class="keyword"> const</span>
00219 <span class="keyword"></span>{
00220     <span class="keyword">const</span> QRect geoRect( axis()-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa15">geometry</a>() );
00221     <span class="keywordtype">int</span> nextMayBeTick = 0;
00222     <span class="keywordtype">int</span> mayBeTick = 0;
00223     <span class="keywordtype">int</span> logSubstep = 0;
00224     <span class="keywordtype">float</span> f = dim.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono4">start</a>;
00225     qreal fLogSubstep = f;
00226     <span class="keyword">const</span> <span class="keywordtype">bool</span> isAbscissa = axis()-&gt;isAbscissa();
00227     <span class="keyword">const</span> <span class="keywordtype">bool</span> isLogarithmic = (dim.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono0">calcMode</a> == AbstractCoordinatePlane::Logarithmic );
00228     <span class="keyword">const</span> <span class="keywordtype">int</span> subUnitTickLength = axis()-&gt;tickLength( <span class="keyword">true</span> );
00229     <span class="keywordflow">while</span> ( f &lt;= dim.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono1">end</a> ) {
00230         <span class="keywordflow">if</span>( drawnTicks.count() &gt; nextMayBeTick )
00231             mayBeTick = drawnTicks[ nextMayBeTick ];
00232         <span class="keywordflow">if</span> ( isAbscissa ) {
00233             <span class="comment">// for the x-axis</span>
00234             QPointF topPoint ( f, 0 );
00235             QPointF bottomPoint ( f, 0 );
00236             <span class="comment">// we don't draw the sub ticks, if we are at the same position as a normal tick</span>
00237             topPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( topPoint );
00238             bottomPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( bottomPoint );
00239             topPoint.setY( rulerRef.y() + subUnitTickLength );
00240             bottomPoint.setY( rulerRef.y() );
00241             <span class="keywordflow">if</span>( qAbs( mayBeTick - topPoint.x() ) &gt; 1 )
00242                 painter-&gt;drawLine( topPoint, bottomPoint );
00243             <span class="keywordflow">else</span> {
00244                 ++nextMayBeTick;
00245             }
00246         } <span class="keywordflow">else</span> {
00247             <span class="comment">// for the y-axis</span>
00248             QPointF leftPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF( 0, f ) );
00249             <span class="comment">//qDebug() &lt;&lt; "geoRect:" &lt;&lt; geoRect &lt;&lt; "   geoRect.top()" &lt;&lt; geoRect.top() &lt;&lt; "geoRect.bottom()" &lt;&lt; geoRect.bottom() &lt;&lt; "  translatedValue:" &lt;&lt; translatedValue;</span>
00250             <span class="comment">// we don't draw the sub ticks, if we are at the same position as a normal tick</span>
00251             <span class="keywordflow">if</span>( qAbs( mayBeTick - leftPoint.y() ) &gt; 1 ){
00252                 <span class="keyword">const</span> qreal translatedValue = leftPoint.y();
00253                 <span class="keywordflow">if</span>( translatedValue &gt; geoRect.top() &amp;&amp; translatedValue &lt;= geoRect.bottom() ){
00254                     QPointF rightPoint ( 0, f );
00255                     rightPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( rightPoint );
00256                     leftPoint.setX( rulerRef.x() + subUnitTickLength );
00257                     rightPoint.setX( rulerRef.x() );
00258                     painter-&gt;drawLine( leftPoint, rightPoint );
00259                 }
00260             } <span class="keywordflow">else</span> {
00261                 ++nextMayBeTick;
00262             }
00263         }
00264         <span class="keywordflow">if</span> ( isLogarithmic ){
00265             <span class="keywordflow">if</span>( logSubstep == 9 ){
00266                 fLogSubstep *= 10.0;
00267                 logSubstep = 0;
00268             }
00269             f += fLogSubstep;
00270             ++logSubstep;
00271         }<span class="keywordflow">else</span>{
00272             f += dim.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono6">subStepWidth</a>;
00273         }
00274     }
00275 }
00276 
00277 
00278 <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> CartesianAxis::Private::titleTextAttributesWithAdjustedRotation()<span class="keyword"> const</span>
00279 <span class="keyword"></span>{
00280     <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> titleTA( titleTextAttributes );
00281     <span class="keywordflow">if</span>( axis()-&gt;isOrdinate() ){
00282         <span class="keywordtype">int</span> rotation = titleTA.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa13">rotation</a>() + 270;
00283         <span class="keywordflow">if</span>( rotation &gt;= 360 )
00284             rotation -= 360;
00285 
00286         <span class="comment">// limit the allowed values to 0, 90, 180, 270:</span>
00287         <span class="keywordflow">if</span>( rotation  &lt; 90 )
00288             rotation = 0;
00289         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rotation  &lt; 180 )
00290             rotation = 90;
00291         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rotation  &lt; 270 )
00292             rotation = 180;
00293         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rotation  &lt; 360 )
00294             rotation = 270;
00295         <span class="keywordflow">else</span>
00296             rotation = 0;
00297 
00298         titleTA.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa20">setRotation</a>( rotation );
00299     }
00300     <span class="keywordflow">return</span> titleTA;
00301 }
00302 
00303 
00304 <span class="keywordtype">void</span> CartesianAxis::Private::drawTitleText( QPainter* painter, <a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html">CartesianCoordinatePlane</a>* plane, <span class="keyword">const</span> QRect&amp; areaGeoRect )<span class="keyword"> const</span>
00305 <span class="keyword"></span>{
00306     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> titleTA( titleTextAttributesWithAdjustedRotation() );
00307     <span class="keywordflow">if</span>( titleTA.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa7">isVisible</a>() ) {
00308         <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">TextLayoutItem</a> titleItem( titleText,
00309                                   titleTA,
00310                                   plane-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_polar_coordinate_planea35">parent</a>(),
00311                                   <a class="code" href="class_k_d_chart_enums.html#_k_d_chart_enumsw17_k_d_chart_enumsw21">KDChartEnums::MeasureOrientationMinimum</a>,
00312                                   Qt::AlignHCenter|Qt::AlignVCenter );
00313         QPointF point;
00314         <span class="keyword">const</span> QSize size( titleItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>() );
00315         <span class="comment">//FIXME(khz): We definitely need to provide a way that users can decide</span>
00316         <span class="comment">//            the position of an axis title.</span>
00317         <span class="keywordflow">switch</span>( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a> )
00318         {
00319         <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw4">Top</a>:
00320             point.setX( areaGeoRect.left() + areaGeoRect.width() / 2.0);
00321             point.setY( areaGeoRect.top()  + size.height() / 2 );
00322             <span class="keywordflow">break</span>;
00323         <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw0">Bottom</a>:
00324             point.setX( areaGeoRect.left() + areaGeoRect.width() / 2.0);
00325             point.setY( areaGeoRect.bottom() - size.height() / 2 );
00326             <span class="keywordflow">break</span>;
00327         <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw1">Left</a>:
00328             point.setX( areaGeoRect.left() + size.width() / 2 );
00329             point.setY( areaGeoRect.top() + areaGeoRect.height() / 2.0);
00330             <span class="keywordflow">break</span>;
00331         <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw3">Right</a>:
00332             point.setX( areaGeoRect.right() - size.width() / 2 );
00333             point.setY( areaGeoRect.top() + areaGeoRect.height() / 2.0);
00334             <span class="keywordflow">break</span>;
00335         }
00336         PainterSaver painterSaver( painter );
00337         painter-&gt;translate( point );
00338         <span class="comment">//if( axis()-&gt;isOrdinate() )</span>
00339         <span class="comment">//    painter-&gt;rotate( 270.0 );</span>
00340         titleItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema16">setGeometry</a>( QRect( QPoint(-size.width() / 2, -size.height() / 2), size ) );
00341         <span class="comment">//painter-&gt;drawRect(titleItem.geometry().adjusted(0,0,-1,-1));</span>
00342         titleItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema8">paint</a>( painter );
00343     }
00344 }
00345 
00346 
<a name="l00347"></a><a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a1">00347</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a1">calculateNextLabel</a>( qreal&amp; labelValue, qreal step, <span class="keywordtype">bool</span> isLogarithmic)
00348 {
00349     <span class="keywordflow">if</span> ( isLogarithmic ){
00350         labelValue *= 10.0;
00351     }<span class="keywordflow">else</span>{
00352         <span class="comment">//qDebug() &lt;&lt; "new axis label:" &lt;&lt; labelValue &lt;&lt; "+" &lt;&lt; step &lt;&lt; "=" &lt;&lt; labelValue+step;</span>
00353         labelValue += step;
00354     }
00355     <span class="keywordflow">if</span>( qAbs(labelValue) &lt; 1.0e-15 )
00356         labelValue = 0.0;
00357 }
00358 
00359 
<a name="l00360"></a><a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a2">00360</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a2">referenceDiagramIsBarDiagram</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a> * diagram )
00361 {
00362     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html">AbstractCartesianDiagram</a> * dia =
00363             qobject_cast&lt; const AbstractCartesianDiagram * &gt;( diagram );
00364     <span class="keywordflow">if</span>( dia &amp;&amp; dia-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html#_k_d_chart_1_1_line_diagrama46">referenceDiagram</a>() )
00365         dia = dia-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html#_k_d_chart_1_1_line_diagrama46">referenceDiagram</a>();
00366     <span class="keywordflow">return</span> qobject_cast&lt; const BarDiagram* &gt;( dia ) != 0;
00367 }
00368 
00369 
<a name="l00370"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa30">00370</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa30">CartesianAxis::paintCtx</a>( <a class="code" href="class_k_d_chart_1_1_paint_context.html">PaintContext</a>* context )
00371 {
00372 
00373     Q_ASSERT_X ( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram(), <span class="stringliteral">"CartesianAxis::paint"</span>,
00374                  <span class="stringliteral">"Function call not allowed: The axis is not assigned to any diagram."</span> );
00375 
00376     <a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html">CartesianCoordinatePlane</a>* plane = dynamic_cast&lt;CartesianCoordinatePlane*&gt;(context-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta0">coordinatePlane</a>());
00377     Q_ASSERT_X ( plane, <span class="stringliteral">"CartesianAxis::paint"</span>,
00378                  <span class="stringliteral">"Bad function call: PaintContext::coodinatePlane() NOT a cartesian plane."</span> );
00379 
00380     <span class="comment">// note: Not having any data model assigned is no bug</span>
00381     <span class="comment">//       but we can not draw an axis then either.</span>
00382     <span class="keywordflow">if</span>( ! <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram()-&gt;model() )
00383         <span class="keywordflow">return</span>;
00384 
00385 
00386     <span class="comment">/*</span>
00387 <span class="comment">     * let us paint the labels at a</span>
00388 <span class="comment">     * smaller resolution</span>
00389 <span class="comment">     * Same mini pixel value as for</span>
00390 <span class="comment">     * Cartesian Grid</span>
00391 <span class="comment">     */</span>
00392     <span class="comment">//const qreal MinimumPixelsBetweenRulers = 1.0;</span>
00393     <a class="code" href="namespace_k_d_chart.html#a0">DataDimensionsList</a> dimensions( plane-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_polar_coordinate_planea15">gridDimensionsList</a>() );
00394     <span class="comment">//qDebug("CartesianAxis::paintCtx() gets DataDimensionsList.first():   start: %f   end: %f   stepWidth: %f", dimensions.first().start, dimensions.first().end, dimensions.first().stepWidth);</span>
00395 
00396     <span class="comment">// test for programming errors: critical</span>
00397     Q_ASSERT_X ( dimensions.count() == 2, <span class="stringliteral">"CartesianAxis::paint"</span>,
00398                  <span class="stringliteral">"Error: plane-&gt;gridDimensionsList() did not return exactly two dimensions."</span> );
00399     <a class="code" href="class_k_d_chart_1_1_data_dimension.html">DataDimension</a> dimX =
00400             AbstractGrid::adjustedLowerUpperRange( dimensions.first(), <span class="keyword">true</span>, <span class="keyword">true</span> );
00401     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_data_dimension.html">DataDimension</a> dimY =
00402             AbstractGrid::adjustedLowerUpperRange( dimensions.last(), <span class="keyword">true</span>, <span class="keyword">true</span> );
00403     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_data_dimension.html">DataDimension</a>&amp; dim = (<a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">isAbscissa</a>() ? dimX : dimY);
00404 
00405     <span class="comment">/*</span>
00406 <span class="comment">    if(isAbscissa())</span>
00407 <span class="comment">        qDebug() &lt;&lt; "         " &lt;&lt; "Abscissa:" &lt;&lt; dimX.start &lt;&lt;".."&lt;&lt;dimX.end &lt;&lt;"  step"&lt;&lt;dimX.stepWidth;</span>
00408 <span class="comment">    else</span>
00409 <span class="comment">        qDebug() &lt;&lt; "         " &lt;&lt; "Ordinate:" &lt;&lt; dimY.start &lt;&lt;".."&lt;&lt;dimY.end &lt;&lt;"  step"&lt;&lt;dimY.stepWidth;</span>
00410 <span class="comment">    */</span>
00411 
00412 
00413     <span class="comment">/*</span>
00414 <span class="comment">     * let us paint the labels at a</span>
00415 <span class="comment">     * smaller resolution</span>
00416 <span class="comment">     * Same mini pixel value as for</span>
00417 <span class="comment">     * Cartesian Grid</span>
00418 <span class="comment">     */</span>
00419     <span class="keyword">const</span> qreal MinimumPixelsBetweenRulers = qMin(  dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>,  dimY.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> );<span class="comment">//1.0;</span>
00420 
00421     <span class="comment">// preparations:</span>
00422     <span class="comment">// - calculate the range that will be displayed:</span>
00423     <span class="keyword">const</span> qreal absRange = qAbs( dim.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiona2">distance</a>() );
00424 
00425     qreal numberOfUnitRulers;
00426     <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">isAbscissa</a>() ) {
00427         <span class="keywordflow">if</span>( dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono2">isCalculated</a> )
00428             numberOfUnitRulers = absRange / qAbs( dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> ) + 1.0;
00429         <span class="keywordflow">else</span>
00430             numberOfUnitRulers = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram()-&gt;model()-&gt;rowCount() - 1.0;
00431     }<span class="keywordflow">else</span>{
00432         numberOfUnitRulers = absRange / qAbs( dimY.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> ) + 1.0;
00433 
00434     }
00435 
00436     <span class="comment">//    qDebug() &lt;&lt; "absRange" &lt;&lt; absRange &lt;&lt; "dimY.stepWidth:" &lt;&lt; dimY.stepWidth &lt;&lt; "numberOfUnitRulers:" &lt;&lt; numberOfUnitRulers;</span>
00437 
00438     qreal numberOfSubUnitRulers;
00439     <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">isAbscissa</a>() ){
00440         <span class="keywordflow">if</span>( dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono2">isCalculated</a> )
00441             numberOfSubUnitRulers = absRange / qAbs( dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono6">subStepWidth</a> ) + 1.0;
00442         <span class="keywordflow">else</span>
00443             numberOfSubUnitRulers = dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono6">subStepWidth</a>&gt;0 ? absRange / qAbs( dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono6">subStepWidth</a> ) + 1.0 : 0.0;
00444     }<span class="keywordflow">else</span>{
00445         numberOfSubUnitRulers = absRange / qAbs( dimY.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono6">subStepWidth</a> ) + 1.0;
00446     }
00447 
00448     <span class="comment">// - calculate the absolute range in screen pixels:</span>
00449     <span class="keyword">const</span> QPointF p1 = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF(dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono4">start</a>, dimY.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono4">start</a>) );
00450     <span class="keyword">const</span> QPointF p2 = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF(dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono1">end</a>,   dimY.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono1">end</a>) );
00451 
00452     <span class="keywordtype">double</span> screenRange;
00453     <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">isAbscissa</a>() )
00454     {
00455         screenRange = qAbs ( p1.x() - p2.x() );
00456     } <span class="keywordflow">else</span> {
00457         screenRange = qAbs ( p1.y() - p2.y() );
00458     }
00459 
00460     <span class="keyword">const</span> <span class="keywordtype">bool</span> useItemCountLabels = <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">isAbscissa</a>() &amp;&amp; ! dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono2">isCalculated</a>;
00461     <span class="comment">//qDebug() &lt;&lt; "CartesianAxis::paintCtx useItemCountLabels "&lt;&lt; useItemCountLabels;</span>
00462 
00463     <span class="comment">//qDebug() &lt;&lt; "isAbscissa():" &lt;&lt; isAbscissa() &lt;&lt; "   dimX.isCalculated:" &lt;&lt; dimX.isCalculated &lt;&lt; "   dimX.stepWidth: "&lt;&lt;dimX.stepWidth;</span>
00464     <span class="comment">//FIXME(khz): Remove this code, and do the calculation in the grid calc function</span>
00465     <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">isAbscissa</a>() &amp;&amp; ! dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono2">isCalculated</a> ){
00466         <span class="comment">// dont ignore the users settings</span>
00467         dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> = dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> ? dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> : 1.0;
00468         <span class="comment">//qDebug() &lt;&lt; "screenRange / numberOfUnitRulers &lt;= MinimumPixelsBetweenRulers" &lt;&lt; screenRange &lt;&lt;"/" &lt;&lt; numberOfUnitRulers &lt;&lt;"&lt;=" &lt;&lt; MinimumPixelsBetweenRulers;</span>
00469         <span class="keywordflow">while</span>( screenRange / numberOfUnitRulers &lt;= MinimumPixelsBetweenRulers ){
00470             dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> *= 10.0;
00471             dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono6">subStepWidth</a>  *= 10.0;
00472             numberOfUnitRulers = qAbs( dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiona2">distance</a>() / dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> );
00473         }
00474     }
00475 
00476     <span class="keyword">const</span> <span class="keywordtype">bool</span> drawUnitRulers = screenRange / ( numberOfUnitRulers / dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> ) &gt; MinimumPixelsBetweenRulers;
00477     <span class="keyword">const</span> <span class="keywordtype">bool</span> drawSubUnitRulers =
00478         (numberOfSubUnitRulers != 0.0) &amp;&amp;
00479         (screenRange / numberOfSubUnitRulers &gt; MinimumPixelsBetweenRulers);
00480 
00481     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> labelTA = <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa52">textAttributes</a>();
00482     <span class="keyword">const</span> <span class="keywordtype">bool</span> drawLabels = labelTA.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa7">isVisible</a>();
00483 
00484     <span class="comment">// - find the reference point at which to start drawing and the increment (line distance);</span>
00485     QPointF rulerRef;
00486     <span class="keyword">const</span> QRect areaGeoRect( <a class="code" href="class_k_d_chart_1_1_abstract_area.html#_k_d_chart_1_1_polar_coordinate_planeb0">areaGeometry</a>() );
00487     <span class="keyword">const</span> QRect geoRect( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa15">geometry</a>() );
00488     QRectF rulerRect;
00489     <span class="keywordtype">double</span> rulerWidth;
00490     <span class="keywordtype">double</span> rulerHeight;
00491 
00492     QPainter* ptr = context-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>();
00493 
00494     <span class="comment">//for debugging: if( isAbscissa() )ptr-&gt;drawRect(areaGeoRect.adjusted(0,0,-1,-1));</span>
00495     <span class="comment">//qDebug() &lt;&lt; "         " &lt;&lt; (isAbscissa() ? "Abscissa":"Ordinate") &lt;&lt; "axis painting with geometry" &lt;&lt; areaGeoRect;</span>
00496 
00497     <span class="comment">// FIXME references are of course different for all locations:</span>
00498     rulerWidth = areaGeoRect.width();
00499     rulerHeight =  areaGeoRect.height();
00500     <span class="keywordflow">switch</span>( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() )
00501     {
00502     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw4">Top</a>:
00503         rulerRef.setX( areaGeoRect.topLeft().x() );
00504         rulerRef.setY( areaGeoRect.topLeft().y() + rulerHeight );
00505         <span class="keywordflow">break</span>;
00506     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw0">Bottom</a>:
00507         rulerRef.setX( areaGeoRect.bottomLeft().x() );
00508         rulerRef.setY( areaGeoRect.bottomLeft().y() - rulerHeight );
00509         <span class="keywordflow">break</span>;
00510     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw3">Right</a>:
00511         rulerRef.setX( areaGeoRect.bottomRight().x() - rulerWidth );
00512         rulerRef.setY( areaGeoRect.bottomRight().y() );
00513         <span class="keywordflow">break</span>;
00514     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw1">Left</a>:
00515         rulerRef.setX( areaGeoRect.bottomLeft().x() + rulerWidth );
00516         rulerRef.setY( areaGeoRect.bottomLeft().y() );
00517         <span class="keywordflow">break</span>;
00518     }
00519 
00520     <span class="comment">// set up the lines to paint:</span>
00521 
00522     <span class="comment">// set up a map of integer positions,</span>
00523 
00524     <span class="comment">// - starting with the fourth</span>
00525     <span class="comment">// - the the halfs</span>
00526     <span class="comment">// - then the tens</span>
00527     <span class="comment">// this will override all halfs and fourth that hit a higher-order ruler</span>
00528     <span class="comment">// MAKE SURE TO START AT (0, 0)!</span>
00529 
00530     <span class="comment">// set up a reference point,  a step vector and a unit vector for the drawing:</span>
00531 
00532     <span class="keyword">const</span> qreal minValueY = dimY.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono4">start</a>;
00533     <span class="keyword">const</span> qreal maxValueY = dimY.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono1">end</a>;
00534     <span class="keyword">const</span> qreal minValueX = dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono4">start</a>;
00535     <span class="keyword">const</span> qreal maxValueX = dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono1">end</a>;
00536     <span class="keyword">const</span> <span class="keywordtype">bool</span> isLogarithmicX = (dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono0">calcMode</a> == AbstractCoordinatePlane::Logarithmic );
00537     <span class="keyword">const</span> <span class="keywordtype">bool</span> isLogarithmicY = (dimY.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono0">calcMode</a> == AbstractCoordinatePlane::Logarithmic );
00538 <span class="comment">//#define AXES_PAINTING_DEBUG 1</span>
00539 <span class="preprocessor">#ifdef AXES_PAINTING_DEBUG</span>
00540 <span class="preprocessor"></span>    qDebug() &lt;&lt; <span class="stringliteral">"CartesianAxis::paint: reference values:"</span> &lt;&lt; endl
00541              &lt;&lt; <span class="stringliteral">"-- range x/y: "</span> &lt;&lt; dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiona2">distance</a>() &lt;&lt; <span class="stringliteral">"/"</span> &lt;&lt; dimY.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiona2">distance</a>() &lt;&lt; endl
00542              &lt;&lt; <span class="stringliteral">"-- absRange: "</span> &lt;&lt; absRange &lt;&lt; endl
00543              &lt;&lt; <span class="stringliteral">"-- numberOfUnitRulers: "</span> &lt;&lt; numberOfUnitRulers &lt;&lt; endl
00544              &lt;&lt; <span class="stringliteral">"-- screenRange: "</span> &lt;&lt; screenRange &lt;&lt; endl
00545              &lt;&lt; <span class="stringliteral">"-- drawUnitRulers: "</span> &lt;&lt; drawUnitRulers &lt;&lt; endl
00546              &lt;&lt; <span class="stringliteral">"-- drawLabels: "</span> &lt;&lt; drawLabels &lt;&lt; endl
00547              &lt;&lt; <span class="stringliteral">"-- ruler reference point:: "</span> &lt;&lt; rulerRef &lt;&lt; endl
00548              &lt;&lt; <span class="stringliteral">"-- minValueX: "</span> &lt;&lt; minValueX &lt;&lt; <span class="stringliteral">"   maxValueX: "</span> &lt;&lt; maxValueX &lt;&lt; endl
00549              &lt;&lt; <span class="stringliteral">"-- minValueY: "</span> &lt;&lt; minValueY &lt;&lt; <span class="stringliteral">"   maxValueY: "</span> &lt;&lt; maxValueY &lt;&lt; endl
00550         ;
00551 <span class="preprocessor">#endif</span>
00552 <span class="preprocessor"></span>
00553     ptr-&gt;setPen ( Qt::black );
00554 
00555     <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* referenceArea = plane-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_polar_coordinate_planea35">parent</a>();
00556 
00557     <span class="comment">// that QVector contains all drawn x-ticks (so no subticks are drawn there also)</span>
00558     QVector&lt; int &gt; drawnXTicks;
00559     <span class="comment">// and that does the same for the y-ticks</span>
00560     QVector&lt; int &gt; drawnYTicks;
00561 
00562     <span class="comment">/*</span>
00563 <span class="comment">     * Find out if it is a bar diagram</span>
00564 <span class="comment">     * bar diagrams display their data per column</span>
00565 <span class="comment">     * we need to handle the last label another way</span>
00566 <span class="comment">     * 1 - Last label == QString null ( Header Labels )</span>
00567 <span class="comment">     * 2 - Display labels and ticks in the middle of the column</span>
00568 <span class="comment">     */</span>
00569 
00570     <span class="keyword">const</span> <span class="keywordtype">bool</span> isBarDiagram = <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a2">referenceDiagramIsBarDiagram</a>(<a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram());
00571 
00572     <span class="comment">// this draws the unit rulers</span>
00573     <span class="keywordflow">if</span> ( drawUnitRulers ) {
00574         <span class="keyword">const</span> <span class="keywordtype">int</span> hardLabelsCount  = <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>().count();
00575         <span class="keyword">const</span> <span class="keywordtype">int</span> shortLabelsCount = <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa49">shortLabels</a>().count();
00576         <span class="keywordtype">bool</span> useShortLabels = <span class="keyword">false</span>;
00577 
00578 
00579         <span class="keywordtype">bool</span> useConfiguredStepsLabels = <span class="keyword">false</span>;
00580         QStringList headerLabels;
00581         <span class="keywordflow">if</span>( useItemCountLabels ){
00582             <span class="comment">//qDebug() &lt;&lt; (isOrdinate() ? "is Ordinate" : "is Abscissa");</span>
00583             headerLabels =
00584                 <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa20">isOrdinate</a>()
00585                 ? <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram()-&gt;datasetLabels()
00586                 : <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram()-&gt;itemRowLabels();
00587             <span class="comment">// check if configured stepWidth</span>
00588             useConfiguredStepsLabels = <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">isAbscissa</a>() &amp;&amp;
00589                     dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> &amp;&amp;
00590                     (( (headerLabels.count() - 1)/ dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> ) != numberOfUnitRulers);
00591             <span class="keywordflow">if</span>( useConfiguredStepsLabels ) {
00592                 numberOfUnitRulers = ( headerLabels.count() - 1 )/ dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>;
00593                 <span class="comment">// we need to register data values for the steps</span>
00594                 <span class="comment">// in case it is configured by the user</span>
00595                 QStringList configuredStepsLabels;
00596                 <span class="keywordtype">double</span> value = headerLabels.first().toDouble();
00597                 configuredStepsLabels &lt;&lt; QString::number( value );
00598                 <span class="keywordflow">for</span> (  <span class="keywordtype">int</span> i = 0; i &lt; numberOfUnitRulers; i++ ) {
00599                     value += dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>;
00600                     configuredStepsLabels.append( QString::number( value ) );
00601                 }
00602                 headerLabels = configuredStepsLabels;
00603             }
00604 
00605             <span class="keywordflow">if</span> (  isBarDiagram )
00606                 headerLabels.append( QString::null );
00607         }
00608 
00609 
00610         <span class="keyword">const</span> <span class="keywordtype">int</span> headerLabelsCount = headerLabels.count();
00611         <span class="comment">//qDebug() &lt;&lt; "headerLabelsCount" &lt;&lt; headerLabelsCount;</span>
00612 
00613         <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">TextLayoutItem</a>* labelItem =
00614             drawLabels
00615             ? <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">TextLayoutItem</a>( QString::number( minValueY ),
00616                                   labelTA,
00617                                   referenceArea,
00618                                   KDChartEnums::MeasureOrientationMinimum,
00619                                   Qt::AlignLeft )
00620             : 0;
00621         TextLayoutItem* labelItem2 =
00622             drawLabels
00623             ? <span class="keyword">new</span> TextLayoutItem( QString::number( minValueY ),
00624                                   labelTA,
00625                                   referenceArea,
00626                                   KDChartEnums::MeasureOrientationMinimum,
00627                                   Qt::AlignLeft )
00628             : 0;
00629         <span class="keyword">const</span> QFontMetricsF met(
00630             drawLabels
00631             ? labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema12">realFont</a>()
00632             : QFontMetricsF( QApplication::font() ) );
00633         <span class="keyword">const</span> qreal halfFontHeight = met.height() * 0.5;
00634 
00635         <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">isAbscissa</a>() ) {
00636             <span class="comment">// If we have a labels list AND a short labels list, we first find out,</span>
00637             <span class="comment">// if there is enough space for the labels: if not, use the short labels.</span>
00638             <span class="keywordflow">if</span>( drawLabels &amp;&amp; hardLabelsCount &gt; 0 &amp;&amp; shortLabelsCount &gt; 0 ){
00639                 <span class="keywordtype">bool</span> labelsAreOverlapping = <span class="keyword">false</span>;
00640                 <span class="keywordtype">int</span> iLabel = 0;
00641                 qreal i = minValueX;
00642                 <span class="keywordflow">while</span> ( i &lt; maxValueX &amp;&amp; !labelsAreOverlapping )
00643                 {
00644                     <span class="keywordflow">if</span> ( dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> != 1.0 &amp;&amp; ! dim.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono2">isCalculated</a> )
00645                     {
00646                         labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>(  <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(QString::number( i, <span class="charliteral">'f'</span>, 0 )) );
00647                         labelItem2-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(QString::number( i + dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>, <span class="charliteral">'f'</span>, 0 )) );
00648                     } <span class="keywordflow">else</span> {
00649 
00650                         <span class="keywordtype">int</span> index = iLabel;
00651                         labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>(  <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(<a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>()[ index &lt; hardLabelsCount ? index : 0 ]) );
00652                         labelItem2-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(<a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>()[ index &lt; hardLabelsCount - 1 ? index + 1 : 0]) );
00653                     }
00654                     QPointF firstPos( i, 0.0 );
00655                     firstPos = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( firstPos );
00656 
00657                     QPointF secondPos( i + dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>, 0.0 );
00658                     secondPos = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( secondPos );
00659 
00660                     labelsAreOverlapping = labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema4">intersects</a>( *labelItem2, firstPos, secondPos );
00661                     <span class="keywordflow">if</span> ( iLabel++ &gt; hardLabelsCount - 1 )
00662                         iLabel = 0;
00663                     <span class="keywordflow">if</span> ( isLogarithmicX )
00664                         i *= 10.0;
00665                     <span class="keywordflow">else</span>
00666                         i += dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>;
00667 
00668                 }
00669 
00670                 useShortLabels = labelsAreOverlapping;
00671             }
00672 
00673             qreal labelDiff = dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>;
00674             <span class="comment">//qDebug() &lt;&lt; "labelDiff " &lt;&lt; labelDiff;</span>
00675             <span class="keywordflow">if</span> ( drawLabels )
00676             {
00677 
00678                 qreal i = minValueX;
00679                 <span class="keywordtype">int</span> iLabel = 0;
00680                 <span class="keyword">const</span> <span class="keywordtype">int</span> precision = ( QString::number( labelDiff  ).section( QLatin1Char(<span class="charliteral">'.'</span>), 1,  2 ) ).length();
00681 
00682                 <span class="keywordflow">while</span> ( i + labelDiff &lt; maxValueX )
00683                 {
00684 
00685                     <span class="comment">//qDebug() &lt;&lt; "drawLabels" &lt;&lt; drawLabels &lt;&lt; "  hardLabelsCount" &lt;&lt; hardLabelsCount</span>
00686                     <span class="comment">//        &lt;&lt; "  dimX.stepWidth" &lt;&lt; dimX.stepWidth &lt;&lt; "  dim.isCalculated" &lt;&lt; dim.isCalculated;</span>
00687                     <span class="keywordflow">if</span> ( !drawLabels || hardLabelsCount &lt; 1 || ( dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a> != 1.0 &amp;&amp; ! dim.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono2">isCalculated</a> ) )
00688                     {
00689                         <span class="comment">// Check intersects for the header label - we need to pass the full string</span>
00690                         <span class="comment">// here and not only the i value.</span>
00691                         <span class="keywordflow">if</span>( useConfiguredStepsLabels ){
00692                             labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(headerLabels[ iLabel   ]) );
00693                             labelItem2-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>(<a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(headerLabels[ iLabel+1 ]) );
00694                         }<span class="keywordflow">else</span>{
00695                             <span class="comment">//qDebug() &lt;&lt; "i + labelDiff " &lt;&lt; i + labelDiff;</span>
00696                             labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(headerLabelsCount ? headerLabels[static_cast&lt;int&gt;(i)]
00697                                 : QString::number( i, <span class="charliteral">'f'</span>, precision )) );
00698                             <span class="comment">//           qDebug() &lt;&lt; "1 - labelItem-&gt;text() " &lt;&lt; labelItem-&gt;text();</span>
00699                             <span class="comment">//qDebug() &lt;&lt; "labelDiff" &lt;&lt; labelDiff</span>
00700                             <span class="comment">//        &lt;&lt; "  index" &lt;&lt; i+labelDiff &lt;&lt; "  count" &lt;&lt; headerLabelsCount;</span>
00701                             labelItem2-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(headerLabelsCount ? headerLabels[static_cast&lt;int&gt;(i+labelDiff)]
00702                                 : QString::number( i + labelDiff, <span class="charliteral">'f'</span>, precision )) );
00703                             <span class="comment">//qDebug() &lt;&lt; "2 - labelItem-&gt;text() " &lt;&lt; labelItem-&gt;text();</span>
00704                             <span class="comment">//qDebug() &lt;&lt; "labelItem2-&gt;text() " &lt;&lt; labelItem2-&gt;text();</span>
00705                         }
00706                     } <span class="keywordflow">else</span> {
00707                         <span class="keyword">const</span> <span class="keywordtype">int</span> idx = (iLabel &lt; hardLabelsCount    ) ? iLabel     : 0;
00708                         <span class="keyword">const</span> <span class="keywordtype">int</span> idx2= (iLabel &lt; hardLabelsCount - 1) ? iLabel + 1 : 0;
00709                         labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>(  <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(
00710                                 useShortLabels ? <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa49">shortLabels</a>()[ idx ] : <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>()[ idx ]) );
00711                         labelItem2-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(
00712                                 useShortLabels ? <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa49">shortLabels</a>()[ idx2] : <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>()[ idx2]) );
00713                     }
00714 
00715                     QPointF firstPos( i, 0.0 );
00716                     firstPos = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( firstPos );
00717 
00718                     QPointF secondPos( i + labelDiff, 0.0 );
00719                     secondPos = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( secondPos );
00720 
00721 
00722                     <span class="keywordflow">if</span> ( labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema4">intersects</a>( *labelItem2, firstPos, secondPos ) )
00723                     {
00724                         i = minValueX;
00725                         labelDiff += labelDiff;
00726                         iLabel = 0;
00727                     }
00728                     <span class="keywordflow">else</span>
00729                     {
00730                         i += labelDiff;
00731                     }
00732 
00733                     ++iLabel;
00734                     <span class="keywordflow">if</span> ( (iLabel &gt; hardLabelsCount - 1) &amp;&amp; !useConfiguredStepsLabels )
00735                     {
00736                         iLabel = 0;
00737                     }
00738                 }
00739             }
00740 
00741             <span class="keywordtype">int</span> idxLabel = 0;
00742             qreal iLabelF = minValueX;
00743             qreal i = minValueX;
00744             qreal labelStep = 0.0;
00745             <span class="comment">//qDebug() &lt;&lt; "dimX.stepWidth:" &lt;&lt; dimX.stepWidth;</span>
00746             <span class="comment">//dimX.stepWidth = 0.5;</span>
00747             <span class="keywordflow">while</span>( i &lt;= maxValueX ) {
00748                 <span class="comment">// Line charts: we want the first tick to begin at 0.0 not at 0.5 otherwise labels and</span>
00749                 <span class="comment">// values does not fit each others</span>
00750                 QPointF topPoint ( i + ( isBarDiagram ? 0.5 : 0.0 ), 0.0 );
00751                 QPointF bottomPoint ( topPoint );
00752                 topPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( topPoint );
00753                 bottomPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( bottomPoint );
00754                 topPoint.setY( rulerRef.y() + <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa53">tickLength</a>() );
00755                 bottomPoint.setY( rulerRef.y() );
00756 
00757                 <span class="keyword">const</span> qreal translatedValue = topPoint.x();
00758                 <span class="keyword">const</span> <span class="keywordtype">bool</span> bIsVisibleLabel =
00759                         ( translatedValue &gt;= geoRect.left() &amp;&amp; translatedValue &lt;= geoRect.right() );
00760 
00761                 <span class="comment">//Dont paint more ticks than we need</span>
00762                 <span class="comment">//when diagram type is Bar</span>
00763                 <span class="keywordtype">bool</span> painttick = <span class="keyword">true</span>;
00764                 <span class="keywordflow">if</span> (  isBarDiagram &amp;&amp; i == maxValueX )
00765                     painttick = <span class="keyword">false</span>;
00766 
00767                 <span class="keywordflow">if</span> ( bIsVisibleLabel &amp;&amp; painttick )
00768                     ptr-&gt;drawLine( topPoint, bottomPoint );
00769 
00770                 drawnXTicks.append( static_cast&lt;int&gt;( topPoint.x() ) );
00771                 <span class="keywordflow">if</span>( drawLabels ) {
00772                     <span class="keywordflow">if</span>( bIsVisibleLabel ){
00773                         <span class="keywordflow">if</span> ( isLogarithmicX )
00774                             labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(QString::number( i, <span class="charliteral">'f'</span>, 0 )) );
00775                         <span class="comment">/* We dont need that</span>
00776 <span class="comment">                        * it causes header labels to be skipped even if there is enough</span>
00777 <span class="comment">                        * space for them to displayed.</span>
00778 <span class="comment">                        * Commenting for now - I need to test more in details - Let me know if I am wrong here.</span>
00779 <span class="comment">                        */</span>
00780                         <span class="comment">/*</span>
00781 <span class="comment">                        else if( (dimX.stepWidth != 1.0) &amp;&amp; ! dimX.isCalculated ) {</span>
00782 <span class="comment">                        labelItem-&gt;setText( customizedLabel(QString::number( i, 'f', 0 )) );</span>
00783 <span class="comment">                        }</span>
00784 <span class="comment">                        */</span>
00785                         <span class="keywordflow">else</span> {
00786                             labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>(
00787                                     <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(
00788                                           hardLabelsCount
00789                                         ? ( useShortLabels    ? <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa49">shortLabels</a>()[ idxLabel ] : <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>()[ idxLabel ] )
00790                                         : ( headerLabelsCount ? headerLabels[  idxLabel ] : QString::number( iLabelF ))));
00791                         }
00792                         <span class="comment">// No need to call labelItem-&gt;setParentWidget(), since we are using</span>
00793                         <span class="comment">// the layout item temporarily only.</span>
00794                         <span class="keywordflow">if</span>( labelStep &lt;= 0 ) {
00795                             <span class="keyword">const</span> QSize size( labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>() );
00796                             labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema16">setGeometry</a>(
00797                                 QRect(
00798                                     QPoint(
00799                                         static_cast&lt;int&gt;( topPoint.x() - size.width() / 2 ),
00800                                         static_cast&lt;int&gt;( topPoint.y() +
00801                                                         ( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() == <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw0">Bottom</a>
00802                                                             ? halfFontHeight
00803                                                             : ((halfFontHeight + size.height()) * -1.0) ) ) ),
00804                                     size ) );
00805 
00806                             <span class="keywordtype">bool</span> origClipping = ptr-&gt;hasClipping();
00807 
00808                             QRect labelGeo = labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema2">geometry</a>();
00809                             <span class="comment">// if our item would only half fit, we disable clipping for that one</span>
00810                             <span class="keywordflow">if</span>( labelGeo.left() &lt; geoRect.left() &amp;&amp; labelGeo.right() &gt; geoRect.left() )
00811                                 ptr-&gt;setClipping( <span class="keyword">false</span> );
00812                             <span class="keywordflow">if</span>( labelGeo.left() &lt; geoRect.right() &amp;&amp; labelGeo.right() &gt; geoRect.right() )
00813                                 ptr-&gt;setClipping( <span class="keyword">false</span> );
00814 
00815                             labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema16">setGeometry</a>( labelGeo );
00816 
00817                             labelStep = labelDiff - dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>;
00818                             labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema8">paint</a>( ptr );
00819 
00820                             <span class="comment">// do not call customizedLabel() again:</span>
00821                             labelItem2-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema23">text</a>() );
00822 
00823                             <span class="comment">// maybe enable clipping afterwards</span>
00824                             ptr-&gt;setClipping( origClipping );
00825                         } <span class="keywordflow">else</span> {
00826                             labelStep -= dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>;
00827                         }
00828                     }
00829 
00830                     <span class="keywordflow">if</span>( hardLabelsCount ) {
00831                         <span class="keywordflow">if</span>( idxLabel &gt;= hardLabelsCount  -1 )
00832                             idxLabel = 0;
00833                         <span class="keywordflow">else</span>
00834                             ++idxLabel;
00835                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( headerLabelsCount ) {
00836                         <span class="keywordflow">if</span>( idxLabel &gt;= headerLabelsCount - 1 ) {
00837                             idxLabel = 0;
00838                         }<span class="keywordflow">else</span>
00839                             ++idxLabel;
00840                     } <span class="keywordflow">else</span> {
00841                         iLabelF += dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>;
00842                     }
00843                 }
00844                 <span class="keywordflow">if</span> ( isLogarithmicX )
00845                     i *= 10.0;
00846                 <span class="keywordflow">else</span>
00847                     i += dimX.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>;
00848             }
00849         } <span class="keywordflow">else</span> {
00850             <span class="keyword">const</span> <span class="keywordtype">double</span> maxLimit = maxValueY;
00851             <span class="keyword">const</span> <span class="keywordtype">double</span> steg = dimY.<a class="code" href="class_k_d_chart_1_1_data_dimension.html#_k_d_chart_1_1_data_dimensiono5">stepWidth</a>;
00852             <span class="keywordtype">int</span> maxLabelsWidth = 0;
00853             qreal labelValue;
00854             <span class="keywordflow">if</span>( drawLabels &amp;&amp; <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() == <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw3">Right</a> ){
00855                 <span class="comment">// Find the widest label, so we to know how much we need to right-shift</span>
00856                 <span class="comment">// our labels, to get them drawn right aligned:</span>
00857                 labelValue = minValueY;
00858                 <span class="keywordflow">while</span> ( labelValue &lt;= maxLimit ) {
00859                     labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(QString::number( labelValue )) );
00860                     maxLabelsWidth = qMax( maxLabelsWidth, labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>().width() );
00861 
00862                     <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a1">calculateNextLabel</a>( labelValue, steg, isLogarithmicY );
00863                 }
00864             }
00865 
00866             <span class="keywordtype">bool</span> origClipping = ptr-&gt;hasClipping();
00867             ptr-&gt;setClipping( <span class="keyword">false</span> );
00868             labelValue = minValueY;
00869             qreal step = steg;
00870             <span class="keywordtype">bool</span> nextLabel = <span class="keyword">false</span>;
00871             <span class="comment">//qDebug("minValueY: %f   maxLimit: %f   steg: %f", minValueY, maxLimit, steg);</span>
00872 
00873             <span class="comment">// first calculate the steps depending on labels colision</span>
00874             <span class="keywordflow">while</span> ( labelValue &lt;= maxLimit ) {
00875                 QPointF leftPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF( 0, labelValue ) );
00876                 <span class="keyword">const</span> qreal translatedValue = leftPoint.y();
00877                 <span class="comment">//qDebug() &lt;&lt; "geoRect:" &lt;&lt; geoRect &lt;&lt; "   geoRect.top()" &lt;&lt; geoRect.top()</span>
00878                 <span class="comment">//&lt;&lt; "geoRect.bottom()" &lt;&lt; geoRect.bottom() &lt;&lt; "  translatedValue:" &lt;&lt; translatedValue;</span>
00879                 <span class="keywordflow">if</span>( translatedValue &gt; geoRect.top() &amp;&amp; translatedValue &lt;= geoRect.bottom() ){
00880                     <span class="keywordflow">if</span> ( drawLabels ) {
00881                         labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>(  <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(QString::number( labelValue )) );
00882                         labelItem2-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(QString::number( labelValue + step )) );
00883                         QPointF nextPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>(  QPointF( 0,  labelValue + step ) );
00884                         <span class="keywordflow">if</span> ( labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema4">intersects</a>( *labelItem2, leftPoint, nextPoint ) )
00885                         {
00886                             step += steg;
00887                             nextLabel = <span class="keyword">false</span>;
00888                         }<span class="keywordflow">else</span>{
00889                             nextLabel = <span class="keyword">true</span>;
00890                         }
00891                     }
00892                 }<span class="keywordflow">else</span>{
00893                     nextLabel = <span class="keyword">true</span>;
00894                 }
00895 
00896                 <span class="keywordflow">if</span> ( nextLabel || isLogarithmicY )
00897                     <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a1">calculateNextLabel</a>( labelValue, step, isLogarithmicY );
00898                 <span class="keywordflow">else</span>
00899                     labelValue = minValueY;
00900             }
00901 
00902             <span class="comment">// Second - Paint the labels</span>
00903             labelValue = minValueY;
00904             <span class="comment">//qDebug() &lt;&lt; "axis labels starting at" &lt;&lt; labelValue &lt;&lt; "step width" &lt;&lt; step;</span>
00905             <span class="keywordflow">while</span> ( labelValue &lt;= maxLimit ) {
00906                 <span class="comment">//qDebug() &lt;&lt; "value now" &lt;&lt; labelValue;</span>
00907                 labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(QString::number( labelValue )) );
00908                 QPointF leftPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( QPointF( 0, labelValue ) );
00909                 QPointF rightPoint ( 0.0, labelValue );
00910                 rightPoint = plane-&gt;<a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html#_k_d_chart_1_1_cartesian_coordinate_planea80">translate</a>( rightPoint );
00911                 leftPoint.setX( rulerRef.x() + <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa53">tickLength</a>() );
00912                 rightPoint.setX( rulerRef.x() );
00913 
00914                 <span class="keyword">const</span> qreal translatedValue = rightPoint.y();
00915                 <span class="keyword">const</span> <span class="keywordtype">bool</span> bIsVisibleLabel =
00916                         ( translatedValue &gt;= geoRect.top() &amp;&amp; translatedValue &lt;= geoRect.bottom() );
00917 
00918                 <span class="keywordflow">if</span>( bIsVisibleLabel ){
00919                     ptr-&gt;drawLine( leftPoint, rightPoint );
00920                     drawnYTicks.append( static_cast&lt;int&gt;( leftPoint.y() ) );
00921                     <span class="keyword">const</span> QSize labelSize( labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>() );
00922                     leftPoint.setX( leftPoint.x() );
00923                     <span class="keyword">const</span> <span class="keywordtype">int</span> x =
00924                         static_cast&lt;int&gt;( leftPoint.x() + met.height() * ( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() == <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw1">Left</a> ? -0.5 : 0.5) )
00925                         - ( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() == <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw1">Left</a> ? labelSize.width() : (labelSize.width() - maxLabelsWidth) );
00926                     <span class="keyword">const</span> <span class="keywordtype">int</span> y =
00927                         static_cast&lt;int&gt;( leftPoint.y() - ( met.ascent() + met.descent() ) * 0.6 );
00928                     labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema16">setGeometry</a>( QRect( QPoint( x, y ), labelSize ) );
00929                     labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema8">paint</a>( ptr );
00930                 }
00931 
00932                 <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a1">calculateNextLabel</a>( labelValue, step, isLogarithmicY );
00933             }
00934 
00935             ptr-&gt;setClipping( origClipping );
00936         }
00937         <span class="keyword">delete</span> labelItem;
00938         <span class="keyword">delete</span> labelItem2;
00939     }
00940 
00941     <span class="comment">// this draws the subunit rulers</span>
00942     <span class="keywordflow">if</span> ( drawSubUnitRulers ) {
00943         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;drawSubUnitRulers( ptr, plane, dim, rulerRef, <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">isAbscissa</a>() ? drawnXTicks : drawnYTicks );
00944     }
00945 
00946     <span class="keywordflow">if</span>( ! <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa54">titleText</a>().isEmpty() ){
00947         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;drawTitleText( ptr, plane, areaGeoRect );
00948     }
00949 
00950     <span class="comment">//qDebug() &lt;&lt; "KDChart::CartesianAxis::paintCtx() done.";</span>
00951 }
00952 
00953 
00954 <span class="comment">/* pure virtual in QLayoutItem */</span>
<a name="l00955"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa19">00955</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa19">CartesianAxis::isEmpty</a>()<span class="keyword"> const</span>
00956 <span class="keyword"></span>{
00957     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// if the axis exists, it has some (perhaps default) content</span>
00958 }
00959 <span class="comment">/* pure virtual in QLayoutItem */</span>
<a name="l00960"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa13">00960</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa13">CartesianAxis::expandingDirections</a>()<span class="keyword"> const</span>
00961 <span class="keyword"></span>{
00962     Qt::Orientations ret;
00963     <span class="keywordflow">switch</span> ( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() )
00964     {
00965     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw0">Bottom</a>:
00966     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw4">Top</a>:
00967         ret = Qt::Horizontal;
00968         <span class="keywordflow">break</span>;
00969     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw1">Left</a>:
00970     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw3">Right</a>:
00971         ret = Qt::Vertical;
00972         <span class="keywordflow">break</span>;
00973     <span class="keywordflow">default</span>:
00974         Q_ASSERT( <span class="keyword">false</span> ); <span class="comment">// all positions need to be handeld</span>
00975         <span class="keywordflow">break</span>;
00976     };
00977     <span class="keywordflow">return</span> ret;
00978 }
00979 
00980 
<a name="l00981"></a><a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a3">00981</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a3">calculateOverlap</a>( <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> first, <span class="keywordtype">int</span> last,
00982                               <span class="keywordtype">int</span> measure,
00983                               <span class="keywordtype">bool</span> isBarDiagram,
00984                               <span class="keywordtype">int</span>&amp; firstOverlap, <span class="keywordtype">int</span>&amp; lastOverlap )
00985 {
00986     <span class="keywordflow">if</span>( i == first ){
00987         <span class="keywordflow">if</span>( isBarDiagram ){
00988             <span class="comment">//TODO(khz): Calculate the amount of left overlap</span>
00989             <span class="comment">//           for bar diagrams.</span>
00990         }<span class="keywordflow">else</span>{
00991             firstOverlap = measure / 2;
00992         }
00993     }
00994     <span class="comment">// we test both bounds in on go: first and last might be equal</span>
00995     <span class="keywordflow">if</span>( i == last ){
00996         <span class="keywordflow">if</span>( isBarDiagram ){
00997             <span class="comment">//TODO(khz): Calculate the amount of right overlap</span>
00998             <span class="comment">//           for bar diagrams.</span>
00999         }<span class="keywordflow">else</span>{
01000             lastOverlap = measure / 2;
01001         }
01002     }
01003 }
01004 
01005 
01006 <span class="comment">/* pure virtual in QLayoutItem */</span>
<a name="l01007"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa24">01007</a> QSize <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa24">CartesianAxis::maximumSize</a>()<span class="keyword"> const</span>
01008 <span class="keyword"></span>{
01009     QSize result;
01010     <span class="keywordflow">if</span> ( !<a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram() )
01011         <span class="keywordflow">return</span> result;
01012 
01013     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> labelTA = <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa52">textAttributes</a>();
01014     <span class="keyword">const</span> <span class="keywordtype">bool</span> drawLabels = labelTA.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa7">isVisible</a>();
01015 
01016     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> titleTA( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleTextAttributesWithAdjustedRotation() );
01017     <span class="keyword">const</span> <span class="keywordtype">bool</span> drawTitle = titleTA.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa7">isVisible</a>() &amp;&amp; ! <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa54">titleText</a>().isEmpty();
01018 
01019     <a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html">AbstractCoordinatePlane</a>* plane = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram()-&gt;coordinatePlane();
01020     <span class="comment">//qDebug() &lt;&lt; this&lt;&lt;"::maximumSize() uses plane geometry" &lt;&lt; plane-&gt;geometry();</span>
01021     <a class="code" href="class_q_object.html">QObject</a>* refArea = plane-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_polar_coordinate_planea35">parent</a>();
01022     <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">TextLayoutItem</a> labelItem( QString::null, labelTA, refArea,
01023                               KDChartEnums::MeasureOrientationMinimum, Qt::AlignLeft );
01024     <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">TextLayoutItem</a> titleItem( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa54">titleText</a>(), titleTA, refArea,
01025                               KDChartEnums::MeasureOrientationMinimum, Qt::AlignHCenter | Qt::AlignVCenter );
01026     <span class="keyword">const</span> qreal labelGap =
01027         drawLabels
01028         ? (QFontMetricsF( labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema12">realFont</a>() ).height() / 3.0)
01029         : 0.0;
01030     <span class="keyword">const</span> qreal titleGap =
01031         drawTitle
01032         ? (QFontMetricsF( titleItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema12">realFont</a>() ).height() / 3.0)
01033         : 0.0;
01034 
01035     <span class="keywordflow">switch</span> ( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() )
01036     {
01037     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw0">Bottom</a>:
01038     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw4">Top</a>: {
01039         <span class="keyword">const</span> <span class="keywordtype">bool</span> isBarDiagram = <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a2">referenceDiagramIsBarDiagram</a>(<a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram());
01040         <span class="keywordtype">int</span> leftOverlap = 0;
01041         <span class="keywordtype">int</span> rightOverlap = 0;
01042 
01043         qreal w = 10.0;
01044         qreal h = 0.0;
01045         <span class="keywordflow">if</span>( drawLabels ){
01046             <span class="comment">// if there're no label strings, we take the biggest needed number as height</span>
01047             <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>().count() ){
01048                 <span class="comment">// find the longest label text:</span>
01049                 <span class="keyword">const</span> <span class="keywordtype">int</span> first=0;
01050                 <span class="keyword">const</span> <span class="keywordtype">int</span> last=<a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>().count()-1;
01051                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = first; i &lt;= last; ++i )
01052                 {
01053                     labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(<a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>()[ i ]) );
01054                     <span class="keyword">const</span> QSize siz = labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>();
01055                     h = qMax( h, static_cast&lt;qreal&gt;(siz.height()) );
01056                     <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a3">calculateOverlap</a>( i, first, last, siz.width(), isBarDiagram,
01057                                       leftOverlap, rightOverlap );
01058 
01059                 }
01060             }<span class="keywordflow">else</span>{
01061                 QStringList headerLabels = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;diagram()-&gt;itemRowLabels();
01062                 <span class="keyword">const</span> <span class="keywordtype">int</span> headerLabelsCount = headerLabels.count();
01063                 <span class="keywordflow">if</span>( headerLabelsCount ){
01064                     <span class="keyword">const</span> <span class="keywordtype">int</span> first=0;
01065                     <span class="keyword">const</span> <span class="keywordtype">int</span> last=headerLabelsCount-1;
01066                     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = first; i &lt;= last; ++i )
01067                     {
01068                         labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(headerLabels[ i ]) );
01069                         <span class="keyword">const</span> QSize siz = labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>();
01070                         h = qMax( h, static_cast&lt;qreal&gt;(siz.height()) );
01071                         <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a3">calculateOverlap</a>( i, first, last, siz.width(), isBarDiagram,
01072                                           leftOverlap, rightOverlap );
01073                     }
01074                 }<span class="keywordflow">else</span>{
01075                     labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>(
01076                             <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(
01077                                     QString::number( plane-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_polar_coordinate_planea15">gridDimensionsList</a>().first().end, <span class="charliteral">'f'</span>, 0 )));
01078                     <span class="keyword">const</span> QSize siz = labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>();
01079                     h = siz.height();
01080                     <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a3">calculateOverlap</a>( 0, 0, 0, siz.width(), isBarDiagram,
01081                                       leftOverlap, rightOverlap );
01082                 }
01083             }
01084             <span class="comment">// we leave a little gap between axis labels and bottom (or top, resp.) side of axis</span>
01085             h += labelGap;
01086         }
01087         <span class="comment">// space for a possible title:</span>
01088         <span class="keywordflow">if</span> ( drawTitle ) {
01089             <span class="comment">// we add the title height and leave a little gap between axis labels and axis title</span>
01090             h += titleItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>().height() + titleGap;
01091             w = titleItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>().width() + 2.0;
01092         }
01093         <span class="comment">// space for the ticks</span>
01094         h += qAbs( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa53">tickLength</a>() ) * 3.0;
01095         result = QSize ( static_cast&lt;int&gt;( w ), static_cast&lt;int&gt;( h ) );
01096 
01097 
01098         <span class="comment">// If necessary adjust the widths</span>
01099         <span class="comment">// of the left (or right, resp.) side neighboring columns:</span>
01100         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;amountOfLeftOverlap = leftOverlap;
01101         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;amountOfRightOverlap = rightOverlap;
01102         <span class="comment">/* Unused code for a push-model:</span>
01103 <span class="comment">        if( leftOverlap || rightOverlap ){</span>
01104 <span class="comment">            QTimer::singleShot(200, const_cast&lt;CartesianAxis*&gt;(this),</span>
01105 <span class="comment">                               SLOT(adjustLeftRightGridColumnWidths()));</span>
01106 <span class="comment">        }</span>
01107 <span class="comment">        */</span>
01108     }
01109         <span class="keywordflow">break</span>;
01110     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw1">Left</a>:
01111     <span class="keywordflow">case</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw3">Right</a>: {
01112         <span class="keywordtype">int</span> topOverlap = 0;
01113         <span class="keywordtype">int</span> bottomOverlap = 0;
01114 
01115         qreal w = 0.0;
01116         qreal h = 10.0;
01117         <span class="keywordflow">if</span>( drawLabels ){
01118             <span class="comment">// if there're no label strings, we take the biggest needed number as width</span>
01119             <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>().count() == 0 )
01120             {
01121                 labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>(
01122                         <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(
01123                                 QString::number( plane-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_polar_coordinate_planea15">gridDimensionsList</a>().last().end, <span class="charliteral">'f'</span>, 0 )));
01124                 <span class="keyword">const</span> QSize siz = labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>();
01125                 w = siz.width();
01126                 <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a3">calculateOverlap</a>( 0, 0, 0, siz.height(), <span class="keyword">false</span>,<span class="comment">// bar diagram flag is ignored for Ordinates</span>
01127                                   topOverlap, bottomOverlap );
01128             }<span class="keywordflow">else</span>{
01129                 <span class="comment">// find the longest label text:</span>
01130                 <span class="keyword">const</span> <span class="keywordtype">int</span> first=0;
01131                 <span class="keyword">const</span> <span class="keywordtype">int</span> last=<a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>().count()-1;
01132                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = first; i &lt;= last; ++i )
01133                 {
01134                     labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">setText</a>( <a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa10">customizedLabel</a>(<a class="code" href="class_k_d_chart_1_1_abstract_axis.html#_k_d_chart_1_1_cartesian_axisa21">labels</a>()[ i ]) );
01135                     <span class="keyword">const</span> QSize siz = labelItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>();
01136                     qreal lw = siz.width();
01137                     w = qMax( w, lw );
01138                     <a class="code" href="_k_d_chart_cartesian_axis_8cpp.html#a3">calculateOverlap</a>( 0, 0, 0, siz.height(), <span class="keyword">false</span>,<span class="comment">// bar diagram flag is ignored for Ordinates</span>
01139                                       topOverlap, bottomOverlap );
01140                 }
01141             }
01142             <span class="comment">// we leave a little gap between axis labels and left (or right, resp.) side of axis</span>
01143             w += labelGap;
01144         }
01145         <span class="comment">// space for a possible title:</span>
01146         <span class="keywordflow">if</span> ( drawTitle ) {
01147             <span class="comment">// we add the title height and leave a little gap between axis labels and axis title</span>
01148             w += titleItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>().width() + titleGap;
01149             h = titleItem.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>().height() + 2.0;
01150             <span class="comment">//qDebug() &lt;&lt; "left/right axis title item size-hint:" &lt;&lt; titleItem.sizeHint();</span>
01151         }
01152         <span class="comment">// space for the ticks</span>
01153         w += qAbs( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa53">tickLength</a>() ) * 3.0;
01154 
01155         result = QSize ( static_cast&lt;int&gt;( w ), static_cast&lt;int&gt;( h ) );
01156         <span class="comment">//qDebug() &lt;&lt; "left/right axis width:" &lt;&lt; result &lt;&lt; "   w:" &lt;&lt; w;</span>
01157 
01158 
01159         <span class="comment">// If necessary adjust the heights</span>
01160         <span class="comment">// of the top (or bottom, resp.) side neighboring rows:</span>
01161         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;amountOfTopOverlap = topOverlap;
01162         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;amountOfBottomOverlap = bottomOverlap;
01163         <span class="comment">/* Unused code for a push-model:</span>
01164 <span class="comment">        if( topOverlap || bottomOverlap ){</span>
01165 <span class="comment">            QTimer::singleShot(200, const_cast&lt;CartesianAxis*&gt;(this),</span>
01166 <span class="comment">                               SLOT(adjustTopBottomGridRowHeights()));</span>
01167 <span class="comment">        }</span>
01168 <span class="comment">        */</span>
01169     }
01170         <span class="keywordflow">break</span>;
01171     <span class="keywordflow">default</span>:
01172         Q_ASSERT( <span class="keyword">false</span> ); <span class="comment">// all positions need to be handled</span>
01173         <span class="keywordflow">break</span>;
01174     };
01175 <span class="comment">//qDebug() &lt;&lt; "*******************" &lt;&lt; result;</span>
01176     <span class="comment">//result=QSize(0,0);</span>
01177     <span class="keywordflow">return</span> result;
01178 }
01179 <span class="comment">/* pure virtual in QLayoutItem */</span>
<a name="l01180"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa25">01180</a> QSize <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa25">CartesianAxis::minimumSize</a>()<span class="keyword"> const</span>
01181 <span class="keyword"></span>{
01182     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa24">maximumSize</a>();
01183 }
01184 <span class="comment">/* pure virtual in QLayoutItem */</span>
<a name="l01185"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa50">01185</a> QSize <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa50">CartesianAxis::sizeHint</a>()<span class="keyword"> const</span>
01186 <span class="keyword"></span>{
01187     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa24">maximumSize</a>();
01188 }
01189 <span class="comment">/* pure virtual in QLayoutItem */</span>
<a name="l01190"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa40">01190</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa40">CartesianAxis::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
01191 {
01192 <span class="comment">//    qDebug() &lt;&lt; "KDChart::CartesianAxis::setGeometry(" &lt;&lt; r &lt;&lt; ") called"</span>
01193 <span class="comment">//             &lt;&lt; (isAbscissa() ? "for Abscissa":"for Ordinate") &lt;&lt; "axis";</span>
01194     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;geometry = r;
01195 }
01196 <span class="comment">/* pure virtual in QLayoutItem */</span>
<a name="l01197"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa15">01197</a> QRect <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa15">CartesianAxis::geometry</a>()<span class="keyword"> const</span>
01198 <span class="keyword"></span>{
01199     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;geometry;
01200 }
01201 
<a name="l01202"></a><a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa53">01202</a> <span class="keywordtype">int</span> <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa53">CartesianAxis::tickLength</a>( <span class="keywordtype">bool</span> subUnitTicks )<span class="keyword"> const</span>
01203 <span class="keyword"></span>{
01204     <span class="keywordtype">int</span> result = 0;
01205 
01206     <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa18">isAbscissa</a>() ) {
01207         result = <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() == <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw4">Top</a> ? -4 : 3;
01208     } <span class="keywordflow">else</span> {
01209         result = <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisa34">position</a>() == <a class="code" href="class_k_d_chart_1_1_cartesian_axis.html#_k_d_chart_1_1_cartesian_axisw2_k_d_chart_1_1_cartesian_axisw1">Left</a> ? -4 : 3;
01210     }
01211 
01212     <span class="keywordflow">if</span> ( subUnitTicks )
01213         result = result &lt; 0 ? result + 1 : result - 1;
01214 
01215     <span class="keywordflow">return</span> result;
01216 }
01217 
01218 
01219 
01220 
01221 
01222 <span class="comment">/* unused code from KDChartCartesianAxis.h for using a push-model:</span>
01223 <span class="comment">Q_SIGNALS:</span>
01224 <span class="comment">    void needAdjustLeftRightColumnsForOverlappingLabels(</span>
01225 <span class="comment">            CartesianAxis* axis, int left, int right );</span>
01226 <span class="comment">    void needAdjustTopBottomRowsForOverlappingLabels(</span>
01227 <span class="comment">            CartesianAxis* axis, int top, int bottom );</span>
01228 <span class="comment">private Q_SLOTS:</span>
01229 <span class="comment">    void adjustLeftRightGridColumnWidths();</span>
01230 <span class="comment">    void adjustTopBottomGridRowHeights();</span>
01231 <span class="comment">*/</span>
01232 
01233 <span class="comment">/*</span>
01234 <span class="comment">// Unused code trying to use a push-model: This did not work</span>
01235 <span class="comment">// since we can not re-layout the planes each time when</span>
01236 <span class="comment">// Qt layouting is calling sizeHint()</span>
01237 <span class="comment">void CartesianAxis::adjustLeftRightGridColumnWidths()</span>
01238 <span class="comment">{</span>
01239 <span class="comment">    if( ! d-&gt;amountOfLeftOverlap &amp;&amp; ! d-&gt;amountOfRightOverlap )</span>
01240 <span class="comment">        return;</span>
01241 <span class="comment">    const int leftOverlap = d-&gt;amountOfLeftOverlap;</span>
01242 <span class="comment">    const int rightOverlap= d-&gt;amountOfRightOverlap;</span>
01243 <span class="comment">    d-&gt;amountOfLeftOverlap = 0;</span>
01244 <span class="comment">    d-&gt;amountOfRightOverlap = 0;</span>
01245 <span class="comment">    emit needAdjustLeftRightColumnsForOverlappingLabels(</span>
01246 <span class="comment">            this, leftOverlap, rightOverlap );</span>
01247 <span class="comment">}</span>
01248 <span class="comment"></span>
01249 <span class="comment">void CartesianAxis::adjustTopBottomGridRowHeights()</span>
01250 <span class="comment">{</span>
01251 <span class="comment">    if( ! d-&gt;amountOfTopOverlap &amp;&amp; ! d-&gt;amountOfBottomOverlap )</span>
01252 <span class="comment">        return;</span>
01253 <span class="comment">    const int topOverlap = d-&gt;amountOfTopOverlap;</span>
01254 <span class="comment">    const int bottomOverlap= d-&gt;amountOfBottomOverlap;</span>
01255 <span class="comment">    d-&gt;amountOfTopOverlap = 0;</span>
01256 <span class="comment">    d-&gt;amountOfBottomOverlap = 0;</span>
01257 <span class="comment">    emit needAdjustTopBottomRowsForOverlappingLabels(</span>
01258 <span class="comment">            this, topOverlap, bottomOverlap );</span>
01259 <span class="comment">}</span>
01260 <span class="comment">*/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu May 10 11:06:25 2007 for KD Chart 2 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
