<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KD Chart 2: KDChartLineDiagram.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>KDChartLineDiagram.cpp</h1><a href="_k_d_chart_line_diagram_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment"> ** Copyright (C) 2006 Klar√§vdalens Datakonsult AB.  All rights reserved.</span>
00003 <span class="comment"> **</span>
00004 <span class="comment"> ** This file is part of the KD Chart library.</span>
00005 <span class="comment"> **</span>
00006 <span class="comment"> ** This file may be distributed and/or modified under the terms of the</span>
00007 <span class="comment"> ** GNU General Public License version 2 as published by the Free Software</span>
00008 <span class="comment"> ** Foundtion and appearing in the file LICENSE.GPL included in the</span>
00009 <span class="comment"> ** packaging of this file.</span>
00010 <span class="comment"> **</span>
00011 <span class="comment"> ** Licensees holding valid commercial KD Chart licenses may use this file in</span>
00012 <span class="comment"> ** accordance with the KD Chart Commercial License Agreement provided with</span>
00013 <span class="comment"> ** the Software.</span>
00014 <span class="comment"> **</span>
00015 <span class="comment"> ** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00016 <span class="comment"> ** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00017 <span class="comment"> **</span>
00018 <span class="comment"> ** See http://www.kdab.net/kdchart for</span>
00019 <span class="comment"> **   information about KDChart Commercial License Agreements.</span>
00020 <span class="comment"> **</span>
00021 <span class="comment"> ** Contact info@kdab.net if any conditions of this</span>
00022 <span class="comment"> ** licensing are not clear to you.</span>
00023 <span class="comment"> **</span>
00024 <span class="comment"> **********************************************************************/</span>
00025 
00026 <span class="preprocessor">#include &lt;QDebug&gt;</span>
00027 <span class="preprocessor">#include &lt;QPainter&gt;</span>
00028 <span class="preprocessor">#include &lt;QString&gt;</span>
00029 <span class="preprocessor">#include &lt;QPainterPath&gt;</span>
00030 <span class="preprocessor">#include &lt;QPen&gt;</span>
00031 <span class="preprocessor">#include &lt;QVector&gt;</span>
00032 
00033 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_line_diagram_8h.html">KDChartLineDiagram.h</a>"</span>
00034 <span class="preprocessor">#include "KDChartLineDiagram_p.h"</span>
00035 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_bar_diagram_8h.html">KDChartBarDiagram.h</a>"</span>
00036 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_palette_8h.html">KDChartPalette.h</a>"</span>
00037 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_position_8h.html">KDChartPosition.h</a>"</span>
00038 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_text_attributes_8h.html">KDChartTextAttributes.h</a>"</span>
00039 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_three_d_line_attributes_8h.html">KDChartThreeDLineAttributes.h</a>"</span>
00040 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_attributes_model_8h.html">KDChartAttributesModel.h</a>"</span>
00041 <span class="preprocessor">#include "KDChartAbstractGrid.h"</span>
00042 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_data_value_attributes_8h.html">KDChartDataValueAttributes.h</a>"</span>
00043 
00044 <span class="preprocessor">#include &lt;KDABLibFakes&gt;</span>
00045 
00046 
00047 <span class="keyword">using</span> <span class="keyword">namespace </span>KDChart;
00048 
00049 LineDiagram::Private::Private()
00050   :lineType ( Normal )
00051 {
00052 }
00053 
00054 LineDiagram::Private::~Private() {}
00055 
00056 
<a name="l00057"></a><a class="code" href="_k_d_chart_line_diagram_8cpp.html#a0">00057</a> <span class="preprocessor">#define d d_func()</span>
00058 <span class="preprocessor"></span>
00059 
<a name="l00060"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama35">00060</a> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama35">LineDiagram::LineDiagram</a>( <a class="code" href="class_q_widget.html">QWidget</a>* parent, <a class="code" href="class_k_d_chart_1_1_cartesian_coordinate_plane.html">CartesianCoordinatePlane</a>* plane ) :
00061     <a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html">AbstractCartesianDiagram</a>( new Private(), parent, plane )
00062 {
00063     init();
00064 }
00065 
00066 <span class="keywordtype">void</span> LineDiagram::init()
00067 {
00068 }
00069 
<a name="l00070"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama94">00070</a> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama94">LineDiagram::~LineDiagram</a>()
00071 {
00072 }
00073 
<a name="l00074"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama8">00074</a> <a class="code" href="class_k_d_chart_1_1_line_diagram.html">LineDiagram</a> * <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama8">LineDiagram::clone</a>()<span class="keyword"> const</span>
00075 <span class="keyword"></span>{
00076     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama35">LineDiagram</a>( <span class="keyword">new</span> Private( *<a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a> ) );
00077 }
00078 
00079 
<a name="l00080"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama11">00080</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama11">LineDiagram::compare</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html">LineDiagram</a>* other )<span class="keyword">const</span>
00081 {
00082     <span class="keywordflow">if</span>( other == <span class="keyword">this</span> ) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00083     <span class="keywordflow">if</span>( ! other ){
00084         <span class="comment">//qDebug() &lt;&lt; "LineDiagram::compare() cannot compare to Null pointer";</span>
00085         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00086     }
00087     <span class="comment">/*</span>
00088 <span class="comment">    qDebug() &lt;&lt;"\n             LineDiagram::compare():";</span>
00089 <span class="comment">            // compare own properties</span>
00090 <span class="comment">    qDebug() &lt;&lt; (type() == other-&gt;type());</span>
00091 <span class="comment">    */</span>
00092     <span class="keywordflow">return</span>  <span class="comment">// compare the base class</span>
00093             ( static_cast&lt;const AbstractCartesianDiagram*&gt;(<span class="keyword">this</span>)-&gt;compare( other ) ) &amp;&amp;
00094             <span class="comment">// compare own properties</span>
00095             (type() == other-&gt;type());
00096 }
00097 
00098 
<a name="l00099"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama80">00099</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama80">LineDiagram::setType</a>( <span class="keyword">const</span> LineType type )
00100 {
00101    <span class="keywordflow">if</span> ( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;lineType == type ) <span class="keywordflow">return</span>;
00102    <span class="keywordflow">if</span> ( type != LineDiagram::Normal &amp;&amp; <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() &gt; 1 ) {
00103        Q_ASSERT_X ( <span class="keyword">false</span>, <span class="stringliteral">"setType()"</span>,
00104                     <span class="stringliteral">"This line chart type can't be used with multi-dimensional data."</span> );
00105        <span class="keywordflow">return</span>;
00106    }
00107    <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;lineType = type;
00108    <span class="comment">// AbstractAxis settings - see AbstractDiagram and CartesianAxis</span>
00109    <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama66">setPercentMode</a>( type == LineDiagram::Percent );
00110    <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb13">setDataBoundariesDirty</a>();
00111    emit layoutChanged( <span class="keyword">this</span> );
00112    emit <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb10">propertiesChanged</a>();
00113 }
00114 
<a name="l00115"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama85">00115</a> LineDiagram::LineType <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama85">LineDiagram::type</a>()<span class="keyword"> const</span>
00116 <span class="keyword"></span>{
00117    <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;lineType;
00118 }
00119 
<a name="l00120"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama68">00120</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama68">LineDiagram::setLineAttributes</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> &amp; ta )
00121 {
00122      <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setModelData(
00123         qVariantFromValue( ta ),
00124         <a class="code" href="namespace_k_d_chart.html#a21a12">LineAttributesRole</a> );
00125    emit <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb10">propertiesChanged</a>();
00126 }
00127 
<a name="l00128"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama67">00128</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama68">LineDiagram::setLineAttributes</a>(
00129         <span class="keywordtype">int</span> column,
00130     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> &amp; ta )
00131 {
00132     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setHeaderData(
00133             column,
00134             Qt::Vertical,
00135             qVariantFromValue( ta ),
00136             <a class="code" href="namespace_k_d_chart.html#a21a12">LineAttributesRole</a> );
00137     emit <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb10">propertiesChanged</a>();
00138 }
00139 
<a name="l00140"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama49">00140</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama49">LineDiagram::resetLineAttributes</a>( <span class="keywordtype">int</span> column )
00141 {
00142     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;resetHeaderData(
00143             column, Qt::Vertical, <a class="code" href="namespace_k_d_chart.html#a21a12">LineAttributesRole</a> );
00144     emit <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb10">propertiesChanged</a>();
00145 }
00146 
<a name="l00147"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama66">00147</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama68">LineDiagram::setLineAttributes</a>(
00148         <span class="keyword">const</span> QModelIndex &amp; index,
00149     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> &amp; ta )
00150 {
00151     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setData(
00152             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource(index),
00153     qVariantFromValue( ta ),
00154     <a class="code" href="namespace_k_d_chart.html#a21a12">LineAttributesRole</a> );
00155     emit <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb10">propertiesChanged</a>();
00156 }
00157 
<a name="l00161"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama48">00161</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama49">LineDiagram::resetLineAttributes</a>( <span class="keyword">const</span> QModelIndex &amp; index )
00162 {
00163     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;resetData(
00164             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource(index), <a class="code" href="namespace_k_d_chart.html#a21a12">LineAttributesRole</a> );
00165     emit <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb10">propertiesChanged</a>();
00166 }
00167 
<a name="l00168"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama34">00168</a> <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama34">LineDiagram::lineAttributes</a>()<span class="keyword"> const</span>
00169 <span class="keyword"></span>{
00170     <span class="keywordflow">return</span> qVariantValue&lt;LineAttributes&gt;(
00171         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data( KDChart::LineAttributesRole ) );
00172 }
00173 
<a name="l00174"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama33">00174</a> <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama34">LineDiagram::lineAttributes</a>( <span class="keywordtype">int</span> column )<span class="keyword"> const</span>
00175 <span class="keyword"></span>{
00176     <span class="keywordflow">return</span> qVariantValue&lt;LineAttributes&gt;(
00177         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data(
00178             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource( columnToIndex( column ) ),
00179             KDChart::LineAttributesRole ) );
00180 }
00181 
<a name="l00182"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama32">00182</a> <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama34">LineDiagram::lineAttributes</a>(
00183     <span class="keyword">const</span> QModelIndex &amp; index )<span class="keyword"> const</span>
00184 <span class="keyword"></span>{
00185     <span class="keywordflow">return</span> qVariantValue&lt;LineAttributes&gt;(
00186         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data(
00187             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource(index),
00188             KDChart::LineAttributesRole ) );
00189 }
00190 
<a name="l00191"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama79">00191</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama79">LineDiagram::setThreeDLineAttributes</a>(
00192     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_three_d_line_attributes.html">ThreeDLineAttributes</a> &amp; ta )
00193 {
00194     <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb13">setDataBoundariesDirty</a>();
00195     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setModelData(
00196         qVariantFromValue( ta ),
00197         <a class="code" href="namespace_k_d_chart.html#a21a13">ThreeDLineAttributesRole</a> );
00198    emit <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb10">propertiesChanged</a>();
00199 }
00200 
<a name="l00201"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama78">00201</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama79">LineDiagram::setThreeDLineAttributes</a>(
00202     <span class="keywordtype">int</span> column,
00203     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_three_d_line_attributes.html">ThreeDLineAttributes</a> &amp; ta )
00204 {
00205     <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb13">setDataBoundariesDirty</a>();
00206     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setHeaderData(
00207         column,
00208         Qt::Vertical,
00209         qVariantFromValue( ta ),
00210         <a class="code" href="namespace_k_d_chart.html#a21a13">ThreeDLineAttributesRole</a> );
00211    emit <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb10">propertiesChanged</a>();
00212 }
00213 
<a name="l00214"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama77">00214</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama79">LineDiagram::setThreeDLineAttributes</a>(
00215     <span class="keyword">const</span> QModelIndex &amp; index,
00216     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_three_d_line_attributes.html">ThreeDLineAttributes</a> &amp; ta )
00217 {
00218     <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb13">setDataBoundariesDirty</a>();
00219     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;setData(
00220         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource(index),
00221         qVariantFromValue( ta ),
00222         <a class="code" href="namespace_k_d_chart.html#a21a13">ThreeDLineAttributesRole</a> );
00223    emit <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb10">propertiesChanged</a>();
00224 }
00225 
<a name="l00226"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama84">00226</a> <a class="code" href="class_k_d_chart_1_1_three_d_line_attributes.html">ThreeDLineAttributes</a> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama84">LineDiagram::threeDLineAttributes</a>()<span class="keyword"> const</span>
00227 <span class="keyword"></span>{
00228     <span class="keywordflow">return</span> qVariantValue&lt;ThreeDLineAttributes&gt;(
00229         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data( KDChart::ThreeDLineAttributesRole ) );
00230 }
00231 
<a name="l00232"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama83">00232</a> <a class="code" href="class_k_d_chart_1_1_three_d_line_attributes.html">ThreeDLineAttributes</a> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama84">LineDiagram::threeDLineAttributes</a>( <span class="keywordtype">int</span> column )<span class="keyword"> const</span>
00233 <span class="keyword"></span>{
00234     <span class="keywordflow">return</span> qVariantValue&lt;ThreeDLineAttributes&gt;(
00235         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data(
00236             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource( columnToIndex( column ) ),
00237             KDChart::ThreeDLineAttributesRole ) );
00238 }
00239 
<a name="l00240"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama82">00240</a> <a class="code" href="class_k_d_chart_1_1_three_d_line_attributes.html">ThreeDLineAttributes</a> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama84">LineDiagram::threeDLineAttributes</a>(
00241     <span class="keyword">const</span> QModelIndex &amp; index )<span class="keyword"> const</span>
00242 <span class="keyword"></span>{
00243     <span class="keywordflow">return</span> qVariantValue&lt;ThreeDLineAttributes&gt;(
00244         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data(
00245             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;mapFromSource( index ),
00246             KDChart::ThreeDLineAttributesRole ) );
00247 }
00248 
<a name="l00249"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb16">00249</a> <span class="keywordtype">double</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb16">LineDiagram::threeDItemDepth</a>( <span class="keyword">const</span> QModelIndex &amp; index )<span class="keyword"> const</span>
00250 <span class="keyword"></span>{
00251     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama84">threeDLineAttributes</a>( index ).<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa13">validDepth</a>();
00252 }
00253 
<a name="l00254"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb15">00254</a> <span class="keywordtype">double</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb16">LineDiagram::threeDItemDepth</a>( <span class="keywordtype">int</span> column )<span class="keyword"> const</span>
00255 <span class="keyword"></span>{
00256     <span class="keywordflow">return</span> qVariantValue&lt;ThreeDLineAttributes&gt;(
00257         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;headerData (
00258             column,
00259             Qt::Vertical,
00260             KDChart::ThreeDLineAttributesRole ) ).validDepth();
00261 }
00262 
<a name="l00263"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb12">00263</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb12">LineDiagram::resizeEvent</a> ( QResizeEvent* )
00264 {
00265 }
00266 
<a name="l00267"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb1">00267</a> <span class="keyword">const</span> QPair&lt;QPointF, QPointF&gt; <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb1">LineDiagram::calculateDataBoundaries</a>()<span class="keyword"> const</span>
00268 <span class="keyword"></span>{
00269     <span class="keywordflow">if</span> ( !<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb2">checkInvariants</a>( <span class="keyword">true</span> ) ) <span class="keywordflow">return</span> QPair&lt;QPointF, QPointF&gt;( QPointF( 0, 0 ), QPointF( 0, 0 ) );
00270 
00271     <span class="comment">// note: calculateDataBoundaries() is ignoring the hidden flags.</span>
00272     <span class="comment">//       That's not a bug but a feature: Hiding data does not mean removing them.</span>
00273     <span class="comment">// For totally removing data from KD Chart's view people can use e.g. a proxy model ...</span>
00274 
00275     <span class="keyword">const</span> <span class="keywordtype">int</span> rowCount = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;rowCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00276     <span class="keyword">const</span> <span class="keywordtype">int</span> colCount = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;columnCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00277     <span class="keywordtype">double</span> xMin = 0;
00278     <span class="keywordtype">double</span> xMax = rowCount -1;
00279     <span class="keywordtype">double</span> yMin = 0, yMax = 0;
00280     <span class="keywordtype">bool</span> bOK;
00281 
00282     <span class="comment">// calculate boundaries for different line types Normal - Stacked - Percent - Default Normal</span>
00283     <span class="keywordflow">switch</span> ( <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama85">type</a>() ){
00284     <span class="keywordflow">case</span> LineDiagram::Normal:
00285     {
00286         <span class="keywordtype">bool</span> bStarting = <span class="keyword">true</span>;
00287         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>()-1; i &lt; colCount; i += <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() ) {
00288             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt; rowCount; ++j ) {
00289                 <span class="keyword">const</span> <span class="keywordtype">double</span> value = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb18">valueForCellTesting</a>( j, i, bOK );
00290                 <span class="keywordtype">double</span> xvalue;
00291                 <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() &gt; 1 &amp;&amp; bOK )
00292                     xvalue = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb18">valueForCellTesting</a>( j, i-1, bOK );
00293                 <span class="keywordflow">if</span>( bOK ){
00294                     <span class="keywordflow">if</span>( bStarting ){
00295                         yMin = value;
00296                         yMax = value;
00297                     }<span class="keywordflow">else</span>{
00298                         yMin = qMin( yMin, value );
00299                         yMax = qMax( yMax, value );
00300                     }
00301                     <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() &gt; 1 ) {
00302                         <span class="keywordflow">if</span>( bStarting ){
00303                             xMin = xvalue;
00304                             xMax = xvalue;
00305                         }<span class="keywordflow">else</span>{
00306                             xMin = qMin( xMin, xvalue );
00307                             xMax = qMax( xMax, xvalue );
00308                         }
00309                     }
00310                     bStarting = <span class="keyword">false</span>;
00311                 }
00312             }
00313         }
00314 
00315         <span class="comment">// the following code is replaced by CartesianCoordinatePlane's automatic range / zoom adjusting</span>
00316         <span class="comment">//if( yMin &gt; 0 &amp;&amp; yMax / yMin &gt;= 2.0 )</span>
00317         <span class="comment">//    yMin = 0;</span>
00318         <span class="comment">//else if( yMax &lt; 0 &amp;&amp; yMax / yMin &lt;= 0.5 )</span>
00319         <span class="comment">//    yMax = 0;</span>
00320     }
00321     <span class="keywordflow">break</span>;
00322     <span class="keywordflow">case</span> LineDiagram::Stacked:
00323     {
00324         <span class="keywordtype">bool</span> bStarting = <span class="keyword">true</span>;
00325         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt; rowCount; ++j ) {
00326             <span class="comment">// calculate sum of values per column - Find out stacked Min/Max</span>
00327             <span class="keywordtype">double</span> stackedValues = 0;
00328             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>()-1; i &lt; colCount; i += <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() ) {
00329                 <span class="keyword">const</span> <span class="keywordtype">double</span> value = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb18">valueForCellTesting</a>( j, i, bOK );
00330                 <span class="keywordflow">if</span>( bOK )
00331                     stackedValues += value;
00332             }
00333             <span class="keywordflow">if</span>( bStarting ){
00334                 yMin = stackedValues;
00335                 yMax = stackedValues;
00336                 bStarting = <span class="keyword">false</span>;
00337             }<span class="keywordflow">else</span>{
00338                 <span class="comment">// Pending Michel:</span>
00339                 <span class="comment">// I am taking in account all values negatives or positives</span>
00340                 <span class="comment">// take in account all stacked values</span>
00341                 yMin = qMin( qMin( yMin,  0.0 ), stackedValues );
00342                 yMax = qMax( yMax, stackedValues );
00343             }
00344         }
00345     }
00346     <span class="keywordflow">break</span>;
00347     <span class="keywordflow">case</span> LineDiagram::Percent:
00348     {
00349         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>()-1; i &lt; colCount; i += <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() ) {
00350             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt; rowCount; ++j ) {
00351                 <span class="comment">// Ordinate should begin at 0 the max value being the 100% pos</span>
00352                 <span class="keyword">const</span> <span class="keywordtype">double</span> value = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb18">valueForCellTesting</a>( j, i, bOK );
00353                 <span class="keywordflow">if</span>( bOK )
00354                     yMax = qMax( yMax, value );
00355             }
00356         }
00357     }
00358     <span class="keywordflow">break</span>;
00359     <span class="keywordflow">default</span>:
00360         Q_ASSERT_X ( <span class="keyword">false</span>, <span class="stringliteral">"calculateDataBoundaries()"</span>,
00361                      <span class="stringliteral">"Type item does not match a defined line chart Type."</span> );
00362     }
00363 
00364     QPointF bottomLeft( QPointF( xMin, yMin ) );
00365     QPointF topRight(   QPointF( xMax, yMax ) );
00366     <span class="comment">//qDebug() &lt;&lt; "LineDiagram::calculateDataBoundaries () returns ( " &lt;&lt; bottomLeft &lt;&lt; topRight &lt;&lt;")";</span>
00367     <span class="keywordflow">return</span> QPair&lt;QPointF, QPointF&gt; ( bottomLeft, topRight );
00368 }
00369 
00370 
<a name="l00371"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb9">00371</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb9">LineDiagram::paintEvent</a> ( QPaintEvent*)
00372 {
00373 <span class="comment">//qDebug() &lt;&lt; "starting LineDiagram::paintEvent ( QPaintEvent*)";</span>
00374     QPainter painter ( viewport() );
00375     <a class="code" href="class_k_d_chart_1_1_paint_context.html">PaintContext</a> ctx;
00376     ctx.<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta5">setPainter</a> ( &amp;painter );
00377     ctx.<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta6">setRectangle</a> ( QRectF ( 0, 0, width(), height() ) );
00378     <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb7">paint</a> ( &amp;ctx );
00379 <span class="comment">//qDebug() &lt;&lt; "         LineDiagram::paintEvent ( QPaintEvent*) ended.";</span>
00380 }
00381 
00382 
<a name="l00383"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb18">00383</a> <span class="keywordtype">double</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb18">LineDiagram::valueForCellTesting</a>( <span class="keywordtype">int</span> row, <span class="keywordtype">int</span> column,
00384                                          <span class="keywordtype">bool</span>&amp; bOK,
00385                                          <span class="keywordtype">bool</span> showHiddenCellsAsInvalid )<span class="keyword"> const</span>
00386 <span class="keyword"></span>{
00387     <span class="keywordtype">double</span> value;
00388     <span class="keywordflow">if</span>( showHiddenCellsAsInvalid &amp;&amp; <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama26">isHidden</a>( model()-&gt;index( row, column, rootIndex() ) ) )
00389         bOK = <span class="keyword">false</span>;
00390     <span class="keywordflow">else</span>
00391         value = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;data(
00392                     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;index( row, column, attributesModelRootIndex() )
00393                 ).toDouble( &amp;bOK );
00394     <span class="keywordflow">return</span> bOK ? value : 0.0;
00395 }
00396 
00397 
<a name="l00398"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb5">00398</a> LineAttributes::MissingValuesPolicy <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb5">LineDiagram::getCellValues</a>(
00399       <span class="keywordtype">int</span> row, <span class="keywordtype">int</span> column,
00400       <span class="keywordtype">bool</span> shiftCountedXValuesByHalfSection,
00401       <span class="keywordtype">double</span>&amp; valueX, <span class="keywordtype">double</span>&amp; valueY )<span class="keyword"> const</span>
00402 <span class="keyword"></span>{
00403     LineAttributes::MissingValuesPolicy policy;
00404 
00405     <span class="keywordtype">bool</span> bOK = <span class="keyword">true</span>;
00406     valueX = ( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() &gt; 1 &amp;&amp; column &gt; 0 )
00407            ? <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb18">valueForCellTesting</a>( row, column-1, bOK, <span class="keyword">true</span> )
00408            : ((shiftCountedXValuesByHalfSection ? 0.5 : 0.0) + row);
00409     <span class="keywordflow">if</span>( bOK )
00410         valueY = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb18">valueForCellTesting</a>( row, column, bOK, <span class="keyword">true</span> );
00411     <span class="keywordflow">if</span>( bOK ){
00412         policy = LineAttributes::MissingValuesPolicyIgnored;
00413     }<span class="keywordflow">else</span>{
00414         <span class="comment">// missing value: find out the policy</span>
00415         QModelIndex index = model()-&gt;index( row, column, rootIndex() );
00416         <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> la = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama34">lineAttributes</a>( index );
00417         policy = la.<a class="code" href="class_k_d_chart_1_1_line_attributes.html#_k_d_chart_1_1_line_attributesa3">missingValuesPolicy</a>();
00418     }
00419     <span class="keywordflow">return</span> policy;
00420 }
00421 
00422 <span class="comment">/*commenting this include: used for testing</span>
00423 <span class="comment">notice: Windows compilers need this include to</span>
00424 <span class="comment">be written before the #define d(d_func()) above*/</span>
00425 <span class="comment">//#include &lt;QTime&gt;</span>
00426 
<a name="l00427"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb7">00427</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb7">LineDiagram::paint</a>( <a class="code" href="class_k_d_chart_1_1_paint_context.html">PaintContext</a>* ctx )
00428 {
00429 <span class="comment">//qDebug() &lt;&lt; "    start diag::paint()";</span>
00430     <span class="comment">// note: Not having any data model assigned is no bug</span>
00431     <span class="comment">//       but we can not draw a diagram then either.</span>
00432     <span class="keywordflow">if</span> ( !<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb2">checkInvariants</a>( <span class="keyword">true</span> ) ) <span class="keywordflow">return</span>;
00433     <span class="keywordflow">if</span> ( !AbstractGrid::isBoundariesValid(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama10">dataBoundaries</a>()) ) <span class="keywordflow">return</span>;
00434 
00435     <span class="comment">// Make sure counted x values (== in diagrams with 1-dimensional data cells)</span>
00436     <span class="comment">// get shifted by 0.5, if the diagram's reference diagram is a BarDiagram.</span>
00437     <span class="comment">// So we get the lines to start/end at the middle of the respective bar groups.</span>
00438     <span class="keyword">const</span> <span class="keywordtype">bool</span> shiftCountedXValuesByHalfSection =
00439             (dynamic_cast&lt; BarDiagram* &gt;( <a class="code" href="class_k_d_chart_1_1_abstract_cartesian_diagram.html#_k_d_chart_1_1_line_diagrama46">referenceDiagram</a>() ) != 0);
00440 
00441     <span class="comment">//QTime t = QTime::currentTime();</span>
00442 
00443     <span class="keyword">const</span> QPair&lt;QPointF, QPointF&gt; boundaries = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama10">dataBoundaries</a>();
00444     <span class="keyword">const</span> QPointF bottomLeft = boundaries.first;
00445     <span class="keyword">const</span> QPointF topRight = boundaries.second;
00446 
00447     <span class="keywordtype">int</span> maxFound = 0;
00448     {   <span class="comment">// find the last column number that is not hidden</span>
00449         <span class="keyword">const</span> <span class="keywordtype">int</span> columnCount = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;columnCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00450         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> iColumn =  <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>()-1;
00451             iColumn &lt;  columnCount;
00452             iColumn += <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() )
00453             <span class="keywordflow">if</span>( ! <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama26">isHidden</a>( iColumn ) )
00454                 maxFound = iColumn;
00455     }
00456     <span class="keyword">const</span> <span class="keywordtype">int</span> lastVisibleColumn = maxFound;
00457     <span class="keyword">const</span> <span class="keywordtype">int</span> rowCount = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;rowCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00458 
00459     DataValueTextInfoList list;
00460     LineAttributesInfoList lineList;
00461     LineAttributes::MissingValuesPolicy policy;
00462 
00463     <span class="comment">// paint different line types Normal - Stacked - Percent - Default Normal</span>
00464     <span class="keywordflow">switch</span> ( <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama85">type</a>() )
00465     {
00466         <span class="keywordflow">case</span> LineDiagram::Normal:
00467         {
00468             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> iColumn  = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>()-1;
00469                      iColumn &lt;= lastVisibleColumn;
00470                      iColumn += <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() ) {
00471 
00472                 <span class="comment">//display area can be set by dataset ( == column) and/or by cell</span>
00473                 <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> laPreviousCell; <span class="comment">// by default no area is drawn</span>
00474                 QModelIndex indexPreviousCell;
00475                 QList&lt;QPolygonF&gt; areas;
00476 
00477                 <span class="keywordtype">bool</span> bValuesFound = <span class="keyword">false</span>;
00478                 <span class="keywordtype">double</span> lastValueX, lastValueY;
00479                 <span class="keywordtype">double</span> valueX, valueY;
00480                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> iRow = 0; iRow &lt; rowCount; ++iRow ) {
00481                     <span class="keywordtype">bool</span> skipThisCell = <span class="keyword">false</span>;
00482                     <span class="comment">// trying to find a fromPoint</span>
00483                     policy = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb5">getCellValues</a>( iRow, iColumn,
00484                                             shiftCountedXValuesByHalfSection,
00485                                             valueX, valueY );
00486                     <span class="keywordflow">switch</span>( policy ){
00487                         <span class="keywordflow">case</span> LineAttributes::MissingValuesAreBridged:
00488                             <span class="keywordflow">if</span>( bValuesFound ){
00489                                 valueX = lastValueX;
00490                                 valueY = lastValueY;
00491                             }<span class="keywordflow">else</span>{
00492                                 skipThisCell = <span class="keyword">true</span>;
00493                             }
00494                             <span class="keywordflow">break</span>;
00495                         <span class="keywordflow">case</span> LineAttributes::MissingValuesHideSegments:
00496                             skipThisCell = <span class="keyword">true</span>;
00497                             <span class="keywordflow">break</span>;
00498                         <span class="keywordflow">case</span> LineAttributes::MissingValuesShownAsZero:
00499                             <span class="comment">// fall through intended</span>
00500                         <span class="keywordflow">case</span> LineAttributes::MissingValuesPolicyIgnored:
00501                             lastValueX = valueX;
00502                             lastValueY = valueY;
00503                             bValuesFound = <span class="keyword">true</span>;
00504                             <span class="keywordflow">break</span>;
00505                     }
00506                     <span class="keywordflow">if</span>( ! skipThisCell ){
00507                         <span class="comment">// trying to find a toPoint</span>
00508                         <span class="keywordtype">double</span> nextValueX, nextValueY;
00509                         <span class="keywordtype">bool</span> foundToPoint = <span class="keyword">false</span>;
00510                         <span class="keywordtype">int</span> iNextRow = iRow+1;
00511                         <span class="keywordflow">while</span> ( ! (foundToPoint || skipThisCell || iNextRow &gt;= rowCount) ) {
00512                             policy = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagramb5">getCellValues</a>(
00513                                     iNextRow, iColumn,
00514                                     shiftCountedXValuesByHalfSection,
00515                                     nextValueX, nextValueY );
00516                             <span class="keywordflow">switch</span>( policy ){
00517                                 <span class="keywordflow">case</span> LineAttributes::MissingValuesAreBridged:
00518                                     <span class="comment">// The cell has no valid value, so we  make sure that</span>
00519                                     <span class="comment">// this cell will not be processed by the next iteration</span>
00520                                     <span class="comment">// of the iRow loop:</span>
00521                                     ++iRow;
00522                                     <span class="keywordflow">break</span>;
00523                                 <span class="keywordflow">case</span> LineAttributes::MissingValuesHideSegments:
00524                                     <span class="comment">// The cell has no valid value, so we  make sure that</span>
00525                                     <span class="comment">// this cell will not be processed by the next iteration</span>
00526                                     <span class="comment">// of the iRow loop:</span>
00527                                     skipThisCell = <span class="keyword">true</span>;
00528                                     ++iRow;
00529                                     <span class="keywordflow">break</span>;
00530                                 <span class="keywordflow">case</span> LineAttributes::MissingValuesShownAsZero:
00531                                     <span class="comment">// fall through intended</span>
00532                                 <span class="keywordflow">case</span> LineAttributes::MissingValuesPolicyIgnored:
00533                                     foundToPoint = <span class="keyword">true</span>;
00534                                     <span class="keywordflow">break</span>;
00535                             }
00536                             ++iNextRow;
00537                         }
00538                         <span class="keywordflow">if</span>( ! skipThisCell ){
00539                             <span class="keyword">const</span> <span class="keywordtype">bool</span> isPositive = (valueY &gt;= 0.0);
00540                             <span class="keyword">const</span> QModelIndex index = model()-&gt;index( iRow, iColumn, rootIndex() );
00541                             <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> laCell = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama34">lineAttributes</a>( index );
00542                             <span class="keyword">const</span> <span class="keywordtype">bool</span> bDisplayCellArea = laCell.<a class="code" href="class_k_d_chart_1_1_line_attributes.html#_k_d_chart_1_1_line_attributesa0">displayArea</a>();
00543 
00544                             QPointF fromPoint = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_abstract_coordinate_planea58">translate</a>( QPointF( valueX, valueY ) );
00545 
00546                             <span class="keyword">const</span> QPointF ptNorthWest(
00547                                 (bDisplayCellArea &amp;&amp; ! isPositive)
00548                                 ? <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;translate( QPointF( valueX, 0.0 ) )
00549                                 : fromPoint );
00550                             <span class="keyword">const</span> QPointF ptSouthWest(
00551                                 (bDisplayCellArea &amp;&amp; isPositive)
00552                                 ? <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;translate( QPointF( valueX, 0.0 ) )
00553                                 : fromPoint );
00554                             <span class="comment">//qDebug() &lt;&lt; "--&gt; ptNorthWest:" &lt;&lt; ptNorthWest;</span>
00555                             <span class="comment">//qDebug() &lt;&lt; "--&gt; ptSouthWest:" &lt;&lt; ptSouthWest;</span>
00556                             QPointF ptNorthEast;
00557                             QPointF ptSouthEast;
00558 
00559                             <span class="keywordflow">if</span>( foundToPoint ){
00560                                 QPointF toPoint = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_abstract_coordinate_planea58">translate</a>( QPointF( nextValueX, nextValueY ) );
00561                                 lineList.append( LineAttributesInfo( index, fromPoint, toPoint ) );
00562                                 ptNorthEast =
00563                                     (bDisplayCellArea &amp;&amp; ! isPositive)
00564                                     ? <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_abstract_coordinate_planea58">translate</a>( QPointF( nextValueX, 0.0 ) )
00565                                     : toPoint;
00566                                 ptSouthEast =
00567                                     (bDisplayCellArea &amp;&amp; isPositive)
00568                                     ? <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_abstract_coordinate_planea58">translate</a>( QPointF( nextValueX, 0.0 ) )
00569                                     : toPoint;
00570                                 <span class="comment">// we can't take as a condition the line attributes</span>
00571                                 <span class="comment">// to be different from a cell to another.</span>
00572                                 <span class="comment">// e.g the user should be able to have different brush</span>
00573                                 <span class="comment">// which is not reflected in the line attributes</span>
00574                                 <span class="comment">// see examples/Area which show such an option</span>
00575                                 <span class="keywordflow">if</span>( areas.count() <span class="comment">/*&amp;&amp; laCell != laPreviousCell*/</span> ){
00576                                     paintAreas( ctx, indexPreviousCell, areas, laPreviousCell.<a class="code" href="class_k_d_chart_1_1_line_attributes.html#_k_d_chart_1_1_line_attributesa10">transparency</a>() );
00577                                     areas.clear();
00578                                 }
00579                                 <span class="keywordflow">if</span>( bDisplayCellArea ){
00580                                     QPolygonF poly;
00581                                     poly &lt;&lt; ptNorthWest &lt;&lt; ptNorthEast &lt;&lt; ptSouthEast &lt;&lt; ptSouthWest;
00582                                     <span class="comment">//qDebug() &lt;&lt; "ptNorthWest:" &lt;&lt; ptNorthWest;</span>
00583                                     <span class="comment">//qDebug() &lt;&lt; "ptNorthEast:" &lt;&lt; ptNorthEast;</span>
00584                                     <span class="comment">//qDebug() &lt;&lt; "ptSouthEast:" &lt;&lt; ptSouthEast;</span>
00585                                     <span class="comment">//qDebug() &lt;&lt; "ptSouthWest:" &lt;&lt; ptSouthWest;</span>
00586                                     <span class="comment">//qDebug() &lt;&lt; "polygon:" &lt;&lt; poly;</span>
00587                                     areas &lt;&lt; poly;
00588                                     laPreviousCell = laCell;
00589                                     indexPreviousCell = index;
00590                                 }
00591                             }<span class="keywordflow">else</span>{
00592                                 ptNorthEast = ptNorthWest;
00593                                 ptSouthEast = ptSouthWest;
00594                             }
00595 
00596                             <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_position_points.html">PositionPoints</a> pts( ptNorthWest, ptNorthEast, ptSouthEast, ptSouthWest );
00597                             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;appendDataValueTextInfoToList( <span class="keyword">this</span>, list, index, pts,
00598                                     Position::NorthWest, Position::SouthWest,
00599                                     valueY );
00600                         }
00601                     }
00602                 }
00603                 <span class="keywordflow">if</span>( areas.count() ){
00604                     paintAreas( ctx, indexPreviousCell, areas, laPreviousCell.<a class="code" href="class_k_d_chart_1_1_line_attributes.html#_k_d_chart_1_1_line_attributesa10">transparency</a>() );
00605                     areas.clear();
00606                 }
00607             }
00608         }
00609             <span class="keywordflow">break</span>;
00610         <span class="keywordflow">case</span> LineDiagram::Stacked:
00611             <span class="comment">// fall-through intended</span>
00612         <span class="keywordflow">case</span> LineDiagram::Percent:
00613         {
00614             <span class="comment">//FIXME(khz): add LineAttributes::MissingValuesPolicy support for LineDiagram::Stacked and ::Percent</span>
00615 
00616             <span class="keyword">const</span> <span class="keywordtype">bool</span> isPercentMode = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama85">type</a>() == LineDiagram::Percent;
00617             <span class="keywordtype">double</span> maxValue = 100; <span class="comment">// always 100%</span>
00618             <span class="keywordtype">double</span> sumValues = 0;
00619             QVector &lt;double &gt; percentSumValues;
00620 
00621             <span class="comment">//calculate sum of values for each column and store</span>
00622             <span class="keywordflow">if</span>( isPercentMode ){
00623                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt;rowCount ; ++j ) {
00624                     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i =  <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>()-1;
00625                         i &lt;= lastVisibleColumn;
00626                         i += <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() ) {
00627                             <span class="keywordtype">double</span> tmpValue = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb14">valueForCell</a>( j, i );
00628                             <span class="keywordflow">if</span> ( tmpValue &gt; 0 )
00629                                 sumValues += tmpValue;
00630                             <span class="keywordflow">if</span> ( i == lastVisibleColumn ) {
00631                                 percentSumValues &lt;&lt;  sumValues ;
00632                                 sumValues = 0;
00633                             }
00634                         }
00635                 }
00636             }
00637 
00638             QList&lt;QPointF&gt; bottomPoints;
00639             <span class="keywordtype">bool</span> bFirstDataset = <span class="keyword">true</span>;
00640 
00641             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> iColumn =  <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>()-1;
00642                  iColumn &lt;= lastVisibleColumn;
00643                  iColumn += <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() ) {
00644 
00645                 <span class="comment">//display area can be set by dataset ( == column) and/or by cell</span>
00646                 <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> laPreviousCell; <span class="comment">// by default no area is drawn</span>
00647                 QModelIndex indexPreviousCell;
00648                 QList&lt;QPolygonF&gt; areas;
00649                 QList&lt;QPointF&gt; points;
00650 
00651                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> iRow = 0; iRow&lt; rowCount; ++iRow ) {
00652                     <span class="keyword">const</span> QModelIndex index = model()-&gt;index( iRow, iColumn, rootIndex() );
00653                     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_line_attributes.html">LineAttributes</a> laCell = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama34">lineAttributes</a>( index );
00654                     <span class="keyword">const</span> <span class="keywordtype">bool</span> bDisplayCellArea = laCell.<a class="code" href="class_k_d_chart_1_1_line_attributes.html#_k_d_chart_1_1_line_attributesa0">displayArea</a>();
00655 
00656                     <span class="keywordtype">double</span> stackedValues = 0, nextValues = 0;
00657                     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> iColumn2 = iColumn;
00658                           iColumn2 &gt;= <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>()-1;
00659                           iColumn2 -= <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama13">datasetDimension</a>() )
00660                     {
00661                         <span class="keyword">const</span> <span class="keywordtype">double</span> val = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb14">valueForCell</a>( iRow, iColumn2 );
00662                         <span class="keywordflow">if</span>( val &gt; 0 || ! isPercentMode )
00663                             stackedValues += val;
00664                         <span class="comment">//qDebug() &lt;&lt; valueForCell( iRow, iColumn2 );</span>
00665                         <span class="keywordflow">if</span> ( iRow+1 &lt; rowCount ){
00666                             <span class="keyword">const</span> <span class="keywordtype">double</span> val = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb14">valueForCell</a>( iRow+1, iColumn2 );
00667                             <span class="keywordflow">if</span>( val &gt; 0 || ! isPercentMode )
00668                                 nextValues += val;
00669                         }
00670                     }
00671                     <span class="keywordflow">if</span>( isPercentMode ){
00672                         <span class="keywordflow">if</span> ( percentSumValues.at( iRow ) != 0  )
00673                             stackedValues = stackedValues / percentSumValues.at( iRow ) * maxValue;
00674                         <span class="keywordflow">else</span>
00675                             stackedValues = 0.0;
00676                     }
00677                     <span class="comment">//qDebug() &lt;&lt; stackedValues &lt;&lt; endl;</span>
00678                     QPointF nextPoint = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_abstract_coordinate_planea58">translate</a>( QPointF( iRow, stackedValues ) );
00679                     points &lt;&lt; nextPoint;
00680 
00681                     <span class="keyword">const</span> QPointF ptNorthWest( nextPoint );
00682                     <span class="keyword">const</span> QPointF ptSouthWest(
00683                             bDisplayCellArea
00684                             ? ( bFirstDataset
00685                                 ? <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;translate( QPointF( iRow, 0.0 ) )
00686                                 : bottomPoints.at( iRow )
00687                               )
00688                             : nextPoint );
00689                     QPointF ptNorthEast;
00690                     QPointF ptSouthEast;
00691 
00692                     <span class="keywordflow">if</span> ( iRow+1 &lt; rowCount ){
00693                         <span class="keywordflow">if</span>( isPercentMode ){
00694                             <span class="keywordflow">if</span> ( percentSumValues.at( iRow+1 ) != 0  )
00695                                 nextValues = nextValues / percentSumValues.at( iRow+1 ) * maxValue;
00696                             <span class="keywordflow">else</span>
00697                                 nextValues = 0.0;
00698                         }
00699                         QPointF toPoint = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_abstract_coordinate_planea58">translate</a>( QPointF( iRow+1, nextValues ) );
00700                         lineList.append( LineAttributesInfo( index, nextPoint, toPoint ) );
00701                         ptNorthEast = toPoint;
00702                         ptSouthEast =
00703                             bDisplayCellArea
00704                             ? ( bFirstDataset
00705                                 ? <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama9">coordinatePlane</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_coordinate_plane.html#_k_d_chart_1_1_abstract_coordinate_planea58">translate</a>( QPointF( iRow+1, 0.0 ) )
00706                                 : bottomPoints.at( iRow+1 )
00707                               )
00708                             : toPoint;
00709                         <span class="keywordflow">if</span>( areas.count() &amp;&amp; laCell != laPreviousCell ){
00710                             paintAreas( ctx, indexPreviousCell, areas, laPreviousCell.<a class="code" href="class_k_d_chart_1_1_line_attributes.html#_k_d_chart_1_1_line_attributesa10">transparency</a>() );
00711                             areas.clear();
00712                         }
00713                         <span class="keywordflow">if</span>( bDisplayCellArea ){
00714                             QPolygonF poly;
00715                             poly &lt;&lt; ptNorthWest &lt;&lt; ptNorthEast &lt;&lt; ptSouthEast &lt;&lt; ptSouthWest;
00716                             areas &lt;&lt; poly;
00717                             laPreviousCell = laCell;
00718                             indexPreviousCell = index;
00719                         }<span class="keywordflow">else</span>{
00720                             <span class="comment">//qDebug() &lt;&lt; "no area shown for row"&lt;&lt;iRow&lt;&lt;"  column"&lt;&lt;iColumn;</span>
00721                         }
00722                     }<span class="keywordflow">else</span>{
00723                         ptNorthEast = ptNorthWest;
00724                         ptSouthEast = ptSouthWest;
00725                     }
00726 
00727                     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_position_points.html">PositionPoints</a> pts( ptNorthWest, ptNorthEast, ptSouthEast, ptSouthWest );
00728                     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;appendDataValueTextInfoToList( <span class="keyword">this</span>, list, index, pts,
00729                             Position::NorthWest, Position::SouthWest,
00730                             <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb14">valueForCell</a>( iRow, iColumn ) );
00731                 }
00732                 <span class="keywordflow">if</span>( areas.count() ){
00733                     paintAreas( ctx, indexPreviousCell, areas, laPreviousCell.<a class="code" href="class_k_d_chart_1_1_line_attributes.html#_k_d_chart_1_1_line_attributesa10">transparency</a>() );
00734                     areas.clear();
00735                 }
00736                 bottomPoints = points;
00737                 bFirstDataset = <span class="keyword">false</span>;
00738             }
00739         }
00740             <span class="keywordflow">break</span>;
00741         <span class="keywordflow">default</span>:
00742             Q_ASSERT_X ( <span class="keyword">false</span>, <span class="stringliteral">"paint()"</span>,
00743                          <span class="stringliteral">"Type item does not match a defined line chart Type."</span> );
00744     }
00745     <span class="comment">// paint all lines and their attributes</span>
00746     {
00747         PainterSaver painterSaver( ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>() );
00748         <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama1">antiAliasing</a>() )
00749             ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;setRenderHint ( QPainter::Antialiasing );
00750         LineAttributesInfoListIterator itline ( lineList );
00751 
00752         <span class="comment">//qDebug() &lt;&lt; "Rendering 1 in: " &lt;&lt; t.msecsTo( QTime::currentTime() ) &lt;&lt; endl;</span>
00753 
00754         QBrush curBrush;
00755         QPen curPen;
00756         QPolygonF points;
00757         <span class="keywordflow">while</span> ( itline.hasNext() ) {
00758             <span class="keyword">const</span> LineAttributesInfo&amp; lineInfo = itline.next();
00759             <span class="keyword">const</span> QModelIndex&amp; index = lineInfo.index;
00760             <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_three_d_line_attributes.html">ThreeDLineAttributes</a> td = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama84">threeDLineAttributes</a>( index );
00761             <span class="keywordflow">if</span>( td.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa1">isEnabled</a>() ){
00762                 paintThreeDLines( ctx, index, lineInfo.value, lineInfo.nextValue, td.<a class="code" href="class_k_d_chart_1_1_abstract_three_d_attributes.html#_k_d_chart_1_1_three_d_pie_attributesa0">depth</a>() );
00763             }<span class="keywordflow">else</span>{
00764                 <span class="keyword">const</span> QBrush br( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama5">brush</a>( index ) );
00765                 <span class="keyword">const</span> QPen   pn( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama37">pen</a>(   index ) );
00766                 <span class="keywordflow">if</span>( points.count() &amp;&amp; points.last() == lineInfo.value &amp;&amp; curBrush == br &amp;&amp; curPen == pn ){
00767                     points &lt;&lt; lineInfo.nextValue;
00768                 }<span class="keywordflow">else</span>{
00769                     <span class="keywordflow">if</span>( points.count() )
00770                         paintPolyline( ctx, curBrush, curPen, points );
00771                     curBrush = br;
00772                     curPen   = pn;
00773                     points.clear();
00774                     points &lt;&lt; lineInfo.value &lt;&lt; lineInfo.nextValue;
00775                 }
00776             }
00777         }
00778         <span class="keywordflow">if</span>( points.count() )
00779             paintPolyline( ctx, curBrush, curPen, points );
00780     }
00781     <span class="comment">// paint all data value texts and the point markers</span>
00782     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;paintDataValueTextsAndMarkers( <span class="keyword">this</span>, ctx, list, <span class="keyword">true</span> );
00783     <span class="comment">//qDebug() &lt;&lt; "Rendering 2 in: " &lt;&lt; t.msecsTo( QTime::currentTime() ) &lt;&lt; endl;</span>
00784 }
00785 
00786 
00787 <span class="keywordtype">void</span> LineDiagram::paintPolyline( <a class="code" href="class_k_d_chart_1_1_paint_context.html">PaintContext</a>* ctx,
00788                                  <span class="keyword">const</span> QBrush&amp; brush, <span class="keyword">const</span> QPen&amp; pen,
00789                                  <span class="keyword">const</span> QPolygonF&amp; points )<span class="keyword"> const</span>
00790 <span class="keyword"></span>{
00791     ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;setBrush( brush );
00792     ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;setPen(
00793         QPen( pen.color(),
00794               pen.width(),
00795               pen.style(),
00796               Qt::FlatCap,
00797               Qt::MiterJoin ) );
00798     ctx-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>()-&gt;drawPolyline( points );
00799 }
00800 
00801 
00802 <span class="comment">/* old:</span>
00803 <span class="comment">void LineDiagram::paintLines( PaintContext* ctx, const QModelIndex&amp; index,</span>
00804 <span class="comment">                              const QPointF&amp; from, const QPointF&amp; to )</span>
00805 <span class="comment">{</span>
00806 <span class="comment">    ThreeDLineAttributes td = threeDLineAttributes(index);</span>
00807 <span class="comment">    if ( td.isEnabled() ) {</span>
00808 <span class="comment">        const double lineDepth = td.depth();</span>
00809 <span class="comment">        paintThreeDLines( ctx, index, from, to, lineDepth );</span>
00810 <span class="comment">    } else {</span>
00811 <span class="comment">        ctx-&gt;painter()-&gt;setBrush( brush( index ) );</span>
00812 <span class="comment">        ctx-&gt;painter()-&gt;setPen( pen( index ) );</span>
00813 <span class="comment">        if ( index.row() + 1 &lt; d-&gt;attributesModel-&gt;rowCount(attributesModelRootIndex()) ) {</span>
00814 <span class="comment">            if ( ctx-&gt;rectangle().contains( from ) || ctx-&gt;rectangle().contains( to ) ) {</span>
00815 <span class="comment">                ctx-&gt;painter()-&gt;drawLine( from, to );</span>
00816 <span class="comment">            }</span>
00817 <span class="comment">        }</span>
00818 <span class="comment">    }</span>
00819 <span class="comment">}</span>
00820 <span class="comment">*/</span>
00821 
00822 
00823 <span class="keywordtype">void</span> LineDiagram::paintAreas( PaintContext* ctx, <span class="keyword">const</span> QModelIndex&amp; index, <span class="keyword">const</span> QPolygonF&amp; area, <span class="keyword">const</span> uint transparency )
00824 {
00825     QColor trans( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama5">brush</a>(index).color() );
00826     QPen indexPen( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama37">pen</a>(index) );
00827     trans.setAlpha( transparency );
00828     indexPen.setColor( trans );
00829     PainterSaver painterSaver( ctx-&gt;painter() );
00830     <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama1">antiAliasing</a>() )
00831         ctx-&gt;painter()-&gt;setRenderHint ( QPainter::Antialiasing );
00832     ctx-&gt;painter()-&gt;setPen( indexPen );
00833     ctx-&gt;painter()-&gt;setBrush( trans ) ;
00834     ctx-&gt;painter()-&gt;drawPolygon( area );<span class="comment">//pol );</span>
00835 }
00836 
00837 <span class="keywordtype">void</span> LineDiagram::paintAreas( PaintContext* ctx, <span class="keyword">const</span> QModelIndex&amp; index, <span class="keyword">const</span> QList&lt;QPolygonF&gt;&amp; areas, <span class="keyword">const</span> uint transparency )
00838 {
00839     QColor trans( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama5">brush</a>(index).color() );
00840     trans.setAlpha( transparency );
00841     QPen indexPen( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama37">pen</a>(index) );
00842     indexPen.setColor( trans );
00843     PainterSaver painterSaver( ctx-&gt;painter() );
00844     <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama1">antiAliasing</a>() )
00845         ctx-&gt;painter()-&gt;setRenderHint ( QPainter::Antialiasing );
00846     ctx-&gt;painter()-&gt;setPen( indexPen );
00847     ctx-&gt;painter()-&gt;setBrush( trans );
00848     QPainterPath path;
00849     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;areas.count(); ++i ){
00850         path.addPolygon( areas[i] );
00851         path.closeSubpath();
00852         <span class="comment">//qDebug() &lt;&lt; "LineDiagram::paintAreas() adding path:"&lt;&lt;areas[i];</span>
00853     }
00854     <span class="comment">//qDebug() &lt;&lt; endl;</span>
00855     ctx-&gt;painter()-&gt;drawPath( path );
00856 }
00857 
00864 <span class="keyword">const</span> QPointF LineDiagram::project( QPointF point, QPointF maxLimits, <span class="keywordtype">double</span> z, <span class="keyword">const</span> QModelIndex&amp; index )<span class="keyword"> const</span>
00865 <span class="keyword"></span>{
00866   <a class="code" href="class_k_d_chart_1_1_three_d_line_attributes.html">ThreeDLineAttributes</a> td = <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama84">threeDLineAttributes</a>( index );
00867 
00868     <span class="comment">//Pending Michel FIXME - the rotation does not work as expected atm</span>
00869     <span class="keywordtype">double</span> xrad = DEGTORAD( td.<a class="code" href="class_k_d_chart_1_1_three_d_line_attributes.html#_k_d_chart_1_1_three_d_line_attributesa2">lineXRotation</a>() );
00870     <span class="keywordtype">double</span> yrad = DEGTORAD( td.<a class="code" href="class_k_d_chart_1_1_three_d_line_attributes.html#_k_d_chart_1_1_three_d_line_attributesa3">lineYRotation</a>() );
00871     QPointF ret = QPointF(point.x()*cos( yrad ) + z * sin( yrad ) ,  point.y()*cos( xrad ) - z * sin( xrad ) );
00872     <span class="keywordflow">return</span> ret;
00873 }
00874 
00875 <span class="keywordtype">void</span> LineDiagram::paintThreeDLines(PaintContext* ctx, <span class="keyword">const</span> QModelIndex&amp; index, <span class="keyword">const</span> QPointF&amp; from, <span class="keyword">const</span> QPointF&amp; to, <span class="keyword">const</span> <span class="keywordtype">double</span> depth  )
00876 {
00877     <span class="comment">// retrieve the boundaries</span>
00878     <span class="keyword">const</span> QPair&lt;QPointF, QPointF&gt; boundaries = <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama10">dataBoundaries</a> ();
00879     QPointF maxLimits = boundaries.second;
00880     QVector &lt;QPointF &gt; segmentPoints;
00881     QPointF topLeft = project( from, maxLimits, depth, index  );
00882     QPointF topRight = project ( to, maxLimits, depth, index  );
00883 
00884     segmentPoints &lt;&lt; from &lt;&lt; topLeft &lt;&lt; topRight &lt;&lt; to;
00885     QPolygonF segment ( segmentPoints );
00886     QBrush indexBrush ( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama5">brush</a>( index ) );
00887     PainterSaver painterSaver( ctx-&gt;painter() );
00888     <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama1">antiAliasing</a>() )
00889         ctx-&gt;painter()-&gt;setRenderHint ( QPainter::Antialiasing );
00890     ctx-&gt;painter()-&gt;setBrush( indexBrush );
00891     ctx-&gt;painter()-&gt;setPen( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama37">pen</a>( index ) ) ;
00892     ctx-&gt;painter()-&gt;drawPolygon( segment );
00893 }
00894 
<a name="l00895"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama50">00895</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama50">LineDiagram::resize</a> ( <span class="keyword">const</span> QSizeF&amp; )
00896 {
00897 }
00898 
<a name="l00899"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama37">00899</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama37">LineDiagram::numberOfAbscissaSegments</a> ()<span class="keyword"> const</span>
00900 <span class="keyword"></span>{
00901     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;rowCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00902 }
00903 
<a name="l00904"></a><a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama38">00904</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="class_k_d_chart_1_1_line_diagram.html#_k_d_chart_1_1_line_diagrama38">LineDiagram::numberOfOrdinateSegments</a> ()<span class="keyword"> const</span>
00905 <span class="keyword"></span>{
00906     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;attributesModel-&gt;columnCount(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagramb0">attributesModelRootIndex</a>());
00907 }
00908 
00909 <span class="comment">//#endif</span>
00910 
00911 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu May 10 11:06:25 2007 for KD Chart 2 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
