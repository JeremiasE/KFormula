<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KD Chart 2: KDChartLegend.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>KDChartLegend.cpp</h1><a href="_k_d_chart_legend_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment"> ** Copyright (C) 2006 Klarï¿½vdalens Datakonsult AB.  All rights reserved.</span>
00003 <span class="comment"> **</span>
00004 <span class="comment"> ** This file is part of the KD Chart library.</span>
00005 <span class="comment"> **</span>
00006 <span class="comment"> ** This file may be distributed and/or modified under the terms of the</span>
00007 <span class="comment"> ** GNU General Public License version 2 as published by the Free Software</span>
00008 <span class="comment"> ** Foundation and appearing in the file LICENSE.GPL included in the</span>
00009 <span class="comment"> ** packaging of this file.</span>
00010 <span class="comment"> **</span>
00011 <span class="comment"> ** Licensees holding valid commercial KD Chart licenses may use this file in</span>
00012 <span class="comment"> ** accordance with the KD Chart Commercial License Agreement provided with</span>
00013 <span class="comment"> ** the Software.</span>
00014 <span class="comment"> **</span>
00015 <span class="comment"> ** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00016 <span class="comment"> ** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00017 <span class="comment"> **</span>
00018 <span class="comment"> ** See http://www.kdab.net/kdchart for</span>
00019 <span class="comment"> **   information about KDChart Commercial License Agreements.</span>
00020 <span class="comment"> **</span>
00021 <span class="comment"> ** Contact info@kdab.net if any conditions of this</span>
00022 <span class="comment"> ** licensing are not clear to you.</span>
00023 <span class="comment"> **</span>
00024 <span class="comment"> **********************************************************************/</span>
00025 
00026 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_legend_8h.html">KDChartLegend.h</a>"</span>
00027 <span class="preprocessor">#include "KDChartLegend_p.h"</span>
00028 <span class="preprocessor">#include &lt;<a class="code" href="_k_d_chart_text_attributes_8h.html">KDChartTextAttributes.h</a>&gt;</span>
00029 <span class="preprocessor">#include &lt;<a class="code" href="_k_d_chart_marker_attributes_8h.html">KDChartMarkerAttributes.h</a>&gt;</span>
00030 <span class="preprocessor">#include &lt;QFont&gt;</span>
00031 <span class="preprocessor">#include &lt;QPainter&gt;</span>
00032 <span class="preprocessor">#include &lt;QTextTableCell&gt;</span>
00033 <span class="preprocessor">#include &lt;QTextCursor&gt;</span>
00034 <span class="preprocessor">#include &lt;QTextCharFormat&gt;</span>
00035 <span class="preprocessor">#include &lt;QTextDocumentFragment&gt;</span>
00036 <span class="preprocessor">#include &lt;QTimer&gt;</span>
00037 <span class="preprocessor">#include &lt;QAbstractTextDocumentLayout&gt;</span>
00038 <span class="preprocessor">#include &lt;QtDebug&gt;</span>
00039 <span class="preprocessor">#include &lt;QLabel&gt;</span>
00040 <span class="preprocessor">#include &lt;<a class="code" href="_k_d_chart_abstract_diagram_8h.html">KDChartAbstractDiagram.h</a>&gt;</span>
00041 <span class="preprocessor">#include "<a class="code" href="_k_d_text_document_8h.html">KDTextDocument.h</a>"</span>
00042 <span class="preprocessor">#include &lt;<a class="code" href="_k_d_chart_diagram_observer_8h.html">KDChartDiagramObserver.h</a>&gt;</span>
00043 <span class="preprocessor">#include &lt;QGridLayout&gt;</span>
00044 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_layout_items_8h.html">KDChartLayoutItems.h</a>"</span>
00045 
00046 <span class="preprocessor">#include &lt;KDABLibFakes&gt;</span>
00047 
00048 <span class="keyword">using</span> <span class="keyword">namespace </span>KDChart;
00049 
00050 Legend::Private::Private() :
00051     referenceArea(0),
00052     position( <a class="code" href="class_k_d_chart_1_1_position.html">Position</a>::East ),
00053     alignment( Qt::AlignCenter ),
00054     relativePosition( <a class="code" href="class_k_d_chart_1_1_relative_position.html">RelativePosition</a>() ),
00055     orientation( Qt::Vertical ),
00056     showLines( false ),
00057     texts(),
00058     textAttributes(),
00059     titleText( <a class="code" href="class_q_object.html">QObject</a>::tr( "<a class="code" href="class_k_d_chart_1_1_legend.html">Legend</a>" ) ),
00060     titleTextAttributes(),
00061     spacing( 1 ),
00062     useAutomaticMarkerSize( true ),
00063     legendStyle( MarkersOnly )
00064     <span class="comment">//needRebuild( true )</span>
00065 {
00066     <span class="comment">// By default we specify a simple, hard point as the 'relative' position's ref. point,</span>
00067     <span class="comment">// since we can not be sure that there will be any parent specified for the legend.</span>
00068     relativePosition.setReferencePoints(   <a class="code" href="class_k_d_chart_1_1_position_points.html">PositionPoints</a>( QPointF( 0.0, 0.0 ) ) );
00069     relativePosition.setReferencePosition( Position::NorthWest );
00070     relativePosition.setAlignment( Qt::AlignTop | Qt::AlignLeft );
00071     relativePosition.setHorizontalPadding( <a class="code" href="class_k_d_chart_1_1_measure.html">KDChart::Measure</a>( 4.0, KDChartEnums::MeasureCalculationModeAbsolute ) );
00072     relativePosition.setVerticalPadding(   <a class="code" href="class_k_d_chart_1_1_measure.html">KDChart::Measure</a>( 4.0, KDChartEnums::MeasureCalculationModeAbsolute ) );
00073 }
00074 
00075 Legend::Private::~Private()
00076 {
00077     <span class="comment">// this bloc left empty intentionally</span>
00078 }
00079 
00080 
00081 
<a name="l00082"></a><a class="code" href="_k_d_chart_legend_8cpp.html#a0">00082</a> <span class="preprocessor">#define d d_func()</span>
00083 <span class="preprocessor"></span>
00084 
<a name="l00085"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda20">00085</a> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda20">Legend::Legend</a>( <a class="code" href="class_q_widget.html">QWidget</a>* parent ) :
00086     <a class="code" href="class_k_d_chart_1_1_abstract_area_widget.html">AbstractAreaWidget</a>( new Private(), parent )
00087 {
00088     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;referenceArea = parent;
00089     init();
00090 }
00091 
<a name="l00092"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda19">00092</a> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda20">Legend::Legend</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">KDChart::AbstractDiagram</a>* diagram, <a class="code" href="class_q_widget.html">QWidget</a>* parent ) :
00093     <a class="code" href="class_k_d_chart_1_1_abstract_area_widget.html">AbstractAreaWidget</a>( new Private(), parent )
00094 {
00095     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;referenceArea = parent;
00096     init();
00097     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda51">setDiagram</a>( diagram );
00098 }
00099 
<a name="l00100"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda80">00100</a> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda80">Legend::~Legend</a>()
00101 {
00102     emit destroyedLegend( <span class="keyword">this</span> );
00103 }
00104 
00105 <span class="keywordtype">void</span> Legend::init()
00106 {
00107     setSizePolicy( QSizePolicy::Fixed, QSizePolicy::Fixed );
00108 
00109     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout = <span class="keyword">new</span> QGridLayout( <span class="keyword">this</span> );
00110     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;setMargin( 2 );
00111     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;setSpacing( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;spacing );
00112     <span class="comment">//setLayout( d-&gt;layout );</span>
00113 
00114     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_measure.html">Measure</a> normalFontSizeTitle(  12, KDChartEnums::MeasureCalculationModeAbsolute );
00115     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_measure.html">Measure</a> normalFontSizeLabels( 10, KDChartEnums::MeasureCalculationModeAbsolute );
00116     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_measure.html">Measure</a> minimalFontSize(       4, KDChartEnums::MeasureCalculationModeAbsolute );
00117 
00118     <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> textAttrs;
00119     textAttrs.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa19">setPen</a>( QPen( Qt::black ) );
00120     textAttrs.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa16">setFont</a>( QFont( QLatin1String( <span class="stringliteral">"helvetica"</span> ), 10, QFont::Normal, <span class="keyword">false</span> ) );
00121     textAttrs.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa17">setFontSize</a>(        normalFontSizeLabels );
00122     textAttrs.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa18">setMinimalFontSize</a>( minimalFontSize );
00123     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda66">setTextAttributes</a>( textAttrs );
00124 
00125     <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> titleTextAttrs;
00126     titleTextAttrs.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa19">setPen</a>( QPen( Qt::black ) );
00127     titleTextAttrs.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa16">setFont</a>( QFont( QLatin1String( <span class="stringliteral">"helvetica"</span> ), 12, QFont::Bold, <span class="keyword">false</span> ) );
00128     titleTextAttrs.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa17">setFontSize</a>(        normalFontSizeTitle );
00129     titleTextAttrs.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa18">setMinimalFontSize</a>( minimalFontSize );
00130     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda68">setTitleTextAttributes</a>( titleTextAttrs );
00131 
00132     <a class="code" href="class_k_d_chart_1_1_frame_attributes.html">FrameAttributes</a> frameAttrs;
00133     frameAttrs.<a class="code" href="class_k_d_chart_1_1_frame_attributes.html#_k_d_chart_1_1_frame_attributesa10">setVisible</a>( <span class="keyword">true</span> );
00134     frameAttrs.<a class="code" href="class_k_d_chart_1_1_frame_attributes.html#_k_d_chart_1_1_frame_attributesa9">setPen</a>( QPen( Qt::black ) );
00135     frameAttrs.<a class="code" href="class_k_d_chart_1_1_frame_attributes.html#_k_d_chart_1_1_frame_attributesa8">setPadding</a>( 1 );
00136     <a class="code" href="class_k_d_chart_1_1_abstract_area_base.html#_k_d_chart_1_1_text_areaa25">setFrameAttributes</a>( frameAttrs );
00137 
00138     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;position = Position::NorthEast;
00139     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;alignment = Qt::AlignCenter;
00140 }
00141 
00142 
<a name="l00143"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda24">00143</a> QSize <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda24">Legend::minimumSizeHint</a>()<span class="keyword"> const</span>
00144 <span class="keyword"></span>{
00145     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda72">sizeHint</a>();
00146 }
00147 
00148 <span class="comment">//#define DEBUG_LEGEND_PAINT</span>
00149 
<a name="l00150"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda72">00150</a> QSize <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda72">Legend::sizeHint</a>()<span class="keyword"> const</span>
00151 <span class="keyword"></span>{
00152 <span class="preprocessor">#ifdef DEBUG_LEGEND_PAINT</span>
00153 <span class="preprocessor"></span>    qDebug()  &lt;&lt; <span class="stringliteral">"Legend::sizeHint() started"</span>;
00154 <span class="preprocessor">#endif</span>
00155 <span class="preprocessor"></span>    Q_FOREACH( <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">KDChart::AbstractLayoutItem</a>* layoutItem, <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems ) {
00156         layoutItem-&gt;sizeHint();
00157     }
00158     <span class="keywordflow">return</span> AbstractAreaWidget::sizeHint();
00159 }
00160 
<a name="l00161"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda25">00161</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda25">Legend::needSizeHint</a>()
00162 {
00163     <span class="comment">// Re-build the Legend's content, if it has not been build yet,</span>
00164     <span class="comment">// or if the Legend's geometry has changed, resp.</span>
00165     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda7">buildLegend</a>();
00166 }
00167 
<a name="l00168"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda44">00168</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda44">Legend::resizeLayout</a>( <span class="keyword">const</span> QSize&amp; size )
00169 {
00170 <span class="preprocessor">#ifdef DEBUG_LEGEND_PAINT</span>
00171 <span class="preprocessor"></span>    qDebug() &lt;&lt; <span class="stringliteral">"Legend::resizeLayout started"</span>;
00172 <span class="preprocessor">#endif</span>
00173 <span class="preprocessor"></span>    <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout ){
00174         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;setGeometry( QRect(QPoint(0,0), size) );
00175         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda0">activateTheLayout</a>();
00176     }
00177 <span class="preprocessor">#ifdef DEBUG_LEGEND_PAINT</span>
00178 <span class="preprocessor"></span>    qDebug() &lt;&lt; <span class="stringliteral">"Legend::resizeLayout done"</span>;
00179 <span class="preprocessor">#endif</span>
00180 <span class="preprocessor"></span>}
00181 
<a name="l00182"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda0">00182</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda0">Legend::activateTheLayout</a>()
00183 {
00184     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout &amp;&amp; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;parent() )
00185         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;activate();
00186 }
00187 
00188 
<a name="l00189"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda54">00189</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda54">Legend::setLegendStyle</a>( LegendStyle style )
00190 {
00191     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;legendStyle == style ) <span class="keywordflow">return</span>;
00192     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;legendStyle = style;
00193     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00194 }
00195 
<a name="l00196"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda21">00196</a> Legend::LegendStyle <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda21">Legend::legendStyle</a>()<span class="keyword"> const</span>
00197 <span class="keyword"></span>{
00198     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;legendStyle;
00199 }
00200 
<a name="l00201"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda8">00201</a> <a class="code" href="class_k_d_chart_1_1_legend.html">Legend</a>* <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda8">Legend::clone</a>()<span class="keyword"> const</span>
00202 <span class="keyword"></span>{
00203     <a class="code" href="class_k_d_chart_1_1_legend.html">Legend</a>* legend = <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda20">Legend</a>( <span class="keyword">new</span> Private( *<a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a> ), 0 );
00204     legend-&gt;<a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda66">setTextAttributes</a>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda75">textAttributes</a>() );
00205     legend-&gt;<a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda68">setTitleTextAttributes</a>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda78">titleTextAttributes</a>() );
00206     legend-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_area_base.html#_k_d_chart_1_1_text_areaa25">setFrameAttributes</a>( <a class="code" href="class_k_d_chart_1_1_abstract_area_base.html#_k_d_chart_1_1_text_areaa5">frameAttributes</a>() );
00207     legend-&gt;<a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda69">setUseAutomaticMarkerSize</a>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda79">useAutomaticMarkerSize</a>() );
00208     legend-&gt;<a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda59">setPosition</a>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda35">position</a>() );
00209     legend-&gt;<a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda45">setAlignment</a>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda2">alignment</a>() );
00210     legend-&gt;<a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda54">setLegendStyle</a>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda21">legendStyle</a>() );
00211     <span class="keywordflow">return</span> legend;
00212 }
00213 
00214 
<a name="l00215"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda10">00215</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda10">Legend::compare</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_legend.html">Legend</a>* other )<span class="keyword">const</span>
00216 {
00217     <span class="keywordflow">if</span>( other == <span class="keyword">this</span> ) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00218     <span class="keywordflow">if</span>( ! other ){
00219         <span class="comment">//qDebug() &lt;&lt; "Legend::compare() cannot compare to Null pointer";</span>
00220         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00221     }
00222     <span class="comment">/*</span>
00223 <span class="comment">    qDebug() &lt;&lt; ( static_cast&lt;const AbstractAreaBase*&gt;(this)-&gt;compare( other ) );</span>
00224 <span class="comment">    qDebug() &lt;&lt; (isVisible()              == other-&gt;isVisible());</span>
00225 <span class="comment">    qDebug() &lt;&lt; (position()               == other-&gt;position());</span>
00226 <span class="comment">    qDebug() &lt;&lt; (alignment()              == other-&gt;alignment());</span>
00227 <span class="comment">    qDebug() &lt;&lt; (floatingPosition()       == other-&gt;floatingPosition());</span>
00228 <span class="comment">    qDebug() &lt;&lt; (orientation()            == other-&gt;orientation());</span>
00229 <span class="comment">    qDebug() &lt;&lt; (showLines()              == other-&gt;showLines());</span>
00230 <span class="comment">    qDebug() &lt;&lt; (texts()                  == other-&gt;texts());</span>
00231 <span class="comment">    qDebug() &lt;&lt; (brushes()                == other-&gt;brushes());</span>
00232 <span class="comment">    qDebug() &lt;&lt; (pens()                   == other-&gt;pens());</span>
00233 <span class="comment">    qDebug() &lt;&lt; (markerAttributes()       == other-&gt;markerAttributes());</span>
00234 <span class="comment">    qDebug() &lt;&lt; (useAutomaticMarkerSize() == other-&gt;useAutomaticMarkerSize());</span>
00235 <span class="comment">    qDebug() &lt;&lt; (textAttributes()         == other-&gt;textAttributes());</span>
00236 <span class="comment">    qDebug() &lt;&lt; (titleText()              == other-&gt;titleText());</span>
00237 <span class="comment">    qDebug() &lt;&lt; (titleTextAttributes()    == other-&gt;titleTextAttributes());</span>
00238 <span class="comment">    qDebug() &lt;&lt; (spacing()                == other-&gt;spacing());</span>
00239 <span class="comment">    qDebug() &lt;&lt; (legendStyle()            == other-&gt;legendStyle());</span>
00240 <span class="comment">    */</span>
00241     <span class="keywordflow">return</span>  ( static_cast&lt;const AbstractAreaBase*&gt;(<span class="keyword">this</span>)-&gt;compare( other ) ) &amp;&amp;
00242             (isVisible()              == other-&gt;isVisible()) &amp;&amp;
00243             (position()               == other-&gt;position()) &amp;&amp;
00244             (alignment()              == other-&gt;alignment())&amp;&amp;
00245             (floatingPosition()       == other-&gt;floatingPosition()) &amp;&amp;
00246             (orientation()            == other-&gt;orientation())&amp;&amp;
00247             (showLines()              == other-&gt;showLines())&amp;&amp;
00248             (texts()                  == other-&gt;texts())&amp;&amp;
00249             (brushes()                == other-&gt;brushes())&amp;&amp;
00250             (pens()                   == other-&gt;pens())&amp;&amp;
00251             (markerAttributes()       == other-&gt;markerAttributes())&amp;&amp;
00252             (useAutomaticMarkerSize() == other-&gt;useAutomaticMarkerSize()) &amp;&amp;
00253             (textAttributes()         == other-&gt;textAttributes()) &amp;&amp;
00254             (titleText()              == other-&gt;titleText())&amp;&amp;
00255             (titleTextAttributes()    == other-&gt;titleTextAttributes()) &amp;&amp;
00256             (spacing()                == other-&gt;spacing()) &amp;&amp;
00257             (legendStyle()            == other-&gt;legendStyle());
00258 }
00259 
00260 
<a name="l00261"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda27">00261</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda27">Legend::paint</a>( QPainter* painter )
00262 {
00263 <span class="preprocessor">#ifdef DEBUG_LEGEND_PAINT</span>
00264 <span class="preprocessor"></span>    qDebug() &lt;&lt; <span class="stringliteral">"entering Legend::paint( QPainter* painter )"</span>;
00265 <span class="preprocessor">#endif</span>
00266 <span class="preprocessor"></span>    <span class="comment">// rule: We do not show a legend, if there is no diagram.</span>
00267     <span class="keywordflow">if</span>( ! <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda13">diagram</a>() ) <span class="keywordflow">return</span>;
00268 
00269     <span class="comment">// re-calculate/adjust the Legend's internal layout and contents, if needed:</span>
00270     <span class="comment">//buildLegend();</span>
00271 
00272     <span class="comment">// PENDING(kalle) Support palette</span>
00273 
00274     Q_FOREACH( <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">KDChart::AbstractLayoutItem</a>* layoutItem, <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems ) {
00275         layoutItem-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_abstract_layout_itema1">paint</a>( painter );
00276     }
00277 <span class="preprocessor">#ifdef DEBUG_LEGEND_PAINT</span>
00278 <span class="preprocessor"></span>    qDebug() &lt;&lt; <span class="stringliteral">"leaving Legend::paint( QPainter* painter )"</span>;
00279 <span class="preprocessor">#endif</span>
00280 <span class="preprocessor"></span>}
00281 
00282 
<a name="l00283"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda12">00283</a> uint <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda12">Legend::datasetCount</a>()<span class="keyword"> const</span>
00284 <span class="keyword"></span>{
00285     <span class="keywordtype">int</span> modelLabelsCount = 0;
00286     <span class="keywordtype">int</span> modelBrushesCount = 0;
00287     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.size(); ++i) {
00288         <a class="code" href="class_k_d_chart_1_1_diagram_observer.html">DiagramObserver</a> * obs = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.at(i);
00289         modelLabelsCount  += obs-&gt;<a class="code" href="class_k_d_chart_1_1_diagram_observer.html#_k_d_chart_1_1_diagram_observera1">diagram</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama14">datasetLabels</a>().count();
00290         modelBrushesCount += obs-&gt;<a class="code" href="class_k_d_chart_1_1_diagram_observer.html#_k_d_chart_1_1_diagram_observera1">diagram</a>()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama12">datasetBrushes</a>().count();
00291     }
00292     Q_ASSERT( modelLabelsCount == modelBrushesCount );
00293     <span class="keywordflow">return</span> modelLabelsCount;
00294 }
00295 
00296 
<a name="l00297"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda61">00297</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda61">Legend::setReferenceArea</a>( <span class="keyword">const</span> <a class="code" href="class_q_widget.html">QWidget</a>* area )
00298 {
00299     <span class="keywordflow">if</span>( area == <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;referenceArea ) <span class="keywordflow">return</span>;
00300     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;referenceArea = area;
00301     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00302 }
00303 
<a name="l00304"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda37">00304</a> <span class="keyword">const</span> <a class="code" href="class_q_widget.html">QWidget</a>* <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda37">Legend::referenceArea</a>()<span class="keyword"> const</span>
00305 <span class="keyword"></span>{
00306     <span class="comment">//qDebug() &lt;&lt; d-&gt;referenceArea;</span>
00307     <span class="keywordflow">return</span> (<a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;referenceArea ? <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;referenceArea : static_cast&lt;const QWidget*&gt;(parent()));
00308 }
00309 
00310 
<a name="l00311"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda13">00311</a> <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>* <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda13">Legend::diagram</a>()<span class="keyword"> const</span>
00312 <span class="keyword"></span>{
00313     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.isEmpty() )
00314         <span class="keywordflow">return</span> 0;
00315     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.first()-&gt;diagram();
00316 }
00317 
<a name="l00318"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda14">00318</a> <a class="code" href="namespace_k_d_chart.html#a19">DiagramList</a> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda14">Legend::diagrams</a>()<span class="keyword"> const</span>
00319 <span class="keyword"></span>{
00320     <a class="code" href="namespace_k_d_chart.html#a19">DiagramList</a> list;
00321     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.size(); ++i)
00322         list &lt;&lt; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.at(i)-&gt;diagram();
00323     <span class="keywordflow">return</span> list;
00324 }
00325 
<a name="l00326"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda11">00326</a> <a class="code" href="namespace_k_d_chart.html#a20">ConstDiagramList</a> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda11">Legend::constDiagrams</a>()<span class="keyword"> const</span>
00327 <span class="keyword"></span>{
00328     <a class="code" href="namespace_k_d_chart.html#a20">ConstDiagramList</a> list;
00329     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.size(); ++i)
00330         list &lt;&lt; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.at(i)-&gt;diagram();
00331     <span class="keywordflow">return</span> list;
00332 }
00333 
<a name="l00334"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda1">00334</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda1">Legend::addDiagram</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>* newDiagram )
00335 {
00336     <span class="keywordflow">if</span> ( newDiagram )
00337     {
00338         <a class="code" href="class_k_d_chart_1_1_diagram_observer.html">DiagramObserver</a>* observer = <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_diagram_observer.html">DiagramObserver</a>( newDiagram, <span class="keyword">this</span> );
00339 
00340         DiagramObserver* oldObs = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;findObserverForDiagram( newDiagram );
00341         <span class="keywordflow">if</span>( oldObs ){
00342             <span class="keyword">delete</span> oldObs;
00343             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers[ <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.indexOf( oldObs ) ] = observer;
00344         }<span class="keywordflow">else</span>{
00345             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.append( observer );
00346         }
00347         connect( observer, SIGNAL( diagramDestroyed(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>*) ),
00348                         SLOT( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda41">resetDiagram</a>(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>*) ));
00349         connect( observer, SIGNAL( diagramDataChanged(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>*) ),
00350                  SLOT( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>() ));
00351         connect( observer, SIGNAL( diagramDataHidden(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>*) ),
00352                  SLOT( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>() ));
00353         connect( observer, SIGNAL( diagramAttributesChanged(<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>*) ),
00354                         SLOT( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>() ));
00355         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00356     }
00357 }
00358 
<a name="l00359"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda38">00359</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda38">Legend::removeDiagram</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>* oldDiagram )
00360 {
00361     <span class="keywordflow">if</span>( oldDiagram ){
00362         <a class="code" href="class_k_d_chart_1_1_diagram_observer.html">DiagramObserver</a>* oldObs = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;findObserverForDiagram( oldDiagram );
00363         <span class="keywordflow">if</span>( oldObs ){
00364             <span class="comment">//qDebug() &lt;&lt; "before delete oldObs;";</span>
00365             <span class="keyword">delete</span> oldObs;
00366             <span class="comment">//qDebug() &lt;&lt; "after delete oldObs;";</span>
00367             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.removeAt( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.indexOf( oldObs ) );
00368             <span class="comment">//qDebug() &lt;&lt; "after d-&gt;observers.removeAt()";</span>
00369         }
00370         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00371     }
00372 }
00373 
<a name="l00374"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda39">00374</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda39">Legend::removeDiagrams</a>()
00375 {
00376     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.size(); ++i)
00377         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda38">removeDiagram</a>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.at(i)-&gt;diagram() );
00378 }
00379 
<a name="l00380"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda40">00380</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda40">Legend::replaceDiagram</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>* newDiagram,
00381                              <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>* oldDiagram )
00382 {
00383     <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">KDChart::AbstractDiagram</a>* old = oldDiagram;
00384     <span class="keywordflow">if</span>( ! <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.isEmpty() &amp;&amp; ! old ){
00385         old = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.first()-&gt;diagram();
00386         <span class="keywordflow">if</span>( ! old )
00387             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.removeFirst(); <span class="comment">// first entry had a 0 diagram</span>
00388     }
00389     <span class="keywordflow">if</span>( old )
00390         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda38">removeDiagram</a>( old );
00391     <span class="keywordflow">if</span>( newDiagram )
00392         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda1">addDiagram</a>( newDiagram );
00393 }
00394 
<a name="l00395"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda51">00395</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda51">Legend::setDiagram</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">KDChart::AbstractDiagram</a>* newDiagram )
00396 {
00397     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda40">replaceDiagram</a>( newDiagram );
00398 }
00399 
<a name="l00400"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda41">00400</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda41">Legend::resetDiagram</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>* oldDiagram )
00401 {
00402     <span class="comment">//qDebug() &lt;&lt; oldDiagram;</span>
00403     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda38">removeDiagram</a>( oldDiagram );
00404 }
00405 
<a name="l00406"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda70">00406</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda70">Legend::setVisible</a>( <span class="keywordtype">bool</span> visible )
00407 {
00408     QWidget::setVisible( visible );
00409     emitPositionChanged();
00410 }
00411 
<a name="l00412"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">00412</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">Legend::setNeedRebuild</a>()
00413 {
00414     <span class="comment">//qDebug() &lt;&lt; "setNeedRebuild()";</span>
00415     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda7">buildLegend</a>();
00416     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda72">sizeHint</a>();
00417 }
00418 
<a name="l00419"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda59">00419</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda59">Legend::setPosition</a>( <a class="code" href="class_k_d_chart_1_1_position.html">Position</a> position )
00420 {
00421     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;position = position;
00422     emitPositionChanged();
00423 }
00424 
00425 <span class="keywordtype">void</span> Legend::emitPositionChanged()
00426 {
00427     emit positionChanged( <span class="keyword">this</span> );
00428     emit <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda36">propertiesChanged</a>();
00429 }
00430 
00431 
<a name="l00432"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda35">00432</a> <a class="code" href="class_k_d_chart_1_1_position.html">Position</a> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda35">Legend::position</a>()<span class="keyword"> const</span>
00433 <span class="keyword"></span>{
00434     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;position;
00435 }
00436 
<a name="l00437"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda45">00437</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda45">Legend::setAlignment</a>( Qt::Alignment alignment )
00438 {
00439     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;alignment = alignment;
00440     emitPositionChanged();
00441 }
00442 
<a name="l00443"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda2">00443</a> Qt::Alignment <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda2">Legend::alignment</a>()<span class="keyword"> const</span>
00444 <span class="keyword"></span>{
00445     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;alignment;
00446 }
00447 
<a name="l00448"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda52">00448</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda52">Legend::setFloatingPosition</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_relative_position.html">RelativePosition</a>&amp; relativePosition )
00449 {
00450     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;position = Position::Floating;
00451     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;relativePosition != relativePosition ){
00452         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;relativePosition  = relativePosition;
00453         emitPositionChanged();
00454     }
00455 }
00456 
<a name="l00457"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda15">00457</a> <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_relative_position.html">RelativePosition</a> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda15">Legend::floatingPosition</a>()<span class="keyword"> const</span>
00458 <span class="keyword"></span>{
00459     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;relativePosition;
00460 }
00461 
<a name="l00462"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda57">00462</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda57">Legend::setOrientation</a>( Qt::Orientation orientation )
00463 {
00464     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;orientation == orientation ) <span class="keywordflow">return</span>;
00465     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;orientation = orientation;
00466     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00467     emitPositionChanged();
00468 }
00469 
<a name="l00470"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">00470</a> Qt::Orientation <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">Legend::orientation</a>()<span class="keyword"> const</span>
00471 <span class="keyword"></span>{
00472     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;orientation;
00473 }
00474 
<a name="l00475"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda62">00475</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda62">Legend::setShowLines</a>( <span class="keywordtype">bool</span> legendShowLines )
00476 {
00477     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;showLines == legendShowLines ) <span class="keywordflow">return</span>;
00478     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;showLines = legendShowLines;
00479     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00480     emitPositionChanged();
00481 }
00482 
<a name="l00483"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda71">00483</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda71">Legend::showLines</a>()<span class="keyword"> const</span>
00484 <span class="keyword"></span>{
00485     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;showLines;
00486 }
00487 
<a name="l00488"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda69">00488</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda69">Legend::setUseAutomaticMarkerSize</a>( <span class="keywordtype">bool</span> useAutomaticMarkerSize )
00489 {
00490     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;useAutomaticMarkerSize = useAutomaticMarkerSize;
00491     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00492     emitPositionChanged();
00493 }
00494 
<a name="l00495"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda79">00495</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda79">Legend::useAutomaticMarkerSize</a>()<span class="keyword"> const</span>
00496 <span class="keyword"></span>{
00497     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;useAutomaticMarkerSize;
00498 }
00499 
<a name="l00505"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda42">00505</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda42">Legend::resetTexts</a>()
00506 {
00507     <span class="keywordflow">if</span>( ! <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;texts.count() ) <span class="keywordflow">return</span>;
00508     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;texts.clear();
00509     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00510 }
00511 
<a name="l00512"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda65">00512</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda65">Legend::setText</a>( uint dataset, <span class="keyword">const</span> QString&amp; text )
00513 {
00514     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;texts[ dataset ] == text ) <span class="keywordflow">return</span>;
00515     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;texts[ dataset ] = text;
00516     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00517 }
00518 
<a name="l00519"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda74">00519</a> QString <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda74">Legend::text</a>( uint dataset )<span class="keyword"> const</span>
00520 <span class="keyword"></span>{
00521     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;texts.find( dataset ) != <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;texts.end() ){
00522         <span class="comment">//qDebug() &lt;&lt; "Legend::text(" &lt;&lt; dataset &lt;&lt; ") returning d-&gt;texts[" &lt;&lt; dataset &lt;&lt; "] :" &lt;&lt; d-&gt;texts[ dataset ];</span>
00523         <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;texts[ dataset ];
00524     }<span class="keywordflow">else</span>{
00525         <span class="comment">//qDebug() &lt;&lt; "Legend::text(" &lt;&lt; dataset &lt;&lt; ") returning d-&gt;modelLabels[" &lt;&lt; dataset &lt;&lt; "] :" &lt;&lt; d-&gt;modelLabels[ dataset ];</span>
00526         <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels[ dataset ];
00527     }
00528 }
00529 
<a name="l00530"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda76">00530</a> <span class="keyword">const</span> QMap&lt;uint,QString&gt; <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda76">Legend::texts</a>()<span class="keyword"> const</span>
00531 <span class="keyword"></span>{
00532     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;texts;
00533 }
00534 
<a name="l00535"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">00535</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">Legend::setColor</a>( uint dataset, <span class="keyword">const</span> QColor&amp; color )
00536 {
00537     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;brushes[ dataset ] == color ) <span class="keywordflow">return</span>;
00538     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;brushes[ dataset ] = color;
00539     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00540 }
00541 
<a name="l00542"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda47">00542</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda47">Legend::setBrush</a>( uint dataset, <span class="keyword">const</span> QBrush&amp; brush )
00543 {
00544     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;brushes[ dataset ] == brush ) <span class="keywordflow">return</span>;
00545     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;brushes[ dataset ] = brush;
00546     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00547 }
00548 
<a name="l00549"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda5">00549</a> QBrush <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda5">Legend::brush</a>( uint dataset )<span class="keyword"> const</span>
00550 <span class="keyword"></span>{
00551     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;brushes.find( dataset ) != <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;brushes.end() )
00552         <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;brushes[ dataset ];
00553     <span class="keywordflow">else</span>
00554         <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelBrushes[ dataset ];
00555 }
00556 
<a name="l00557"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda6">00557</a> <span class="keyword">const</span> QMap&lt;uint,QBrush&gt; <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda6">Legend::brushes</a>()<span class="keyword"> const</span>
00558 <span class="keyword"></span>{
00559     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;brushes;
00560 }
00561 
00562 
<a name="l00563"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda48">00563</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda48">Legend::setBrushesFromDiagram</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">KDChart::AbstractDiagram</a>* diagram )
00564 {
00565     <span class="keywordtype">bool</span> bChangesDone = <span class="keyword">false</span>;
00566     QList&lt;QBrush&gt; datasetBrushes = diagram-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama12">datasetBrushes</a>();
00567     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; datasetBrushes.count(); i++ ){
00568         <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;brushes[ i ] != datasetBrushes[ i ] ){
00569             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;brushes[ i ]  = datasetBrushes[ i ];
00570             bChangesDone = <span class="keyword">true</span>;
00571         }
00572     }
00573     <span class="keywordflow">if</span>( bChangesDone )
00574         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00575 }
00576 
00577 
<a name="l00578"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda58">00578</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda58">Legend::setPen</a>( uint dataset, <span class="keyword">const</span> QPen&amp; pen )
00579 {
00580     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;pens[dataset] == pen ) <span class="keywordflow">return</span>;
00581     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;pens[dataset] = pen;
00582     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00583 }
00584 
<a name="l00585"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda33">00585</a> QPen <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda33">Legend::pen</a>( uint dataset )<span class="keyword"> const</span>
00586 <span class="keyword"></span>{
00587     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;pens.find( dataset ) != <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;pens.end() )
00588         <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;pens[dataset];
00589     <span class="keywordflow">else</span>
00590         <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelPens[ dataset ];
00591 }
00592 
<a name="l00593"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda34">00593</a> <span class="keyword">const</span> QMap&lt;uint,QPen&gt; <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda34">Legend::pens</a>()<span class="keyword"> const</span>
00594 <span class="keyword"></span>{
00595     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;pens;
00596 }
00597 
00598 
<a name="l00599"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda55">00599</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda55">Legend::setMarkerAttributes</a>( uint dataset, <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_marker_attributes.html">MarkerAttributes</a>&amp; markerAttributes )
00600 {
00601     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;markerAttributes[dataset] == markerAttributes ) <span class="keywordflow">return</span>;
00602     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;markerAttributes[ dataset ] = markerAttributes;
00603     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00604 }
00605 
<a name="l00606"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda23">00606</a> <a class="code" href="class_k_d_chart_1_1_marker_attributes.html">MarkerAttributes</a> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda22">Legend::markerAttributes</a>( uint dataset )<span class="keyword"> const</span>
00607 <span class="keyword"></span>{
00608     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;markerAttributes.find( dataset ) != <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;markerAttributes.end() )
00609         <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;markerAttributes[ dataset ];
00610     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( static_cast&lt;uint&gt;( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelMarkers.count() ) &gt; dataset )
00611         <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelMarkers[ dataset ];
00612     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_marker_attributes.html">MarkerAttributes</a>();
00613 }
00614 
<a name="l00615"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda22">00615</a> <span class="keyword">const</span> QMap&lt;uint, MarkerAttributes&gt; <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda22">Legend::markerAttributes</a>()<span class="keyword"> const</span>
00616 <span class="keyword"></span>{
00617     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;markerAttributes;
00618 }
00619 
00620 
<a name="l00621"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda66">00621</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda66">Legend::setTextAttributes</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> &amp;a )
00622 {
00623     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;textAttributes == a ) <span class="keywordflow">return</span>;
00624     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;textAttributes = a;
00625     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00626 }
00627 
<a name="l00628"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda75">00628</a> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda75">Legend::textAttributes</a>()<span class="keyword"> const</span>
00629 <span class="keyword"></span>{
00630     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;textAttributes;
00631 }
00632 
<a name="l00633"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda67">00633</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda67">Legend::setTitleText</a>( <span class="keyword">const</span> QString&amp; text )
00634 {
00635     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleText == text ) <span class="keywordflow">return</span>;
00636     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleText = text;
00637     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00638 }
00639 
<a name="l00640"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda77">00640</a> QString <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda77">Legend::titleText</a>()<span class="keyword"> const</span>
00641 <span class="keyword"></span>{
00642     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleText;
00643 }
00644 
<a name="l00645"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda68">00645</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda68">Legend::setTitleTextAttributes</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> &amp;a )
00646 {
00647     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleTextAttributes == a ) <span class="keywordflow">return</span>;
00648     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleTextAttributes = a;
00649     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00650 }
00651 
<a name="l00652"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda78">00652</a> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda78">Legend::titleTextAttributes</a>()<span class="keyword"> const</span>
00653 <span class="keyword"></span>{
00654     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;titleTextAttributes;
00655 }
00656 
<a name="l00657"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda16">00657</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda16">Legend::forceRebuild</a>()
00658 {
00659 <span class="preprocessor">#ifdef DEBUG_LEGEND_PAINT</span>
00660 <span class="preprocessor"></span>    qDebug() &lt;&lt; <span class="stringliteral">"entering Legend::forceRebuild()"</span>;
00661 <span class="preprocessor">#endif</span>
00662 <span class="preprocessor"></span>    <span class="comment">//setSpacing(d-&gt;layout-&gt;spacing());</span>
00663     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda7">buildLegend</a>();
00664 <span class="preprocessor">#ifdef DEBUG_LEGEND_PAINT</span>
00665 <span class="preprocessor"></span>    qDebug() &lt;&lt; <span class="stringliteral">"leaving Legend::forceRebuild()"</span>;
00666 <span class="preprocessor">#endif</span>
00667 <span class="preprocessor"></span>}
00668 
<a name="l00669"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda63">00669</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda63">Legend::setSpacing</a>( uint space )
00670 {
00671     <span class="keywordflow">if</span>( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;spacing == space &amp;&amp; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;spacing() == static_cast&lt;int&gt;(space) ) <span class="keywordflow">return</span>;
00672     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;spacing = space;
00673     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;setSpacing( space );
00674     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda56">setNeedRebuild</a>();
00675 }
00676 
<a name="l00677"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda73">00677</a> uint <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda73">Legend::spacing</a>()<span class="keyword"> const</span>
00678 <span class="keyword"></span>{
00679     <span class="keywordflow">return</span> <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;spacing;
00680 }
00681 
<a name="l00682"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda50">00682</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda50">Legend::setDefaultColors</a>()
00683 {
00684     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  0, Qt::red );
00685     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  1, Qt::green );
00686     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  2, Qt::blue );
00687     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  3, Qt::cyan );
00688     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  4, Qt::magenta );
00689     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  5, Qt::yellow );
00690     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  6, Qt::darkRed );
00691     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  7, Qt::darkGreen );
00692     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  8, Qt::darkBlue );
00693     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  9, Qt::darkCyan );
00694     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 10, Qt::darkMagenta );
00695     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 11, Qt::darkYellow );
00696 }
00697 
<a name="l00698"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda60">00698</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda60">Legend::setRainbowColors</a>()
00699 {
00700     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  0, QColor(255,  0,196) );
00701     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  1, QColor(255,  0, 96) );
00702     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  2, QColor(255, 128,64) );
00703     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  3, Qt::yellow );
00704     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  4, Qt::green );
00705     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  5, Qt::cyan );
00706     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  6, QColor( 96, 96,255) );
00707     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(  7, QColor(160,  0,255) );
00708     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 8; i &lt; 16; ++i )
00709         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( i, <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda5">brush</a>( i - 8 ).color().light() );
00710 }
00711 
<a name="l00712"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda64">00712</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda64">Legend::setSubduedColors</a>( <span class="keywordtype">bool</span> ordered )
00713 {
00714 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> NUM_SUBDUEDCOLORS = 18;
00715 <span class="keyword">static</span> <span class="keyword">const</span> QColor SUBDUEDCOLORS[ NUM_SUBDUEDCOLORS ] = {
00716     QColor( 0xe0,0x7f,0x70 ),
00717     QColor( 0xe2,0xa5,0x6f ),
00718     QColor( 0xe0,0xc9,0x70 ),
00719     QColor( 0xd1,0xe0,0x70 ),
00720     QColor( 0xac,0xe0,0x70 ),
00721     QColor( 0x86,0xe0,0x70 ),
00722     QColor( 0x70,0xe0,0x7f ),
00723     QColor( 0x70,0xe0,0xa4 ),
00724     QColor( 0x70,0xe0,0xc9 ),
00725     QColor( 0x70,0xd1,0xe0 ),
00726     QColor( 0x70,0xac,0xe0 ),
00727     QColor( 0x70,0x86,0xe0 ),
00728     QColor( 0x7f,0x70,0xe0 ),
00729     QColor( 0xa4,0x70,0xe0 ),
00730     QColor( 0xc9,0x70,0xe0 ),
00731     QColor( 0xe0,0x70,0xd1 ),
00732     QColor( 0xe0,0x70,0xac ),
00733     QColor( 0xe0,0x70,0x86 ),
00734 };
00735     <span class="keywordflow">if</span>( ordered )
00736         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;NUM_SUBDUEDCOLORS; ++i)
00737             <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( i, SUBDUEDCOLORS[i] );
00738     <span class="keywordflow">else</span>{
00739         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 0, SUBDUEDCOLORS[ 0] );
00740         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 1, SUBDUEDCOLORS[ 5] );
00741         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 2, SUBDUEDCOLORS[10] );
00742         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 3, SUBDUEDCOLORS[15] );
00743         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 4, SUBDUEDCOLORS[ 2] );
00744         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 5, SUBDUEDCOLORS[ 7] );
00745         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 6, SUBDUEDCOLORS[12] );
00746         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 7, SUBDUEDCOLORS[17] );
00747         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 8, SUBDUEDCOLORS[ 4] );
00748         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>( 9, SUBDUEDCOLORS[ 9] );
00749         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(10, SUBDUEDCOLORS[14] );
00750         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(11, SUBDUEDCOLORS[ 1] );
00751         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(12, SUBDUEDCOLORS[ 6] );
00752         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(13, SUBDUEDCOLORS[11] );
00753         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(14, SUBDUEDCOLORS[16] );
00754         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(15, SUBDUEDCOLORS[ 3] );
00755         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(16, SUBDUEDCOLORS[ 8] );
00756         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda49">setColor</a>(17, SUBDUEDCOLORS[13] );
00757     }
00758 }
00759 
<a name="l00760"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda43">00760</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda43">Legend::resizeEvent</a> ( QResizeEvent * event )
00761 {
00762 <span class="preprocessor">#ifdef DEBUG_LEGEND_PAINT</span>
00763 <span class="preprocessor"></span>    qDebug() &lt;&lt; <span class="stringliteral">"Legend::resizeEvent() called"</span>;
00764 <span class="preprocessor">#endif</span>
00765 <span class="preprocessor"></span>    <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda16">forceRebuild</a>();
00766     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda72">sizeHint</a>();
00767     QTimer::singleShot(0, <span class="keyword">this</span>, SLOT(emitPositionChanged()));
00768 }
00769 
<a name="l00770"></a><a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda7">00770</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda7">Legend::buildLegend</a>()
00771 {
00772     <span class="comment">/*</span>
00773 <span class="comment">    if( !d-&gt;needRebuild ) {</span>
00774 <span class="comment">#ifdef DEBUG_LEGEND_PAINT</span>
00775 <span class="comment">        qDebug() &lt;&lt; "leaving Legend::buildLegend() with NO action (was already build)";</span>
00776 <span class="comment">#endif</span>
00777 <span class="comment">        // Note: We do *not* need to send positionChanged here,</span>
00778 <span class="comment">        //       because we send it in the resizeEvent, so layouting</span>
00779 <span class="comment">        //       is done at the right time.</span>
00780 <span class="comment">        return;</span>
00781 <span class="comment">    }</span>
00782 <span class="comment">#ifdef DEBUG_LEGEND_PAINT</span>
00783 <span class="comment">    qDebug() &lt;&lt; "entering Legend::buildLegend() **********************************";</span>
00784 <span class="comment">#endif</span>
00785 <span class="comment">    d-&gt;needRebuild = false;</span>
00786 <span class="comment">    */</span>
00787 
00788     Q_FOREACH( <a class="code" href="class_q_layout_item.html">QLayoutItem</a>* layoutItem, <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems ) {
00789         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;removeItem( layoutItem );
00790     }
00791     qDeleteAll( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems );
00792     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems.clear();
00793 
00794     <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() == Qt::Vertical ) {
00795         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;setColumnStretch( 4, 1 );
00796     } <span class="keywordflow">else</span> {
00797         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;setColumnStretch( 4, 0 );
00798     }
00799 
00800     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.clear();
00801     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelBrushes.clear();
00802     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelPens.clear();
00803     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelMarkers.clear();
00804     <span class="comment">// retrieve the diagrams' settings for all non-hidden datasets</span>
00805     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.size(); ++i){
00806         <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>* diagram = <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;observers.at(i)-&gt;diagram();
00807         <span class="keywordflow">if</span>( diagram ){
00808             <span class="comment">//qDebug() &lt;&lt; "accessing" &lt;&lt; diagram;</span>
00809             <span class="keyword">const</span> QStringList             diagramLabels(  diagram-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama14">datasetLabels</a>()  );
00810             <span class="keyword">const</span> QList&lt;QBrush&gt;           diagramBrushes( diagram-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama12">datasetBrushes</a>() );
00811             <span class="keyword">const</span> QList&lt;QPen&gt;             diagramPens(    diagram-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama16">datasetPens</a>()    );
00812             <span class="keyword">const</span> QList&lt;MarkerAttributes&gt; diagramMarkers( diagram-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama15">datasetMarkers</a>() );
00813             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> dataset = 0; dataset &lt; diagramLabels.count(); dataset++ ) {
00814                 <span class="comment">// only show the label if the diagrams is NOT having the dataset set to hidden</span>
00815                 <span class="keywordflow">if</span>( ! diagram-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama26">isHidden</a>( dataset ) ){
00816                     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels  += diagramLabels[   dataset ];
00817                     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelBrushes += diagramBrushes[  dataset ];
00818                     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelPens    += diagramPens[     dataset ];
00819                     <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelMarkers += diagramMarkers[  dataset ];
00820                 }
00821             }
00822         }
00823     }
00824 
00825     Q_ASSERT( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count() == <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelBrushes.count() );
00826 
00827     <span class="comment">// legend caption</span>
00828     <span class="keywordflow">if</span>( !<a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda77">titleText</a>().isEmpty() &amp;&amp; <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda78">titleTextAttributes</a>().<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa7">isVisible</a>() ) {
00829         <span class="comment">// PENDING(kalle) Other properties!</span>
00830         <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">KDChart::TextLayoutItem</a>* titleItem =
00831             <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">KDChart::TextLayoutItem</a>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda77">titleText</a>(),
00832                 <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda78">titleTextAttributes</a>(),
00833                 <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda37">referenceArea</a>(),
00834                 (<a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() == Qt::Vertical)
00835                 ? KDChartEnums::MeasureOrientationMinimum
00836                 : KDChartEnums::MeasureOrientationHorizontal,
00837                 Qt::AlignCenter );
00838         titleItem-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema12">setParentWidget</a>( <span class="keyword">this</span> );
00839 
00840         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems &lt;&lt; titleItem;
00841         <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() == Qt::Vertical )
00842             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( titleItem, 0, 0, 1, 5, Qt::AlignCenter );
00843         <span class="keywordflow">else</span>
00844             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( titleItem, 0, 0, 1, <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count() ? (<a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count()*4) : 1, Qt::AlignCenter );
00845 
00846         <span class="comment">// The line between the title and the legend items, if any.</span>
00847         <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda71">showLines</a>() &amp;&amp; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count() ) {
00848             <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html">KDChart::HorizontalLineLayoutItem</a>* lineItem = <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html">KDChart::HorizontalLineLayoutItem</a>();
00849             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems &lt;&lt; lineItem;
00850             <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() == Qt::Vertical )
00851                 <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( lineItem, 1, 0, 1, 5, Qt::AlignCenter );
00852             <span class="keywordflow">else</span>
00853                 <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( lineItem, 1, 0, 1, <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count()*4, Qt::AlignCenter );
00854         }
00855     }
00856 
00857     <span class="keyword">const</span> KDChartEnums::MeasureOrientation orient =
00858             (<a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() == Qt::Vertical)
00859             ? KDChartEnums::MeasureOrientationMinimum
00860             : KDChartEnums::MeasureOrientationHorizontal;
00861     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> labelAttrs( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda75">textAttributes</a>() );
00862     <span class="keyword">const</span> qreal fontHeight = labelAttrs.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa3">calculatedFontSize</a>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda37">referenceArea</a>(), orient );
00863     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legendw0">LegendStyle</a> style = <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda21">legendStyle</a>();
00864     <span class="comment">//qDebug() &lt;&lt; "fontHeight:" &lt;&lt; fontHeight;</span>
00865 
00866     <span class="keyword">const</span> <span class="keywordtype">bool</span> bShowMarkers = (style != <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legendw0_k_d_chart_1_1_legendw1">LinesOnly</a>);
00867 
00868     QSizeF maxMarkersSize(1.0, 1.0);
00869     QVector &lt;MarkerAttributes&gt; markerAttrs( <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count() );
00870     <span class="keywordflow">if</span>( bShowMarkers ){
00871         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> dataset = 0; dataset &lt; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count(); ++dataset ) {
00872             markerAttrs[dataset] = <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda22">markerAttributes</a>( dataset );
00873             QSizeF siz;
00874             <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda79">useAutomaticMarkerSize</a>() ||
00875                 ! markerAttrs[dataset].markerSize().isValid() )
00876             {
00877                 siz = QSizeF(fontHeight, fontHeight);
00878                 markerAttrs[dataset].setMarkerSize( siz );
00879             }<span class="keywordflow">else</span>{
00880                 siz = markerAttrs[dataset].markerSize();
00881             }
00882             maxMarkersSize =
00883                     QSizeF(qMax(maxMarkersSize.width(),  siz.width()),
00884                            qMax(maxMarkersSize.height(), siz.height()));
00885         }
00886     }
00887 
00888     <span class="comment">// If we show a marker on a line, we paint it after 4 pixels</span>
00889     <span class="comment">// of the line have been painted. This allows to see the line style</span>
00890     <span class="comment">// at the right side of the marker without the line needing to</span>
00891     <span class="comment">// be too long.</span>
00892     <span class="comment">// (having the marker in the middle of the line would require longer lines)</span>
00893     <span class="keyword">const</span> <span class="keywordtype">int</span> markerOffsOnLine = 8;
00894 
00895     <span class="keywordtype">int</span> maxLineLength = 18;
00896     {
00897         <span class="keywordtype">bool</span> hasComplexPenStyle = <span class="keyword">false</span>;
00898         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> dataset = 0; dataset &lt; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count(); ++dataset ){
00899             <span class="keyword">const</span> QPen pn = <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda33">pen</a>(dataset);
00900             <span class="keyword">const</span> Qt::PenStyle ps = pn.style();
00901             <span class="keywordflow">if</span>( ps != Qt::NoPen ){
00902                 maxLineLength = qMax( pn.width() * 18, maxLineLength );
00903                 <span class="keywordflow">if</span>( ps != Qt::SolidLine )
00904                     hasComplexPenStyle = <span class="keyword">true</span>;
00905             }
00906         }
00907         <span class="keywordflow">if</span>( hasComplexPenStyle &amp;&amp; bShowMarkers )
00908             maxLineLength =
00909                     maxLineLength + markerOffsOnLine +
00910                     static_cast&lt;int&gt;(maxMarkersSize.width());
00911     }
00912 
00913     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> dataset = 0; dataset &lt; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count(); ++dataset ) {
00914         <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">KDChart::AbstractLayoutItem</a>* markerLineItem = 0;
00915         <span class="keywordflow">switch</span>( style ){
00916             <span class="keywordflow">case</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legendw0_k_d_chart_1_1_legendw3">MarkersOnly</a> ):
00917                 markerLineItem = <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html">KDChart::MarkerLayoutItem</a>(
00918                         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda13">diagram</a>(),
00919                         markerAttrs[dataset],
00920                         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda5">brush</a>( dataset ),
00921                         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda33">pen</a>( dataset ),
00922                         Qt::AlignLeft );
00923                 <span class="keywordflow">break</span>;
00924             <span class="keywordflow">case</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legendw0_k_d_chart_1_1_legendw1">LinesOnly</a> ):
00925                 markerLineItem = <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html">KDChart::LineLayoutItem</a>(
00926                         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda13">diagram</a>(),
00927                         maxLineLength,
00928                         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda33">pen</a>( dataset ),
00929                         Qt::AlignCenter );
00930                 <span class="keywordflow">break</span>;
00931             <span class="keywordflow">case</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legendw0_k_d_chart_1_1_legendw2">MarkersAndLines</a> ):
00932                 markerLineItem = <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html">KDChart::LineWithMarkerLayoutItem</a>(
00933                         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda13">diagram</a>(),
00934                         maxLineLength,
00935                         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda33">pen</a>( dataset ),
00936                         markerOffsOnLine,
00937                         markerAttrs[dataset],
00938                         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda5">brush</a>( dataset ),
00939                         <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda33">pen</a>( dataset ),
00940                         Qt::AlignCenter );
00941                 <span class="keywordflow">break</span>;
00942             <span class="keywordflow">default</span>:
00943                 Q_ASSERT( <span class="keyword">false</span> ); <span class="comment">// all styles need to be handled</span>
00944         }
00945         <span class="keywordflow">if</span>( markerLineItem ){
00946             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems &lt;&lt; markerLineItem;
00947             <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() == Qt::Vertical )
00948                 <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( markerLineItem,
00949                                     dataset*2+2, <span class="comment">// first row is title, second is line</span>
00950                                     1,
00951                                     1, 1, Qt::AlignCenter );
00952             <span class="keywordflow">else</span>
00953                 <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( markerLineItem,
00954                                     2, <span class="comment">// all in row two</span>
00955                                     dataset*4 );
00956         }
00957 
00958         <span class="comment">// PENDING(kalle) Other properties!</span>
00959         <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">KDChart::TextLayoutItem</a>* labelItem =
00960             <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">KDChart::TextLayoutItem</a>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda74">text</a>( dataset ),
00961                 labelAttrs,
00962                 <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda37">referenceArea</a>(), orient,
00963                 Qt::AlignLeft );
00964         labelItem-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema12">setParentWidget</a>( <span class="keyword">this</span> );
00965 
00966         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems &lt;&lt; labelItem;
00967         <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() == Qt::Vertical )
00968             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( labelItem,
00969                                 dataset*2+2, <span class="comment">// first row is title, second is line</span>
00970                                 3 );
00971         <span class="keywordflow">else</span>
00972             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( labelItem,
00973                                 2, <span class="comment">// all in row two</span>
00974                                 dataset*4+1 );
00975 
00976         <span class="comment">// horizontal lines (only in vertical mode, and not after the last item)</span>
00977         <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() == Qt::Vertical &amp;&amp; <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda71">showLines</a>() &amp;&amp; dataset != <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count()-1 ) {
00978             <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html">KDChart::HorizontalLineLayoutItem</a>* lineItem = <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html">KDChart::HorizontalLineLayoutItem</a>();
00979             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems &lt;&lt; lineItem;
00980             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( lineItem,
00981                                 dataset*2+1+2,
00982                                 0,
00983                                 1, 5, Qt::AlignCenter );
00984         }
00985 
00986         <span class="comment">// vertical lines (only in horizontal mode, and not after the last item)</span>
00987         <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() == Qt::Horizontal &amp;&amp; <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda71">showLines</a>() &amp;&amp; dataset != <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count()-1 ) {
00988             <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html">KDChart::VerticalLineLayoutItem</a>* lineItem = <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html">KDChart::VerticalLineLayoutItem</a>();
00989             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems &lt;&lt; lineItem;
00990             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( lineItem,
00991                                 2, <span class="comment">// all in row two</span>
00992                                 style == <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legendw0_k_d_chart_1_1_legendw2">MarkersAndLines</a> ? dataset*4+3 : dataset*4+2 ,
00993                                 1, 1, Qt::AlignCenter );
00994         }
00995 
00996         <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() != Qt::Vertical ) { <span class="comment">// Horizontal needs a spacer</span>
00997             <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( <span class="keyword">new</span> QSpacerItem( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda73">spacing</a>(), 1 ),
00998                                 2, <span class="comment">// all in row two</span>
00999                                 dataset*4+3 );
01000         }
01001     }
01002 
01003     <span class="comment">// vertical line (only in vertical mode)</span>
01004     <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda26">orientation</a>() == Qt::Vertical &amp;&amp; <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda71">showLines</a>() &amp;&amp; <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count() ) {
01005         <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html">KDChart::VerticalLineLayoutItem</a>* lineItem = <span class="keyword">new</span> <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html">KDChart::VerticalLineLayoutItem</a>();
01006         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layoutItems &lt;&lt; lineItem;
01007         <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;layout-&gt;addItem( lineItem, 2, 2, <a class="code" href="_k_d_chart_abstract_area_8cpp.html#a0">d</a>-&gt;modelLabels.count()*2, 1 );
01008     }
01009 
01010     <span class="comment">// This line is absolutely necessary, otherwise: #2516.</span>
01011     <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda0">activateTheLayout</a>();
01012 
01013     emit <a class="code" href="class_k_d_chart_1_1_legend.html#_k_d_chart_1_1_legenda36">propertiesChanged</a>();
01014     <span class="comment">//emit positionChanged( this );</span>
01015     <span class="comment">//emitPositionChanged();</span>
01016 <span class="preprocessor">#ifdef DEBUG_LEGEND_PAINT</span>
01017 <span class="preprocessor"></span>    qDebug() &lt;&lt; <span class="stringliteral">"leaving Legend::buildLegend()"</span>;
01018 <span class="preprocessor">#endif</span>
01019 <span class="preprocessor"></span>}
01020 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu May 10 11:06:25 2007 for KD Chart 2 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
