<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KD Chart 2: KDChartAbstractProxyModel.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>KDChartAbstractProxyModel.cpp</h1><a href="_k_d_chart_abstract_proxy_model_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_abstract_proxy_model_8h.html">KDChartAbstractProxyModel.h</a>"</span>
00002 
00003 <span class="preprocessor">#include &lt;QDebug&gt;</span>
00004 
00005 <span class="preprocessor">#include &lt;KDABLibFakes&gt;</span>
00006 
00007 
00008 <span class="keyword">namespace </span>KDChart {
00009 
<a name="l00012"></a><a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_abstract_proxy_modela0">00012</a> AbstractProxyModel::AbstractProxyModel(<a class="code" href="class_q_object.html">QObject</a>* parent) 
00013   : <a class="code" href="class_q_abstract_proxy_model.html">QAbstractProxyModel</a>(parent) {}
00014 
00015 <span class="comment">// Think this is ugly? Well, it's not from me, it comes from QProxyModel</span>
00016 <span class="keyword">struct </span>KDPrivateModelIndex
00017 {
00018   <span class="keywordtype">int</span> r, c;
00019   <span class="keywordtype">void</span> *p;
00020   <span class="keyword">const</span> QAbstractItemModel *m;
00021 };
00022 
<a name="l00023"></a><a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_private_attributes_modela10">00023</a> QModelIndex AbstractProxyModel::mapFromSource( <span class="keyword">const</span> QModelIndex &amp; sourceIndex )<span class="keyword"> const</span>
00024 <span class="keyword"></span>{
00025   <span class="keywordflow">if</span> ( !sourceIndex.isValid() )
00026     <span class="keywordflow">return</span> QModelIndex();
00027   <span class="comment">//qDebug() &lt;&lt; "sourceIndex.model()="&lt;&lt;sourceIndex.model();</span>
00028   <span class="comment">//qDebug() &lt;&lt; "model()="&lt;&lt;sourceModel();</span>
00029   Q_ASSERT( sourceIndex.model() == sourceModel() );
00030 
00031   <span class="comment">// Create an index that preserves the internal pointer from the source;</span>
00032   <span class="comment">// this way AbstractProxyModel preserves the structure of the source model</span>
00033   <span class="keywordflow">return</span> createIndex( sourceIndex.row(), sourceIndex.column(), sourceIndex.internalPointer() );
00034 }
00035 
<a name="l00036"></a><a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_private_attributes_modela11">00036</a> QModelIndex AbstractProxyModel::mapToSource( <span class="keyword">const</span> QModelIndex &amp;proxyIndex )<span class="keyword"> const</span>
00037 <span class="keyword"></span>{
00038   <span class="keywordflow">if</span> ( !proxyIndex.isValid() )
00039     <span class="keywordflow">return</span> QModelIndex();
00040   Q_ASSERT( proxyIndex.model() == <span class="keyword">this</span> );
00041   <span class="comment">// So here we need to create a source index which holds that internal pointer.</span>
00042   <span class="comment">// No way to pass it to sourceModel()-&gt;index... so we have to do the ugly way:</span>
00043   QModelIndex sourceIndex;
00044   KDPrivateModelIndex* hack = reinterpret_cast&lt;KDPrivateModelIndex*&gt;(&amp;sourceIndex);
00045   hack-&gt;r = proxyIndex.row();
00046   hack-&gt;c = proxyIndex.column();
00047   hack-&gt;p = proxyIndex.internalPointer();
00048   hack-&gt;m = sourceModel();
00049   Q_ASSERT( sourceIndex.isValid() );
00050   <span class="keywordflow">return</span> sourceIndex;
00051 }
00052 
<a name="l00053"></a><a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_private_attributes_modela7">00053</a> QModelIndex AbstractProxyModel::index( <span class="keywordtype">int</span> row, <span class="keywordtype">int</span> col, <span class="keyword">const</span> QModelIndex&amp; index )<span class="keyword"> const</span>
00054 <span class="keyword"></span>{
00055     Q_ASSERT(sourceModel());
00056     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_private_attributes_modela10">mapFromSource</a>(sourceModel()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_private_attributes_modela7">index</a>( row, col, <a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_private_attributes_modela11">mapToSource</a>(index) ));
00057 }
00058 
<a name="l00059"></a><a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_private_attributes_modela14">00059</a> QModelIndex AbstractProxyModel::parent( <span class="keyword">const</span> QModelIndex&amp; index )<span class="keyword"> const</span>
00060 <span class="keyword"></span>{
00061     Q_ASSERT(sourceModel());
00062     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_private_attributes_modela10">mapFromSource</a>(sourceModel()-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_private_attributes_modela14">parent</a>( <a class="code" href="class_k_d_chart_1_1_abstract_proxy_model.html#_k_d_chart_1_1_private_attributes_modela11">mapToSource</a>(index) ));
00063 }
00064 
00065 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu May 10 11:06:24 2007 for KD Chart 2 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
