<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KD Chart 2: KDChartLayoutItems.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_c4e2aed91326a361eee69bb54811986e.html">src</a></div>
<h1>KDChartLayoutItems.cpp</h1><a href="_k_d_chart_layout_items_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> ** Copyright (C) 2007 Klarï¿½vdalens Datakonsult AB.  All rights reserved.</span>
<a name="l00003"></a>00003 <span class="comment"> **</span>
<a name="l00004"></a>00004 <span class="comment"> ** This file is part of the KD Chart library.</span>
<a name="l00005"></a>00005 <span class="comment"> **</span>
<a name="l00006"></a>00006 <span class="comment"> ** This file may be distributed and/or modified under the terms of the</span>
<a name="l00007"></a>00007 <span class="comment"> ** GNU General Public License version 2 as published by the Free Software</span>
<a name="l00008"></a>00008 <span class="comment"> ** Foundation and appearing in the file LICENSE.GPL included in the</span>
<a name="l00009"></a>00009 <span class="comment"> ** packaging of this file.</span>
<a name="l00010"></a>00010 <span class="comment"> **</span>
<a name="l00011"></a>00011 <span class="comment"> ** Licensees holding valid commercial KD Chart licenses may use this file in</span>
<a name="l00012"></a>00012 <span class="comment"> ** accordance with the KD Chart Commercial License Agreement provided with</span>
<a name="l00013"></a>00013 <span class="comment"> ** the Software.</span>
<a name="l00014"></a>00014 <span class="comment"> **</span>
<a name="l00015"></a>00015 <span class="comment"> ** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
<a name="l00016"></a>00016 <span class="comment"> ** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
<a name="l00017"></a>00017 <span class="comment"> **</span>
<a name="l00018"></a>00018 <span class="comment"> ** See http://www.kdab.net/kdchart for</span>
<a name="l00019"></a>00019 <span class="comment"> **   information about KDChart Commercial License Agreements.</span>
<a name="l00020"></a>00020 <span class="comment"> **</span>
<a name="l00021"></a>00021 <span class="comment"> ** Contact info@kdab.net if any conditions of this</span>
<a name="l00022"></a>00022 <span class="comment"> ** licensing are not clear to you.</span>
<a name="l00023"></a>00023 <span class="comment"> **</span>
<a name="l00024"></a>00024 <span class="comment"> **********************************************************************/</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_layout_items_8h.html">KDChartLayoutItems.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="_k_d_text_document_8h.html">KDTextDocument.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_abstract_area_8h.html">KDChartAbstractArea.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_abstract_diagram_8h.html">KDChartAbstractDiagram.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_background_attributes_8h.html">KDChartBackgroundAttributes.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_frame_attributes_8h.html">KDChartFrameAttributes.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_paint_context_8h.html">KDChartPaintContext.h</a>"</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "KDChartPainterSaver_p.h"</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;QTextCursor&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;QTextBlockFormat&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;QTextDocumentFragment&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;QAbstractTextDocumentLayout&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;QLayout&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;QPainter&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;QDebug&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;QCoreApplication&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;QApplication&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;QStringList&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;QStyle&gt;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;KDABLibFakes&gt;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="_k_d_chart_layout_items_8cpp.html#b4250e743fd9a8d6a9f9b1844733341c">00050</a> <span class="preprocessor">#define PI 3.141592653589793</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">//#define DEBUG_ITEMS_PAINT</span>
<a name="l00055"></a>00055 
<a name="l00064"></a><a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#6d47d16c89c9553e22e1a1f231e97d4e">00064</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#6d47d16c89c9553e22e1a1f231e97d4e">KDChart::AbstractLayoutItem::setParentWidget</a>( <a class="code" href="class_q_widget.html">QWidget</a>* widget )
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066     <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#5792fcaa0a3759277e9725945b5bd30b">mParent</a> = widget;
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#42d8d35d525da882f06a9d49cb8f6c86">00069</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#42d8d35d525da882f06a9d49cb8f6c86">KDChart::AbstractLayoutItem::paintAll</a>( QPainter&amp; painter )
<a name="l00070"></a>00070 {
<a name="l00071"></a>00071     <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#c8dfcce6b3d28282ce65a1c07e743d65">paint</a>( &amp;painter );
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00077"></a><a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#4315afb3ddfbc547fe0d6f6d7acc9218">00077</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#4315afb3ddfbc547fe0d6f6d7acc9218">KDChart::AbstractLayoutItem::paintCtx</a>( <a class="code" href="class_k_d_chart_1_1_paint_context.html">PaintContext</a>* context )
<a name="l00078"></a>00078 {
<a name="l00079"></a>00079     <span class="keywordflow">if</span>( context )
<a name="l00080"></a>00080         <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#c8dfcce6b3d28282ce65a1c07e743d65">paint</a>( context-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#b83e114b1d0ae4bd63506ce9a969f4c1">painter</a>() );
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 
<a name="l00086"></a><a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#0534d441cbcad10d2f2f17bc61de9eb5">00086</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#0534d441cbcad10d2f2f17bc61de9eb5">KDChart::AbstractLayoutItem::sizeHintChanged</a>()<span class="keyword">const</span>
<a name="l00087"></a>00087 <span class="keyword"></span>{
<a name="l00088"></a>00088     <span class="comment">// This is exactly like what QWidget::updateGeometry does.</span>
<a name="l00089"></a>00089 <span class="comment">//  qDebug("KDChart::AbstractLayoutItem::sizeHintChanged() called");</span>
<a name="l00090"></a>00090     <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#5792fcaa0a3759277e9725945b5bd30b">mParent</a> ) {
<a name="l00091"></a>00091         <span class="keywordflow">if</span> ( <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#5792fcaa0a3759277e9725945b5bd30b">mParent</a>-&gt;layout() )
<a name="l00092"></a>00092             <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#5792fcaa0a3759277e9725945b5bd30b">mParent</a>-&gt;layout()-&gt;invalidate();
<a name="l00093"></a>00093         <span class="keywordflow">else</span>
<a name="l00094"></a>00094             QApplication::postEvent( <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#5792fcaa0a3759277e9725945b5bd30b">mParent</a>, <span class="keyword">new</span> QEvent( QEvent::LayoutRequest ) );
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#9c5ff9fba290be21db61a5ab3b1d6cd4">00099</a> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#17204b9b66cc40b92457b4c2ce4cf442">KDChart::TextLayoutItem::TextLayoutItem</a>( <span class="keyword">const</span> QString&amp; text,
<a name="l00100"></a>00100                                          <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">KDChart::TextAttributes</a>&amp; attributes,
<a name="l00101"></a>00101                                          <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* area,
<a name="l00102"></a>00102                                          <a class="code" href="class_k_d_chart_enums.html#2d18d64f9bb75398875a507296dbc7f3">KDChartEnums::MeasureOrientation</a> orientation,
<a name="l00103"></a>00103                                          Qt::Alignment alignment )
<a name="l00104"></a>00104     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( alignment )
<a name="l00105"></a>00105     , mText( text )
<a name="l00106"></a>00106     , mAttributes( attributes )
<a name="l00107"></a>00107     , mAutoReferenceArea( area )
<a name="l00108"></a>00108     , mAutoReferenceOrientation( orientation )
<a name="l00109"></a>00109     , cachedSizeHint() <span class="comment">// default this to invalid to force just-in-time calculation before first use of sizeHint()</span>
<a name="l00110"></a>00110     , cachedFontSize( 0.0 )
<a name="l00111"></a>00111     , cachedFont( mAttributes.font() )
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#17204b9b66cc40b92457b4c2ce4cf442">00115</a> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#17204b9b66cc40b92457b4c2ce4cf442">KDChart::TextLayoutItem::TextLayoutItem</a>()
<a name="l00116"></a>00116     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( Qt::AlignLeft )
<a name="l00117"></a>00117     , mText()
<a name="l00118"></a>00118     , mAttributes()
<a name="l00119"></a>00119     , mAutoReferenceArea( 0 )
<a name="l00120"></a>00120     , mAutoReferenceOrientation( <a class="code" href="class_k_d_chart_enums.html">KDChartEnums</a>::MeasureOrientationHorizontal )
<a name="l00121"></a>00121     , cachedSizeHint() <span class="comment">// default this to invalid to force just-in-time calculation before first use of sizeHint()</span>
<a name="l00122"></a>00122     , cachedFontSize( 0.0 )
<a name="l00123"></a>00123     , cachedFont( mAttributes.font() )
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#38bc22db03607636e65606e85091c7b0">00128</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#38bc22db03607636e65606e85091c7b0">KDChart::TextLayoutItem::setAutoReferenceArea</a>( <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* area )
<a name="l00129"></a>00129 {
<a name="l00130"></a>00130     mAutoReferenceArea = area;
<a name="l00131"></a>00131     cachedSizeHint = QSize();
<a name="l00132"></a>00132     <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#b3e0267e82d7a2832041db2d1fa11326">sizeHint</a>();
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 
<a name="l00135"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#d5e3487c49772807a79837324113b149">00135</a> <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#d5e3487c49772807a79837324113b149">KDChart::TextLayoutItem::autoReferenceArea</a>()<span class="keyword"> const</span>
<a name="l00136"></a>00136 <span class="keyword"></span>{
<a name="l00137"></a>00137     <span class="keywordflow">return</span> mAutoReferenceArea;
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#d24ad95f150665f91a20e3eee1a7bb9c">00140</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#d24ad95f150665f91a20e3eee1a7bb9c">KDChart::TextLayoutItem::setText</a>(<span class="keyword">const</span> QString &amp; text)
<a name="l00141"></a>00141 {
<a name="l00142"></a>00142     mText = text;
<a name="l00143"></a>00143     cachedSizeHint = QSize();
<a name="l00144"></a>00144     <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#b3e0267e82d7a2832041db2d1fa11326">sizeHint</a>();
<a name="l00145"></a>00145     <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#5792fcaa0a3759277e9725945b5bd30b">mParent</a> )
<a name="l00146"></a>00146         <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#5792fcaa0a3759277e9725945b5bd30b">mParent</a>-&gt;update();
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#eae94a2d582d921f2a159b241310332c">00149</a> QString <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#eae94a2d582d921f2a159b241310332c">KDChart::TextLayoutItem::text</a>()<span class="keyword"> const</span>
<a name="l00150"></a>00150 <span class="keyword"></span>{
<a name="l00151"></a>00151     <span class="keywordflow">return</span> mText;
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00159"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#1a7b9f5ea90e5066175baea2b20c4c3f">00159</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#1a7b9f5ea90e5066175baea2b20c4c3f">KDChart::TextLayoutItem::setTextAttributes</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> &amp;a )
<a name="l00160"></a>00160 {
<a name="l00161"></a>00161     mAttributes = a;
<a name="l00162"></a>00162     cachedSizeHint = QSize(); <span class="comment">// invalidate size hint</span>
<a name="l00163"></a>00163     <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#b3e0267e82d7a2832041db2d1fa11326">sizeHint</a>();
<a name="l00164"></a>00164     <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#5792fcaa0a3759277e9725945b5bd30b">mParent</a> )
<a name="l00165"></a>00165         <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#5792fcaa0a3759277e9725945b5bd30b">mParent</a>-&gt;update();
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00173"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#5571ec1fc6c6cfc628c11a053291aef0">00173</a> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">KDChart::TextAttributes</a> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#5571ec1fc6c6cfc628c11a053291aef0">KDChart::TextLayoutItem::textAttributes</a>()<span class="keyword"> const</span>
<a name="l00174"></a>00174 <span class="keyword"></span>{
<a name="l00175"></a>00175     <span class="keywordflow">return</span> mAttributes;
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 
<a name="l00179"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#e145f80d31ab536175a19ef5c869d474">00179</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#e145f80d31ab536175a19ef5c869d474">KDChart::TextLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
<a name="l00180"></a>00180 <span class="keyword"></span>{
<a name="l00181"></a>00181     <span class="keywordflow">return</span> 0; <span class="comment">// Grow neither vertically nor horizontally</span>
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#7f7107804d77b8fe5700bceb6e207427">00184</a> QRect <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#7f7107804d77b8fe5700bceb6e207427">KDChart::TextLayoutItem::geometry</a>()<span class="keyword"> const</span>
<a name="l00185"></a>00185 <span class="keyword"></span>{
<a name="l00186"></a>00186     <span class="keywordflow">return</span> mRect;
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#4981e4394956451f6a176ae0d8b1d158">00189</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#4981e4394956451f6a176ae0d8b1d158">KDChart::TextLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
<a name="l00190"></a>00190 <span class="keyword"></span>{
<a name="l00191"></a>00191     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#db09bc81e8126ce19ad7808aa7d2b692">00194</a> QSize <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#db09bc81e8126ce19ad7808aa7d2b692">KDChart::TextLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
<a name="l00195"></a>00195 <span class="keyword"></span>{
<a name="l00196"></a>00196     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#b3e0267e82d7a2832041db2d1fa11326">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#fd5a8b92a06961207bda68af3a22755b">00199</a> QSize <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#fd5a8b92a06961207bda68af3a22755b">KDChart::TextLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
<a name="l00200"></a>00200 <span class="keyword"></span>{
<a name="l00201"></a>00201     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#b3e0267e82d7a2832041db2d1fa11326">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#1eed01e6a036b078b02732c8f588b807">00204</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#1eed01e6a036b078b02732c8f588b807">KDChart::TextLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
<a name="l00205"></a>00205 {
<a name="l00206"></a>00206     mRect = r;
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 
<a name="l00210"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#292f7bc36cca713a44ca8dcb36b91e59">00210</a> qreal <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#292f7bc36cca713a44ca8dcb36b91e59">KDChart::TextLayoutItem::realFontSize</a>()<span class="keyword"> const</span>
<a name="l00211"></a>00211 <span class="keyword"></span>{
<a name="l00212"></a>00212     <span class="keywordflow">return</span> mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#387053d5def98da03f819bd2bf619fab">calculatedFontSize</a>( mAutoReferenceArea, mAutoReferenceOrientation );
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 <span class="keywordtype">bool</span> KDChart::TextLayoutItem::realFontWasRecalculated()<span class="keyword"> const</span>
<a name="l00217"></a>00217 <span class="keyword"></span>{
<a name="l00218"></a>00218     <span class="keyword">const</span> qreal fntSiz = <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#292f7bc36cca713a44ca8dcb36b91e59">realFontSize</a>();
<a name="l00219"></a>00219     <span class="keyword">const</span> <span class="keywordtype">bool</span> bRecalcDone =
<a name="l00220"></a>00220         ( ( ! cachedSizeHint.isValid() ) || ( cachedFontSize != fntSiz   ) );
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     <span class="keywordflow">if</span>( bRecalcDone &amp;&amp; fntSiz &gt; 0.0 ){
<a name="l00223"></a>00223         cachedFontSize = fntSiz;
<a name="l00224"></a>00224         cachedFont.setPointSizeF( fntSiz );
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226     <span class="keywordflow">return</span> bRecalcDone;
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00230"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#b5ff4f80a6ec5b99e00a9fc68dee1847">00230</a> QFont <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#b5ff4f80a6ec5b99e00a9fc68dee1847">KDChart::TextLayoutItem::realFont</a>()<span class="keyword"> const</span>
<a name="l00231"></a>00231 <span class="keyword"></span>{
<a name="l00232"></a>00232     realFontWasRecalculated(); <span class="comment">// we can safely ignore the boolean return value</span>
<a name="l00233"></a>00233     <span class="keywordflow">return</span> cachedFont;
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 QPolygon KDChart::TextLayoutItem::rotatedCorners()<span class="keyword"> const</span>
<a name="l00237"></a>00237 <span class="keyword"></span>{
<a name="l00238"></a>00238     <span class="comment">// the angle in rad</span>
<a name="l00239"></a>00239     <span class="keyword">const</span> qreal angle = mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#f64d4c21e41e019b75e83186c879394a">rotation</a>() * <a class="code" href="_k_d_chart_layout_items_8cpp.html#b4250e743fd9a8d6a9f9b1844733341c">PI</a> / 180.0;
<a name="l00240"></a>00240     QSize size = unrotatedSizeHint();
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <span class="comment">// my P1 - P4 (the four points of the rotated area)</span>
<a name="l00243"></a>00243     QPointF P1( size.height() * sin( angle ), 0 );
<a name="l00244"></a>00244     QPointF P2( size.height() * sin( angle ) + size.width() * cos( angle ), size.width() * sin( angle ) );
<a name="l00245"></a>00245     QPointF P3( size.width() * cos( angle ), size.width() * sin( angle ) + size.height() * cos( angle ) );
<a name="l00246"></a>00246     QPointF P4( 0, size.height() * cos( angle ) );
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     QPolygon result;
<a name="l00249"></a>00249     result &lt;&lt; P1.toPoint() &lt;&lt; P2.toPoint() &lt;&lt; P3.toPoint() &lt;&lt; P4.toPoint();
<a name="l00250"></a>00250     <span class="keywordflow">return</span> result;
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#46b8eae6fa820e1d82808fc589db267f">00253</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#46b8eae6fa820e1d82808fc589db267f">KDChart::TextLayoutItem::intersects</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">TextLayoutItem</a>&amp; other, <span class="keyword">const</span> QPointF&amp; myPos, <span class="keyword">const</span> QPointF&amp; otherPos )<span class="keyword"> const</span>
<a name="l00254"></a>00254 <span class="keyword"></span>{
<a name="l00255"></a>00255     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#46b8eae6fa820e1d82808fc589db267f">intersects</a>( other, myPos.toPoint(), otherPos.toPoint() );
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 
<a name="l00258"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#750e8d5a216807c8b25605d3672ce552">00258</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#46b8eae6fa820e1d82808fc589db267f">KDChart::TextLayoutItem::intersects</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">TextLayoutItem</a>&amp; other, <span class="keyword">const</span> QPoint&amp; myPos, <span class="keyword">const</span> QPoint&amp; otherPos )<span class="keyword"> const</span>
<a name="l00259"></a>00259 <span class="keyword"></span>{
<a name="l00260"></a>00260     <span class="keywordflow">if</span> ( mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#f64d4c21e41e019b75e83186c879394a">rotation</a>() != other.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#ec715c97ce07b6dfa60eab2c5a00259f">mAttributes</a>.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#f64d4c21e41e019b75e83186c879394a">rotation</a>() )
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262         <span class="comment">// that's the code for the common case: the rotation angles don't need to match here</span>
<a name="l00263"></a>00263         QPolygon myPolygon(          rotatedCorners() );
<a name="l00264"></a>00264         QPolygon otherPolygon( other.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#b7de5aaf973b6926933029b0c606087f">rotatedCorners</a>() );
<a name="l00265"></a>00265 
<a name="l00266"></a>00266         <span class="comment">// move the polygons to their positions</span>
<a name="l00267"></a>00267         myPolygon.translate( myPos );
<a name="l00268"></a>00268         otherPolygon.translate( otherPos );
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         <span class="comment">// create regions out of it</span>
<a name="l00271"></a>00271         QRegion myRegion( myPolygon );
<a name="l00272"></a>00272         QRegion otherRegion( otherPolygon );
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         <span class="comment">// now the question - do they intersect or not?</span>
<a name="l00275"></a>00275         <span class="keywordflow">return</span> ! myRegion.intersect( otherRegion ).isEmpty();
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     } <span class="keywordflow">else</span> {
<a name="l00278"></a>00278         <span class="comment">// and that's the code for the special case: the rotation angles match, which is less time consuming in calculation</span>
<a name="l00279"></a>00279         <span class="keyword">const</span> qreal angle = mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#f64d4c21e41e019b75e83186c879394a">rotation</a>() * <a class="code" href="_k_d_chart_layout_items_8cpp.html#b4250e743fd9a8d6a9f9b1844733341c">PI</a> / 180.0;
<a name="l00280"></a>00280         <span class="comment">// both sizes</span>
<a name="l00281"></a>00281         <span class="keyword">const</span> QSizeF mySize(          unrotatedSizeHint() );
<a name="l00282"></a>00282         <span class="keyword">const</span> QSizeF otherSize( other.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#ec0495afc7e1b99ea9f647588d0ed8fd">unrotatedSizeHint</a>() );
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="comment">// that's myP1 relative to myPos</span>
<a name="l00285"></a>00285         QPointF myP1( mySize.height() * sin( angle ), 0.0 );
<a name="l00286"></a>00286         <span class="comment">// that's otherP1 to myPos</span>
<a name="l00287"></a>00287         QPointF otherP1 = QPointF( otherSize.height() * sin( angle ), 0.0 ) + otherPos - myPos;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289         <span class="comment">// now rotate both points the negative angle around myPos</span>
<a name="l00290"></a>00290         myP1 = QPointF( myP1.x() * cos( -angle ), myP1.x() * sin( -angle ) );
<a name="l00291"></a>00291         qreal r = sqrt( otherP1.x() * otherP1.x() + otherP1.y() * otherP1.y() );
<a name="l00292"></a>00292         otherP1 = QPointF( r * cos( -angle ), r * sin( -angle ) );
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         <span class="comment">// finally we look, whether both rectangles intersect or even not</span>
<a name="l00295"></a>00295         <span class="keywordflow">return</span> QRectF( myP1, mySize ).intersects( QRectF( otherP1, otherSize ) );
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00299"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#b3e0267e82d7a2832041db2d1fa11326">00299</a> QSize <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#b3e0267e82d7a2832041db2d1fa11326">KDChart::TextLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
<a name="l00300"></a>00300 <span class="keyword"></span>{
<a name="l00301"></a>00301     <span class="keywordflow">if</span>( realFontWasRecalculated() )
<a name="l00302"></a>00302     {
<a name="l00303"></a>00303         <span class="keyword">const</span> QSize newSizeHint( calcSizeHint( cachedFont ) );
<a name="l00304"></a>00304         <span class="keywordflow">if</span>( newSizeHint != cachedSizeHint ){
<a name="l00305"></a>00305             cachedSizeHint = newSizeHint;
<a name="l00306"></a>00306             <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#0534d441cbcad10d2f2f17bc61de9eb5">sizeHintChanged</a>();
<a name="l00307"></a>00307         }
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     <span class="comment">//qDebug() &lt;&lt; "-------- KDChart::TextLayoutItem::sizeHint() returns:"&lt;&lt;cachedSizeHint&lt;&lt;" ----------";</span>
<a name="l00310"></a>00310     <span class="keywordflow">return</span> cachedSizeHint;
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="comment">// PENDING(kalle) Support auto shrink</span>
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 QSize KDChart::TextLayoutItem::unrotatedSizeHint( QFont fnt )<span class="keyword"> const</span>
<a name="l00318"></a>00318 <span class="keyword"></span>{
<a name="l00319"></a>00319     <span class="keywordflow">if</span> ( fnt == QFont() )
<a name="l00320"></a>00320         fnt = cachedFont;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="keyword">const</span> QFontMetricsF met( fnt, <a class="code" href="class_k_d_chart_1_1_global_measure_scaling.html#e7cee09d499eea84787893bb61f7ada5">GlobalMeasureScaling::paintDevice</a>() );
<a name="l00323"></a>00323     QSize ret(0, 0);
<a name="l00324"></a>00324     <span class="comment">// note: boundingRect() does NOT take any newlines into account</span>
<a name="l00325"></a>00325     <span class="comment">//       so we need to calculate the size by combining several</span>
<a name="l00326"></a>00326     <span class="comment">//       rectangles: one per line.  This fixes bugz issue #3720.</span>
<a name="l00327"></a>00327     <span class="comment">//       (khz, 2007 04 14)</span>
<a name="l00328"></a>00328     QStringList lines = mText.split(QString::fromAscii(<span class="stringliteral">"\n"</span>));
<a name="l00329"></a>00329     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lines.size(); ++i){
<a name="l00330"></a>00330         <span class="keyword">const</span> QSize lSize = met.boundingRect(lines.at(i) ).toRect().size();
<a name="l00331"></a>00331         ret.setWidth(qMax( ret.width(), lSize.width() ));
<a name="l00332"></a>00332         ret.rheight() += lSize.height();
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="keywordtype">int</span> frame = QApplication::style()-&gt;pixelMetric( QStyle::PM_ButtonMargin, 0, 0 );
<a name="l00336"></a>00336     <span class="comment">// fine-tuning for small font sizes: the frame must not be so big, if the font is tiny</span>
<a name="l00337"></a>00337     frame = qMin( frame, ret.height() * 2 / 3 );
<a name="l00338"></a>00338     <span class="comment">//qDebug() &lt;&lt; "frame:"&lt;&lt; frame;</span>
<a name="l00339"></a>00339     ret += QSize( frame, frame );
<a name="l00340"></a>00340     <span class="keywordflow">return</span> ret;
<a name="l00341"></a>00341     <span class="comment">//const QFontMetricsF met( fnt, GlobalMeasureScaling::paintDevice() );</span>
<a name="l00342"></a>00342     <span class="comment">//const int frame = QApplication::style()-&gt;pixelMetric( QStyle::PM_ButtonMargin, 0, 0 );</span>
<a name="l00343"></a>00343     <span class="comment">//return</span>
<a name="l00344"></a>00344     <span class="comment">//    met.boundingRect( mText ).size().toSize() + QSize( frame, frame );</span>
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 QSize KDChart::TextLayoutItem::calcSizeHint( QFont fnt )<span class="keyword"> const</span>
<a name="l00349"></a>00349 <span class="keyword"></span>{
<a name="l00350"></a>00350     QSize ret = unrotatedSizeHint( fnt );
<a name="l00351"></a>00351     <span class="comment">//qDebug() &lt;&lt; "-------- "&lt;&lt;ret.width();</span>
<a name="l00352"></a>00352     <span class="keyword">const</span> qreal angle = <a class="code" href="_k_d_chart_layout_items_8cpp.html#b4250e743fd9a8d6a9f9b1844733341c">PI</a> * mAttributes.rotation() / 180.0;
<a name="l00353"></a>00353     <span class="keyword">const</span> qreal cosAngle = cos( angle );
<a name="l00354"></a>00354     <span class="keyword">const</span> qreal sinAngle = sin( angle );
<a name="l00355"></a>00355     QSize rotated( qAbs(static_cast&lt;int&gt;( cosAngle * ret.width()  + sinAngle * ret.height() )),
<a name="l00356"></a>00356                    qAbs(static_cast&lt;int&gt;( cosAngle * ret.height() + sinAngle * ret.width()  )) );
<a name="l00357"></a>00357     <span class="comment">//qDebug() &lt;&lt; "-------- KDChart::TextLayoutItem::calcSizeHint() returns:"&lt;&lt;rotated&lt;&lt;" ----------";</span>
<a name="l00358"></a>00358     <span class="keywordflow">return</span> rotated;
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="_k_d_chart_layout_items_8cpp.html#a82ec8a39fde8811474275bcc72c7118">00361</a> <span class="keyword">static</span> QPointF <a class="code" href="_k_d_chart_layout_items_8cpp.html#a82ec8a39fde8811474275bcc72c7118">rotatedPoint</a>( <span class="keyword">const</span> QPointF&amp; pt, qreal rotation )
<a name="l00362"></a>00362 {
<a name="l00363"></a>00363     <span class="keyword">const</span> qreal angle = <a class="code" href="_k_d_chart_layout_items_8cpp.html#b4250e743fd9a8d6a9f9b1844733341c">PI</a> * rotation / 180.0;
<a name="l00364"></a>00364     <span class="keyword">const</span> qreal cosAngle = cos( angle );
<a name="l00365"></a>00365     <span class="keyword">const</span> qreal sinAngle = sin( angle );
<a name="l00366"></a>00366     <span class="keywordflow">return</span> QPointF(
<a name="l00367"></a>00367             (cosAngle * pt.x() + sinAngle * pt.y() ),
<a name="l00368"></a>00368             (cosAngle * pt.y() + sinAngle * pt.x() ) );
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="_k_d_chart_layout_items_8cpp.html#3b92c3b6e2aaa39d60c20a9d8235a59d">00371</a> <span class="keyword">static</span> QRectF <a class="code" href="_k_d_chart_layout_items_8cpp.html#3b92c3b6e2aaa39d60c20a9d8235a59d">rotatedRect</a>( <span class="keyword">const</span> QRectF&amp; rect, qreal angle )
<a name="l00372"></a>00372 {
<a name="l00373"></a>00373     <span class="keyword">const</span> QPointF topLeft(  <a class="code" href="_k_d_chart_layout_items_8cpp.html#a82ec8a39fde8811474275bcc72c7118">rotatedPoint</a>( rect.topLeft(),  angle ) );
<a name="l00374"></a>00374     <span class="comment">//const QPointF topRight( rotatedPoint( rect.topRight(), angle ) );</span>
<a name="l00375"></a>00375     <span class="comment">//const QPointF bottomLeft(  rotatedPoint( rect.bottomLeft(),  angle ) );</span>
<a name="l00376"></a>00376     <span class="comment">//const QPointF bottomRight( rotatedPoint( rect.bottomRight(), angle ) );</span>
<a name="l00377"></a>00377     <span class="keyword">const</span> QPointF siz( <a class="code" href="_k_d_chart_layout_items_8cpp.html#a82ec8a39fde8811474275bcc72c7118">rotatedPoint</a>( QPointF( rect.size().width(), rect.size().height() ), angle ) );
<a name="l00378"></a>00378     <span class="keyword">const</span> QRectF result(
<a name="l00379"></a>00379             topLeft,
<a name="l00380"></a>00380             QSizeF( siz.x(), <span class="comment">//bottomRight.x() - topLeft.x(),</span>
<a name="l00381"></a>00381                     siz.y() ) ); <span class="comment">//bottomRight.y() - topLeft.y() ) );</span>
<a name="l00382"></a>00382     <span class="comment">//qDebug() &lt;&lt; "angle" &lt;&lt; angle &lt;&lt; "\nbefore:" &lt;&lt; rect &lt;&lt; "\n after:" &lt;&lt; result;</span>
<a name="l00383"></a>00383     <span class="keywordflow">return</span> result;
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00386"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#e9df8b2da25e4a82671cc833720e90c1">00386</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#e9df8b2da25e4a82671cc833720e90c1">KDChart::TextLayoutItem::paint</a>( QPainter* painter )
<a name="l00387"></a>00387 {
<a name="l00388"></a>00388     <span class="comment">// make sure, cached font is updated, if needed:</span>
<a name="l00389"></a>00389     <span class="comment">// sizeHint();</span>
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="keywordflow">if</span>( !mRect.isValid() )
<a name="l00392"></a>00392         <span class="keywordflow">return</span>;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394     PainterSaver painterSaver( painter );
<a name="l00395"></a>00395     painter-&gt;setFont( cachedFont );
<a name="l00396"></a>00396     QRectF rect( <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#7f7107804d77b8fe5700bceb6e207427">geometry</a>() );
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 <span class="comment">// #ifdef DEBUG_ITEMS_PAINT</span>
<a name="l00399"></a>00399 <span class="comment">//     painter-&gt;setPen( Qt::black );</span>
<a name="l00400"></a>00400 <span class="comment">//     painter-&gt;drawRect( rect );</span>
<a name="l00401"></a>00401 <span class="comment">// #endif</span>
<a name="l00402"></a>00402     painter-&gt;translate( rect.center() );
<a name="l00403"></a>00403     rect.moveTopLeft( QPointF( - rect.width() / 2, - rect.height() / 2 ) );
<a name="l00404"></a>00404 <span class="preprocessor">#ifdef DEBUG_ITEMS_PAINT</span>
<a name="l00405"></a>00405 <span class="preprocessor"></span>    painter-&gt;setPen( Qt::blue );
<a name="l00406"></a>00406     painter-&gt;drawRect( rect );
<a name="l00407"></a>00407 <span class="preprocessor">#endif</span>
<a name="l00408"></a>00408 <span class="preprocessor"></span>    painter-&gt;rotate( mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#f64d4c21e41e019b75e83186c879394a">rotation</a>() );
<a name="l00409"></a>00409     rect = <a class="code" href="_k_d_chart_layout_items_8cpp.html#3b92c3b6e2aaa39d60c20a9d8235a59d">rotatedRect</a>( rect, mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#f64d4c21e41e019b75e83186c879394a">rotation</a>() );
<a name="l00410"></a>00410 <span class="preprocessor">#ifdef DEBUG_ITEMS_PAINT</span>
<a name="l00411"></a>00411 <span class="preprocessor"></span>    painter-&gt;setPen( Qt::red );
<a name="l00412"></a>00412     painter-&gt;drawRect( rect );
<a name="l00413"></a>00413 <span class="preprocessor">#endif</span>
<a name="l00414"></a>00414 <span class="preprocessor"></span>    painter-&gt;setPen( mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#9e83e03e64e612346eff815dc49d19d6">pen</a>() );
<a name="l00415"></a>00415     painter-&gt;drawText( rect, Qt::AlignHCenter | Qt::AlignVCenter, mText );
<a name="l00416"></a>00416 <span class="comment">//    if (  calcSizeHint( cachedFont ).width() &gt; rect.width() )</span>
<a name="l00417"></a>00417 <span class="comment">//        qDebug() &lt;&lt; "rect.width()" &lt;&lt; rect.width() &lt;&lt; "text.width()" &lt;&lt; calcSizeHint( cachedFont ).width();</span>
<a name="l00418"></a>00418 <span class="comment">//</span>
<a name="l00419"></a>00419 <span class="comment">//    //painter-&gt;drawText( rect, Qt::AlignHCenter | Qt::AlignVCenter, mText );</span>
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#ee0bfedc0af17a9a8ae7f4d035b89258">00422</a> <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#ee0bfedc0af17a9a8ae7f4d035b89258">KDChart::HorizontalLineLayoutItem::HorizontalLineLayoutItem</a>()
<a name="l00423"></a>00423     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( Qt::AlignCenter )
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425 }
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#d06422f287e7847c32a8172cd871eef8">00427</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#d06422f287e7847c32a8172cd871eef8">KDChart::HorizontalLineLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
<a name="l00428"></a>00428 <span class="keyword"></span>{
<a name="l00429"></a>00429     <span class="keywordflow">return</span> Qt::Vertical|Qt::Horizontal; <span class="comment">// Grow both vertically, and horizontally</span>
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00432"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#71777456f3dc686893296626c6a4dfdd">00432</a> QRect <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#71777456f3dc686893296626c6a4dfdd">KDChart::HorizontalLineLayoutItem::geometry</a>()<span class="keyword"> const</span>
<a name="l00433"></a>00433 <span class="keyword"></span>{
<a name="l00434"></a>00434     <span class="keywordflow">return</span> mRect;
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#df0f3faef56ac95f020f3e9e46d6d718">00437</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#df0f3faef56ac95f020f3e9e46d6d718">KDChart::HorizontalLineLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
<a name="l00438"></a>00438 <span class="keyword"></span>{
<a name="l00439"></a>00439     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#0b41e7341af6506a6c64a44f712ca748">00442</a> QSize <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#0b41e7341af6506a6c64a44f712ca748">KDChart::HorizontalLineLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
<a name="l00443"></a>00443 <span class="keyword"></span>{
<a name="l00444"></a>00444     <span class="keywordflow">return</span> QSize( QWIDGETSIZE_MAX, QWIDGETSIZE_MAX );
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00447"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#1e337273b810de32d1147d8498e01ccc">00447</a> QSize <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#1e337273b810de32d1147d8498e01ccc">KDChart::HorizontalLineLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
<a name="l00448"></a>00448 <span class="keyword"></span>{
<a name="l00449"></a>00449     <span class="keywordflow">return</span> QSize( 0, 0 );
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 
<a name="l00452"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#7f4d6cd7cc57856f8de53f046bf1943d">00452</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#7f4d6cd7cc57856f8de53f046bf1943d">KDChart::HorizontalLineLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454     mRect = r;
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#32846d7e9c78741848a2c78669514e73">00457</a> QSize <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#32846d7e9c78741848a2c78669514e73">KDChart::HorizontalLineLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
<a name="l00458"></a>00458 <span class="keyword"></span>{
<a name="l00459"></a>00459     <span class="keywordflow">return</span> QSize( -1, 3 ); <span class="comment">// see qframe.cpp</span>
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 
<a name="l00463"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#4f2074bf394eaf825f58c90483fb491f">00463</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#4f2074bf394eaf825f58c90483fb491f">KDChart::HorizontalLineLayoutItem::paint</a>( QPainter* painter )
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465     <span class="keywordflow">if</span>( !mRect.isValid() )
<a name="l00466"></a>00466         <span class="keywordflow">return</span>;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     painter-&gt;drawLine( QPointF( mRect.left(), mRect.center().y() ),
<a name="l00469"></a>00469                        QPointF( mRect.right(), mRect.center().y() ) );
<a name="l00470"></a>00470 }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472 
<a name="l00473"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#1f5b0c170ce1226d829deca138f89311">00473</a> <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#1f5b0c170ce1226d829deca138f89311">KDChart::VerticalLineLayoutItem::VerticalLineLayoutItem</a>()
<a name="l00474"></a>00474     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( Qt::AlignCenter )
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#50fb5ce3dc9e12bbc014961dbe27d3f9">00478</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#50fb5ce3dc9e12bbc014961dbe27d3f9">KDChart::VerticalLineLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
<a name="l00479"></a>00479 <span class="keyword"></span>{
<a name="l00480"></a>00480     <span class="keywordflow">return</span> Qt::Vertical|Qt::Vertical; <span class="comment">// Grow both vertically, and horizontally</span>
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 
<a name="l00483"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#8d50bcbb2c646fafa6d7364ca5144298">00483</a> QRect <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#8d50bcbb2c646fafa6d7364ca5144298">KDChart::VerticalLineLayoutItem::geometry</a>()<span class="keyword"> const</span>
<a name="l00484"></a>00484 <span class="keyword"></span>{
<a name="l00485"></a>00485     <span class="keywordflow">return</span> mRect;
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 
<a name="l00488"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#920d968280f54cacd515615656176ad7">00488</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#920d968280f54cacd515615656176ad7">KDChart::VerticalLineLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
<a name="l00489"></a>00489 <span class="keyword"></span>{
<a name="l00490"></a>00490     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
<a name="l00491"></a>00491 }
<a name="l00492"></a>00492 
<a name="l00493"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#f4c68fdc4fb0372144a56fff9aeebbcb">00493</a> QSize <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#f4c68fdc4fb0372144a56fff9aeebbcb">KDChart::VerticalLineLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
<a name="l00494"></a>00494 <span class="keyword"></span>{
<a name="l00495"></a>00495     <span class="keywordflow">return</span> QSize( QWIDGETSIZE_MAX, QWIDGETSIZE_MAX );
<a name="l00496"></a>00496 }
<a name="l00497"></a>00497 
<a name="l00498"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#c904f10498a778f05b169ed83b5e977d">00498</a> QSize <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#c904f10498a778f05b169ed83b5e977d">KDChart::VerticalLineLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
<a name="l00499"></a>00499 <span class="keyword"></span>{
<a name="l00500"></a>00500     <span class="keywordflow">return</span> QSize( 0, 0 );
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 
<a name="l00503"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#dba6e4e0bc5a3827481669cf57746147">00503</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#dba6e4e0bc5a3827481669cf57746147">KDChart::VerticalLineLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
<a name="l00504"></a>00504 {
<a name="l00505"></a>00505     mRect = r;
<a name="l00506"></a>00506 }
<a name="l00507"></a>00507 
<a name="l00508"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#64c604e898082384b82a27128072a1ef">00508</a> QSize <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#64c604e898082384b82a27128072a1ef">KDChart::VerticalLineLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
<a name="l00509"></a>00509 <span class="keyword"></span>{
<a name="l00510"></a>00510     <span class="keywordflow">return</span> QSize( 3, -1 ); <span class="comment">// see qframe.cpp</span>
<a name="l00511"></a>00511 }
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 
<a name="l00514"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#adea42df5f8395c16de5f2bb6c1a0d28">00514</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#adea42df5f8395c16de5f2bb6c1a0d28">KDChart::VerticalLineLayoutItem::paint</a>( QPainter* painter )
<a name="l00515"></a>00515 {
<a name="l00516"></a>00516     <span class="keywordflow">if</span>( !mRect.isValid() )
<a name="l00517"></a>00517         <span class="keywordflow">return</span>;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     painter-&gt;drawLine( QPointF( mRect.center().x(), mRect.top() ),
<a name="l00520"></a>00520                        QPointF( mRect.center().x(), mRect.bottom() ) );
<a name="l00521"></a>00521 }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 
<a name="l00525"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#650bcf87c1c3b648c1a594b47626990b">00525</a> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#650bcf87c1c3b648c1a594b47626990b">KDChart::MarkerLayoutItem::MarkerLayoutItem</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">KDChart::AbstractDiagram</a>* diagram,
<a name="l00526"></a>00526                                              <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_marker_attributes.html">MarkerAttributes</a>&amp; marker,
<a name="l00527"></a>00527                                              <span class="keyword">const</span> QBrush&amp; brush, <span class="keyword">const</span> QPen&amp; pen,
<a name="l00528"></a>00528                                              Qt::Alignment alignment )
<a name="l00529"></a>00529     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( alignment )
<a name="l00530"></a>00530     , mDiagram( diagram )
<a name="l00531"></a>00531     , mMarker( marker )
<a name="l00532"></a>00532     , mBrush( brush )
<a name="l00533"></a>00533     , mPen( pen )
<a name="l00534"></a>00534 {
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#f0beb3c70069e44267ac36b71f87bd9f">00537</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#f0beb3c70069e44267ac36b71f87bd9f">KDChart::MarkerLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
<a name="l00538"></a>00538 <span class="keyword"></span>{
<a name="l00539"></a>00539     <span class="keywordflow">return</span> 0; <span class="comment">// Grow neither vertically nor horizontally</span>
<a name="l00540"></a>00540 }
<a name="l00541"></a>00541 
<a name="l00542"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#d8fbf234065823dde7e1c429b6bb8ebc">00542</a> QRect <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#d8fbf234065823dde7e1c429b6bb8ebc">KDChart::MarkerLayoutItem::geometry</a>()<span class="keyword"> const</span>
<a name="l00543"></a>00543 <span class="keyword"></span>{
<a name="l00544"></a>00544     <span class="keywordflow">return</span> mRect;
<a name="l00545"></a>00545 }
<a name="l00546"></a>00546 
<a name="l00547"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#70bb60817c20457fbabe7b727aa11bea">00547</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#70bb60817c20457fbabe7b727aa11bea">KDChart::MarkerLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
<a name="l00548"></a>00548 <span class="keyword"></span>{
<a name="l00549"></a>00549     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00552"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#df7f9877db225cb2fa67c51f47747501">00552</a> QSize <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#df7f9877db225cb2fa67c51f47747501">KDChart::MarkerLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
<a name="l00553"></a>00553 <span class="keyword"></span>{
<a name="l00554"></a>00554     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#53e71cbfeb722dcc1bba4f06c302fab9">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00557"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#33d08fff6bee5201fdba17bffc96da83">00557</a> QSize <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#33d08fff6bee5201fdba17bffc96da83">KDChart::MarkerLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
<a name="l00558"></a>00558 <span class="keyword"></span>{
<a name="l00559"></a>00559     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#53e71cbfeb722dcc1bba4f06c302fab9">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
<a name="l00560"></a>00560 }
<a name="l00561"></a>00561 
<a name="l00562"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#12f170beafc314df6c60e01d9dc407ed">00562</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#12f170beafc314df6c60e01d9dc407ed">KDChart::MarkerLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564     mRect = r;
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#53e71cbfeb722dcc1bba4f06c302fab9">00567</a> QSize <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#53e71cbfeb722dcc1bba4f06c302fab9">KDChart::MarkerLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
<a name="l00568"></a>00568 <span class="keyword"></span>{
<a name="l00569"></a>00569     <span class="comment">//qDebug() &lt;&lt; "KDChart::MarkerLayoutItem::sizeHint() returns:"&lt;&lt;mMarker.markerSize().toSize();</span>
<a name="l00570"></a>00570     <span class="keywordflow">return</span> mMarker.<a class="code" href="class_k_d_chart_1_1_marker_attributes.html#babf8673ed59f3e26b2cfa8b866f528c">markerSize</a>().toSize();
<a name="l00571"></a>00571 }
<a name="l00572"></a>00572 
<a name="l00573"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#3f55f87c38ea38f792db646056f5e49d">00573</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#3f55f87c38ea38f792db646056f5e49d">KDChart::MarkerLayoutItem::paint</a>( QPainter* painter )
<a name="l00574"></a>00574 {
<a name="l00575"></a>00575     <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#a07bb95a246119750a892793d26edcb7">paintIntoRect</a>( painter, mRect, mDiagram, mMarker, mBrush, mPen );
<a name="l00576"></a>00576 }
<a name="l00577"></a>00577 
<a name="l00578"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#a07bb95a246119750a892793d26edcb7">00578</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#a07bb95a246119750a892793d26edcb7">KDChart::MarkerLayoutItem::paintIntoRect</a>(
<a name="l00579"></a>00579         QPainter* painter,
<a name="l00580"></a>00580         <span class="keyword">const</span> QRect&amp; rect,
<a name="l00581"></a>00581         <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>* diagram,
<a name="l00582"></a>00582         <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_marker_attributes.html">MarkerAttributes</a>&amp; marker,
<a name="l00583"></a>00583         <span class="keyword">const</span> QBrush&amp; brush,
<a name="l00584"></a>00584         <span class="keyword">const</span> QPen&amp; pen )
<a name="l00585"></a>00585 {
<a name="l00586"></a>00586     <span class="keywordflow">if</span>( ! rect.isValid() )
<a name="l00587"></a>00587         <span class="keywordflow">return</span>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     <span class="comment">// The layout management may assign a larger rect than what we</span>
<a name="l00590"></a>00590     <span class="comment">// wanted. We need to adjust the position.</span>
<a name="l00591"></a>00591     <span class="keyword">const</span> QSize siz = marker.<a class="code" href="class_k_d_chart_1_1_marker_attributes.html#babf8673ed59f3e26b2cfa8b866f528c">markerSize</a>().toSize();
<a name="l00592"></a>00592     QPointF pos = rect.topLeft();
<a name="l00593"></a>00593     pos += QPointF( static_cast&lt;qreal&gt;(( rect.width()  - siz.width()) / 2.0 ),
<a name="l00594"></a>00594                     static_cast&lt;qreal&gt;(( rect.height() - siz.height()) / 2.0 ) );
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 <span class="preprocessor">#ifdef DEBUG_ITEMS_PAINT</span>
<a name="l00597"></a>00597 <span class="preprocessor"></span>    QPointF oldPos = pos;
<a name="l00598"></a>00598 <span class="preprocessor">#endif</span>
<a name="l00599"></a>00599 <span class="preprocessor"></span>
<a name="l00600"></a>00600 <span class="comment">// And finally, drawMarker() assumes the position to be the center</span>
<a name="l00601"></a>00601     <span class="comment">// of the marker, adjust again.</span>
<a name="l00602"></a>00602     pos += QPointF( static_cast&lt;qreal&gt;( siz.width() ) / 2.0,
<a name="l00603"></a>00603                     static_cast&lt;qreal&gt;( siz.height() )/ 2.0 );
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     diagram-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#43f6fc4b51e0b7b8a476c4498ba55959">paintMarker</a>( painter, marker, brush, pen, pos.toPoint(), siz );
<a name="l00606"></a>00606 
<a name="l00607"></a>00607 <span class="preprocessor">#ifdef DEBUG_ITEMS_PAINT</span>
<a name="l00608"></a>00608 <span class="preprocessor"></span>    <span class="keyword">const</span> QPen oldPen( painter-&gt;pen() );
<a name="l00609"></a>00609     painter-&gt;setPen( Qt::red );
<a name="l00610"></a>00610     painter-&gt;drawRect( QRect(oldPos.toPoint(), siz) );
<a name="l00611"></a>00611     painter-&gt;setPen( oldPen );
<a name="l00612"></a>00612 <span class="preprocessor">#endif</span>
<a name="l00613"></a>00613 <span class="preprocessor"></span>}
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 
<a name="l00616"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#da8c2565a1b04fd148f8a912fd08b1d0">00616</a> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#da8c2565a1b04fd148f8a912fd08b1d0">KDChart::LineLayoutItem::LineLayoutItem</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">KDChart::AbstractDiagram</a>* diagram,
<a name="l00617"></a>00617                                          <span class="keywordtype">int</span> length,
<a name="l00618"></a>00618                                          <span class="keyword">const</span> QPen&amp; pen,
<a name="l00619"></a>00619                                          Qt::Alignment alignment )
<a name="l00620"></a>00620     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( alignment )
<a name="l00621"></a>00621     , mDiagram( diagram )
<a name="l00622"></a>00622     , mLength( length )
<a name="l00623"></a>00623     , mPen( pen )
<a name="l00624"></a>00624 {
<a name="l00625"></a>00625     <span class="comment">//have a mini pen width</span>
<a name="l00626"></a>00626     <span class="keywordflow">if</span> ( pen.width() &lt; 2 )
<a name="l00627"></a>00627         mPen.setWidth( 2 );
<a name="l00628"></a>00628 }
<a name="l00629"></a>00629 
<a name="l00630"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#a5974425c9c21e3b59e8804cd9b7a1fd">00630</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#a5974425c9c21e3b59e8804cd9b7a1fd">KDChart::LineLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
<a name="l00631"></a>00631 <span class="keyword"></span>{
<a name="l00632"></a>00632     <span class="keywordflow">return</span> 0; <span class="comment">// Grow neither vertically nor horizontally</span>
<a name="l00633"></a>00633 }
<a name="l00634"></a>00634 
<a name="l00635"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#b32ef4006a7d18f6b5c5259fcd575d87">00635</a> QRect <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#b32ef4006a7d18f6b5c5259fcd575d87">KDChart::LineLayoutItem::geometry</a>()<span class="keyword"> const</span>
<a name="l00636"></a>00636 <span class="keyword"></span>{
<a name="l00637"></a>00637     <span class="keywordflow">return</span> mRect;
<a name="l00638"></a>00638 }
<a name="l00639"></a>00639 
<a name="l00640"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#f2313ec125658898284147661814eb63">00640</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#f2313ec125658898284147661814eb63">KDChart::LineLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
<a name="l00641"></a>00641 <span class="keyword"></span>{
<a name="l00642"></a>00642     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#2222b992895158f7c14076e9f945f086">00645</a> QSize <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#2222b992895158f7c14076e9f945f086">KDChart::LineLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
<a name="l00646"></a>00646 <span class="keyword"></span>{
<a name="l00647"></a>00647     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#e76ca55c26ab23bb28d4d76ca29082f5">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
<a name="l00648"></a>00648 }
<a name="l00649"></a>00649 
<a name="l00650"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#75e0d30aca7838e60ffc6a4ffe57584f">00650</a> QSize <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#75e0d30aca7838e60ffc6a4ffe57584f">KDChart::LineLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
<a name="l00651"></a>00651 <span class="keyword"></span>{
<a name="l00652"></a>00652     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#e76ca55c26ab23bb28d4d76ca29082f5">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
<a name="l00653"></a>00653 }
<a name="l00654"></a>00654 
<a name="l00655"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#25ccb80899d89e01ffbaffd014388c1c">00655</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#25ccb80899d89e01ffbaffd014388c1c">KDChart::LineLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
<a name="l00656"></a>00656 {
<a name="l00657"></a>00657     mRect = r;
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00660"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#e76ca55c26ab23bb28d4d76ca29082f5">00660</a> QSize <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#e76ca55c26ab23bb28d4d76ca29082f5">KDChart::LineLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
<a name="l00661"></a>00661 <span class="keyword"></span>{
<a name="l00662"></a>00662     <span class="keywordflow">return</span> QSize( mLength, mPen.width()+2 );
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00665"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#bb6e3f53e0c2682836d1eaec7e196ce8">00665</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#bb6e3f53e0c2682836d1eaec7e196ce8">KDChart::LineLayoutItem::paint</a>( QPainter* painter )
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667     <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#88f5e096c88192edf2504f1c728b19b7">paintIntoRect</a>( painter, mRect, mPen );
<a name="l00668"></a>00668 }
<a name="l00669"></a>00669 
<a name="l00670"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#88f5e096c88192edf2504f1c728b19b7">00670</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#88f5e096c88192edf2504f1c728b19b7">KDChart::LineLayoutItem::paintIntoRect</a>(
<a name="l00671"></a>00671         QPainter* painter,
<a name="l00672"></a>00672         <span class="keyword">const</span> QRect&amp; rect,
<a name="l00673"></a>00673         <span class="keyword">const</span> QPen&amp; pen )
<a name="l00674"></a>00674 {
<a name="l00675"></a>00675     <span class="keywordflow">if</span>( ! rect.isValid() )
<a name="l00676"></a>00676         <span class="keywordflow">return</span>;
<a name="l00677"></a>00677 
<a name="l00678"></a>00678     <span class="keyword">const</span> QPen oldPen = painter-&gt;pen();
<a name="l00679"></a>00679     painter-&gt;setPen( pen );
<a name="l00680"></a>00680     <span class="keyword">const</span> qreal y = rect.center().y();
<a name="l00681"></a>00681     painter-&gt;drawLine( QPointF( rect.left(), y ),
<a name="l00682"></a>00682                        QPointF( rect.right(), y ) );
<a name="l00683"></a>00683     painter-&gt;setPen( oldPen );
<a name="l00684"></a>00684 }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686 
<a name="l00687"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#406694d2921914d74448db3dc5a9c817">00687</a> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#406694d2921914d74448db3dc5a9c817">KDChart::LineWithMarkerLayoutItem::LineWithMarkerLayoutItem</a>(
<a name="l00688"></a>00688         <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">KDChart::AbstractDiagram</a>* diagram,
<a name="l00689"></a>00689         <span class="keywordtype">int</span> lineLength,
<a name="l00690"></a>00690         <span class="keyword">const</span> QPen&amp; linePen,
<a name="l00691"></a>00691         <span class="keywordtype">int</span> markerOffs,
<a name="l00692"></a>00692         <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_marker_attributes.html">MarkerAttributes</a>&amp; marker,
<a name="l00693"></a>00693         <span class="keyword">const</span> QBrush&amp; markerBrush,
<a name="l00694"></a>00694         <span class="keyword">const</span> QPen&amp; markerPen,
<a name="l00695"></a>00695         Qt::Alignment alignment )
<a name="l00696"></a>00696     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( alignment )
<a name="l00697"></a>00697     , mDiagram(     diagram )
<a name="l00698"></a>00698     , mLineLength(  lineLength )
<a name="l00699"></a>00699     , mLinePen(     linePen )
<a name="l00700"></a>00700     , mMarkerOffs(  markerOffs )
<a name="l00701"></a>00701     , mMarker(      marker )
<a name="l00702"></a>00702     , mMarkerBrush( markerBrush )
<a name="l00703"></a>00703     , mMarkerPen(   markerPen )
<a name="l00704"></a>00704 {
<a name="l00705"></a>00705 }
<a name="l00706"></a>00706 
<a name="l00707"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#63a777d3df803072927dfa3b278bfb7b">00707</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#63a777d3df803072927dfa3b278bfb7b">KDChart::LineWithMarkerLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
<a name="l00708"></a>00708 <span class="keyword"></span>{
<a name="l00709"></a>00709     <span class="keywordflow">return</span> 0; <span class="comment">// Grow neither vertically nor horizontally</span>
<a name="l00710"></a>00710 }
<a name="l00711"></a>00711 
<a name="l00712"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#0245d6110adbfc8ca7a9975fd2239001">00712</a> QRect <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#0245d6110adbfc8ca7a9975fd2239001">KDChart::LineWithMarkerLayoutItem::geometry</a>()<span class="keyword"> const</span>
<a name="l00713"></a>00713 <span class="keyword"></span>{
<a name="l00714"></a>00714     <span class="keywordflow">return</span> mRect;
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#a746780560746bc7aa3e8cb5fa6a066d">00717</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#a746780560746bc7aa3e8cb5fa6a066d">KDChart::LineWithMarkerLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
<a name="l00718"></a>00718 <span class="keyword"></span>{
<a name="l00719"></a>00719     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
<a name="l00720"></a>00720 }
<a name="l00721"></a>00721 
<a name="l00722"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#6864b7355728260fa5e5684a87970302">00722</a> QSize <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#6864b7355728260fa5e5684a87970302">KDChart::LineWithMarkerLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
<a name="l00723"></a>00723 <span class="keyword"></span>{
<a name="l00724"></a>00724     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#4325dcea082e60600625f2c5d2c9a4bf">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
<a name="l00725"></a>00725 }
<a name="l00726"></a>00726 
<a name="l00727"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#ef7f2eb0be794a4865af0bd8225b1740">00727</a> QSize <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#ef7f2eb0be794a4865af0bd8225b1740">KDChart::LineWithMarkerLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
<a name="l00728"></a>00728 <span class="keyword"></span>{
<a name="l00729"></a>00729     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#4325dcea082e60600625f2c5d2c9a4bf">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
<a name="l00730"></a>00730 }
<a name="l00731"></a>00731 
<a name="l00732"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#081b98145b091086182a97e576ffe27b">00732</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#081b98145b091086182a97e576ffe27b">KDChart::LineWithMarkerLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
<a name="l00733"></a>00733 {
<a name="l00734"></a>00734     mRect = r;
<a name="l00735"></a>00735 }
<a name="l00736"></a>00736 
<a name="l00737"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#4325dcea082e60600625f2c5d2c9a4bf">00737</a> QSize <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#4325dcea082e60600625f2c5d2c9a4bf">KDChart::LineWithMarkerLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
<a name="l00738"></a>00738 <span class="keyword"></span>{
<a name="l00739"></a>00739     <span class="keyword">const</span> QSize sizeM = mMarker.<a class="code" href="class_k_d_chart_1_1_marker_attributes.html#babf8673ed59f3e26b2cfa8b866f528c">markerSize</a>().toSize();
<a name="l00740"></a>00740     <span class="keyword">const</span> QSize sizeL = QSize( mLineLength, mLinePen.width()+2 );
<a name="l00741"></a>00741     <span class="keywordflow">return</span> QSize( qMax(sizeM.width(),  sizeL.width()),
<a name="l00742"></a>00742                   qMax(sizeM.height(), sizeL.height()) );
<a name="l00743"></a>00743 }
<a name="l00744"></a>00744 
<a name="l00745"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#a7d14bdba22e6526d2b1720d4eda83ad">00745</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#a7d14bdba22e6526d2b1720d4eda83ad">KDChart::LineWithMarkerLayoutItem::paint</a>( QPainter* painter )
<a name="l00746"></a>00746 {
<a name="l00747"></a>00747     <span class="comment">// paint the line over the full width, into the vertical middle of the rect</span>
<a name="l00748"></a>00748     <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#88f5e096c88192edf2504f1c728b19b7">LineLayoutItem::paintIntoRect</a>( painter, mRect, mLinePen );
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     <span class="comment">// paint the marker with the given offset from the left side of the line</span>
<a name="l00751"></a>00751     <span class="keyword">const</span> QRect r(
<a name="l00752"></a>00752             QPoint( mRect.x()+mMarkerOffs, mRect.y() ),
<a name="l00753"></a>00753             QSize( mMarker.<a class="code" href="class_k_d_chart_1_1_marker_attributes.html#babf8673ed59f3e26b2cfa8b866f528c">markerSize</a>().toSize().width(), mRect.height() ) );
<a name="l00754"></a>00754     <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#a07bb95a246119750a892793d26edcb7">MarkerLayoutItem::paintIntoRect</a>(
<a name="l00755"></a>00755             painter, r, mDiagram, mMarker, mMarkerBrush, mMarkerPen );
<a name="l00756"></a>00756 }
<a name="l00757"></a>00757 
<a name="l00758"></a>00758 
<a name="l00759"></a>00759 
<a name="l00760"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#4ecf7a342ee6a0bac36a89c016e383ab">00760</a> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#4ecf7a342ee6a0bac36a89c016e383ab">KDChart::AutoSpacerLayoutItem::AutoSpacerLayoutItem</a>(
<a name="l00761"></a>00761         <span class="keywordtype">bool</span> layoutIsAtTopPosition, QHBoxLayout *rightLeftLayout,
<a name="l00762"></a>00762         <span class="keywordtype">bool</span> layoutIsAtLeftPosition, QVBoxLayout *topBottomLayout )
<a name="l00763"></a>00763     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( Qt::AlignCenter )
<a name="l00764"></a>00764     , mLayoutIsAtTopPosition(  layoutIsAtTopPosition )
<a name="l00765"></a>00765     , mRightLeftLayout( rightLeftLayout )
<a name="l00766"></a>00766     , mLayoutIsAtLeftPosition( layoutIsAtLeftPosition )
<a name="l00767"></a>00767     , mTopBottomLayout( topBottomLayout )
<a name="l00768"></a>00768 {
<a name="l00769"></a>00769 }
<a name="l00770"></a>00770 
<a name="l00771"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#a48bd47afb5055e19cbe04dcbc359166">00771</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#a48bd47afb5055e19cbe04dcbc359166">KDChart::AutoSpacerLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
<a name="l00772"></a>00772 <span class="keyword"></span>{
<a name="l00773"></a>00773     <span class="keywordflow">return</span> 0; <span class="comment">// Grow neither vertically nor horizontally</span>
<a name="l00774"></a>00774 }
<a name="l00775"></a>00775 
<a name="l00776"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#ed057efc5b718b2a7faf9fb469f05dcc">00776</a> QRect <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#ed057efc5b718b2a7faf9fb469f05dcc">KDChart::AutoSpacerLayoutItem::geometry</a>()<span class="keyword"> const</span>
<a name="l00777"></a>00777 <span class="keyword"></span>{
<a name="l00778"></a>00778     <span class="keywordflow">return</span> mRect;
<a name="l00779"></a>00779 }
<a name="l00780"></a>00780 
<a name="l00781"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#bd629cad8a53a9184ece22e6d2702b15">00781</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#bd629cad8a53a9184ece22e6d2702b15">KDChart::AutoSpacerLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
<a name="l00782"></a>00782 <span class="keyword"></span>{
<a name="l00783"></a>00783     <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
<a name="l00784"></a>00784 }
<a name="l00785"></a>00785 
<a name="l00786"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#f34a7a1900f12a8107226df94fe0495c">00786</a> QSize <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#f34a7a1900f12a8107226df94fe0495c">KDChart::AutoSpacerLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
<a name="l00787"></a>00787 <span class="keyword"></span>{
<a name="l00788"></a>00788     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#82956bfd0148b4a64d13f28a4d635057">sizeHint</a>();
<a name="l00789"></a>00789 }
<a name="l00790"></a>00790 
<a name="l00791"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#4e2f5289ac631392721abb1898533bb0">00791</a> QSize <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#4e2f5289ac631392721abb1898533bb0">KDChart::AutoSpacerLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
<a name="l00792"></a>00792 <span class="keyword"></span>{
<a name="l00793"></a>00793     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#82956bfd0148b4a64d13f28a4d635057">sizeHint</a>();
<a name="l00794"></a>00794 }
<a name="l00795"></a>00795 
<a name="l00796"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#8206f7b68e539b9387e7a0667e9add45">00796</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#8206f7b68e539b9387e7a0667e9add45">KDChart::AutoSpacerLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
<a name="l00797"></a>00797 {
<a name="l00798"></a>00798     mRect = r;
<a name="l00799"></a>00799 }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801 
<a name="l00802"></a><a class="code" href="_k_d_chart_layout_items_8cpp.html#444e7875e76ed4592e62f0dec61bd9ea">00802</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="_k_d_chart_layout_items_8cpp.html#444e7875e76ed4592e62f0dec61bd9ea">updateCommonBrush</a>( QBrush&amp; commonBrush, <span class="keywordtype">bool</span>&amp; bStart, <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_abstract_area.html">KDChart::AbstractArea</a>&amp; area )
<a name="l00803"></a>00803 {
<a name="l00804"></a>00804     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_background_attributes.html">KDChart::BackgroundAttributes</a> ba( area.<a class="code" href="class_k_d_chart_1_1_abstract_area_base.html#93247347bf245e4d79293cc75306e0cc">backgroundAttributes</a>() );
<a name="l00805"></a>00805     <span class="keyword">const</span> <span class="keywordtype">bool</span> hasSimpleBrush = (
<a name="l00806"></a>00806             ! area.<a class="code" href="class_k_d_chart_1_1_abstract_area_base.html#5a279b6e4ddef2891b3b058b519ce915">frameAttributes</a>().<a class="code" href="class_k_d_chart_1_1_frame_attributes.html#3173d8a3b744e4b2f144d87dcd03b524">isVisible</a>() &amp;&amp;
<a name="l00807"></a>00807             ba.isVisible() &amp;&amp;
<a name="l00808"></a>00808             ba.pixmapMode() == <a class="code" href="class_k_d_chart_1_1_background_attributes.html#a7f81b6150e4f38d6da1bd3f8b533f28c34e5eaa20b868696e05c5ac30f2e6d2">KDChart::BackgroundAttributes::BackgroundPixmapModeNone</a> &amp;&amp;
<a name="l00809"></a>00809             ba.brush().gradient() == 0 );
<a name="l00810"></a>00810     <span class="keywordflow">if</span>( bStart ){
<a name="l00811"></a>00811         bStart = <span class="keyword">false</span>;
<a name="l00812"></a>00812         commonBrush = hasSimpleBrush ? ba.brush() : QBrush();
<a name="l00813"></a>00813     }<span class="keywordflow">else</span>{
<a name="l00814"></a>00814         <span class="keywordflow">if</span>( ! hasSimpleBrush || ba.brush() != commonBrush )
<a name="l00815"></a>00815         {
<a name="l00816"></a>00816             commonBrush = QBrush();
<a name="l00817"></a>00817         }
<a name="l00818"></a>00818     }
<a name="l00819"></a>00819 }
<a name="l00820"></a>00820 
<a name="l00821"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#82956bfd0148b4a64d13f28a4d635057">00821</a> QSize <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#82956bfd0148b4a64d13f28a4d635057">KDChart::AutoSpacerLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
<a name="l00822"></a>00822 <span class="keyword"></span>{
<a name="l00823"></a>00823     QBrush commonBrush;
<a name="l00824"></a>00824     <span class="keywordtype">bool</span> bStart=<span class="keyword">true</span>;
<a name="l00825"></a>00825     <span class="comment">// calculate the maximal overlap of the top/bottom axes:</span>
<a name="l00826"></a>00826     <span class="keywordtype">int</span> topBottomOverlap = 0;
<a name="l00827"></a>00827     <span class="keywordflow">if</span>( mTopBottomLayout ){
<a name="l00828"></a>00828         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; mTopBottomLayout-&gt;count(); ++i){
<a name="l00829"></a>00829             <a class="code" href="class_k_d_chart_1_1_abstract_area.html">AbstractArea</a>* area = dynamic_cast&lt;AbstractArea*&gt;(mTopBottomLayout-&gt;itemAt(i));
<a name="l00830"></a>00830             <span class="keywordflow">if</span>( area ){
<a name="l00831"></a>00831                 <span class="comment">//qDebug() &lt;&lt; "AutoSpacerLayoutItem testing" &lt;&lt; area;</span>
<a name="l00832"></a>00832                 topBottomOverlap =
<a name="l00833"></a>00833                     mLayoutIsAtLeftPosition
<a name="l00834"></a>00834                     ? qMax( topBottomOverlap, area-&gt;rightOverlap() )
<a name="l00835"></a>00835                     : qMax( topBottomOverlap, area-&gt;leftOverlap() );
<a name="l00836"></a>00836                 <a class="code" href="_k_d_chart_layout_items_8cpp.html#444e7875e76ed4592e62f0dec61bd9ea">updateCommonBrush</a>( commonBrush, bStart, *area );
<a name="l00837"></a>00837             }
<a name="l00838"></a>00838         }
<a name="l00839"></a>00839     }
<a name="l00840"></a>00840     <span class="comment">// calculate the maximal overlap of the left/right axes:</span>
<a name="l00841"></a>00841     <span class="keywordtype">int</span> leftRightOverlap = 0;
<a name="l00842"></a>00842     <span class="keywordflow">if</span>( mRightLeftLayout ){
<a name="l00843"></a>00843         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; mRightLeftLayout-&gt;count(); ++i){
<a name="l00844"></a>00844             <a class="code" href="class_k_d_chart_1_1_abstract_area.html">AbstractArea</a>* area = dynamic_cast&lt;AbstractArea*&gt;(mRightLeftLayout-&gt;itemAt(i));
<a name="l00845"></a>00845             <span class="keywordflow">if</span>( area ){
<a name="l00846"></a>00846                 <span class="comment">//qDebug() &lt;&lt; "AutoSpacerLayoutItem testing" &lt;&lt; area;</span>
<a name="l00847"></a>00847                 leftRightOverlap =
<a name="l00848"></a>00848                         mLayoutIsAtTopPosition
<a name="l00849"></a>00849                         ? qMax( leftRightOverlap, area-&gt;bottomOverlap() )
<a name="l00850"></a>00850                         : qMax( leftRightOverlap, area-&gt;topOverlap() );
<a name="l00851"></a>00851                 <a class="code" href="_k_d_chart_layout_items_8cpp.html#444e7875e76ed4592e62f0dec61bd9ea">updateCommonBrush</a>( commonBrush, bStart, *area );
<a name="l00852"></a>00852             }
<a name="l00853"></a>00853         }
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855     <span class="keywordflow">if</span>( topBottomOverlap &gt; 0 &amp;&amp; leftRightOverlap &gt; 0 )
<a name="l00856"></a>00856         mCommonBrush = commonBrush;
<a name="l00857"></a>00857     <span class="keywordflow">else</span>
<a name="l00858"></a>00858         mCommonBrush = QBrush();
<a name="l00859"></a>00859     mCachedSize = QSize( topBottomOverlap, leftRightOverlap );
<a name="l00860"></a>00860     <span class="comment">//qDebug() &lt;&lt; mCachedSize;</span>
<a name="l00861"></a>00861     <span class="keywordflow">return</span> mCachedSize;
<a name="l00862"></a>00862 }
<a name="l00863"></a>00863 
<a name="l00864"></a>00864 
<a name="l00865"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#f048b86cf29e0a6f3abf1933d36c1ac2">00865</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#f048b86cf29e0a6f3abf1933d36c1ac2">KDChart::AutoSpacerLayoutItem::paint</a>( QPainter* painter )
<a name="l00866"></a>00866 {
<a name="l00867"></a>00867     <span class="keywordflow">if</span>( <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#6b6176c341e081ce87bdce67402e929c">mParentLayout</a> &amp;&amp; mRect.isValid() &amp;&amp; mCachedSize.isValid() &amp;&amp;
<a name="l00868"></a>00868         mCommonBrush.style() != Qt::NoBrush )
<a name="l00869"></a>00869     {
<a name="l00870"></a>00870         QPoint p1( mRect.topLeft() );
<a name="l00871"></a>00871         QPoint p2( mRect.bottomRight() );
<a name="l00872"></a>00872         <span class="keywordflow">if</span>( mLayoutIsAtLeftPosition )
<a name="l00873"></a>00873             p1.rx() += mCachedSize.width() - <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#6b6176c341e081ce87bdce67402e929c">mParentLayout</a>-&gt;spacing();
<a name="l00874"></a>00874         <span class="keywordflow">else</span>
<a name="l00875"></a>00875             p2.rx() -= mCachedSize.width() - <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#6b6176c341e081ce87bdce67402e929c">mParentLayout</a>-&gt;spacing();
<a name="l00876"></a>00876         <span class="keywordflow">if</span>( mLayoutIsAtTopPosition ){
<a name="l00877"></a>00877             p1.ry() += mCachedSize.height() - <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#6b6176c341e081ce87bdce67402e929c">mParentLayout</a>-&gt;spacing() - 1;
<a name="l00878"></a>00878             p2.ry() -= 1;
<a name="l00879"></a>00879         }<span class="keywordflow">else</span>
<a name="l00880"></a>00880             p2.ry() -= mCachedSize.height() - <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#6b6176c341e081ce87bdce67402e929c">mParentLayout</a>-&gt;spacing() - 1;
<a name="l00881"></a>00881         <span class="comment">//qDebug() &lt;&lt; mLayoutIsAtTopPosition &lt;&lt; mLayoutIsAtLeftPosition;</span>
<a name="l00882"></a>00882         <span class="comment">//qDebug() &lt;&lt; mRect;</span>
<a name="l00883"></a>00883         <span class="comment">//qDebug() &lt;&lt; mParentLayout-&gt;margin();</span>
<a name="l00884"></a>00884         <span class="comment">//qDebug() &lt;&lt; QRect( p1, p2 );</span>
<a name="l00885"></a>00885         <span class="keyword">const</span> QPoint oldBrushOrigin( painter-&gt;brushOrigin() );
<a name="l00886"></a>00886         <span class="keyword">const</span> QBrush oldBrush( painter-&gt;brush() );
<a name="l00887"></a>00887         <span class="keyword">const</span> QPen   oldPen(   painter-&gt;pen() );
<a name="l00888"></a>00888         <span class="keyword">const</span> QPointF newTopLeft( painter-&gt;deviceMatrix().map( p1 ) );
<a name="l00889"></a>00889         painter-&gt;setBrushOrigin( newTopLeft );
<a name="l00890"></a>00890         painter-&gt;setBrush( mCommonBrush );
<a name="l00891"></a>00891         painter-&gt;setPen( Qt::NoPen );
<a name="l00892"></a>00892         painter-&gt;drawRect( QRect( p1, p2 ) );
<a name="l00893"></a>00893         painter-&gt;setBrushOrigin( oldBrushOrigin );
<a name="l00894"></a>00894         painter-&gt;setBrush( oldBrush );
<a name="l00895"></a>00895         painter-&gt;setPen( oldPen );
<a name="l00896"></a>00896     }
<a name="l00897"></a>00897     <span class="comment">// debug code:</span>
<a name="l00898"></a>00898 <span class="preprocessor">#if 0</span>
<a name="l00899"></a>00899 <span class="preprocessor"></span>    <span class="comment">//qDebug() &lt;&lt; "KDChart::AutoSpacerLayoutItem::paint()";</span>
<a name="l00900"></a>00900     <span class="keywordflow">if</span>( !mRect.isValid() )
<a name="l00901"></a>00901         <span class="keywordflow">return</span>;
<a name="l00902"></a>00902 
<a name="l00903"></a>00903     painter-&gt;drawRect( mRect );
<a name="l00904"></a>00904     painter-&gt;drawLine( QPointF( mRect.x(), mRect.top() ),
<a name="l00905"></a>00905                        QPointF( mRect.right(), mRect.bottom() ) );
<a name="l00906"></a>00906     painter-&gt;drawLine( QPointF( mRect.right(), mRect.top() ),
<a name="l00907"></a>00907                        QPointF( mRect.x(), mRect.bottom() ) );
<a name="l00908"></a>00908 <span class="preprocessor">#endif</span>
<a name="l00909"></a>00909 <span class="preprocessor"></span>}
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Sep 17 16:16:50 2007 for KD Chart 2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
